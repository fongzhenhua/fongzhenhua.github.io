<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#9400D3"><meta name="generator" content="Hexo 5.4.2">
<link rel="preconnect" href="https://s4.zstatic.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#9400D3">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#9400D3","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/","path":"2023/06/20/åœ¨Neovimä¸­ä½¿ç”¨Lua/","title":"åœ¨Neovimä¸­ä½¿ç”¨Lua"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>åœ¨Neovimä¸­ä½¿ç”¨Lua | BNU-FZH</title>
  







<script async src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">BNU-FZH</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">fengzhenhua@outlook.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-å¯¼èˆª"><a href="/%E5%AF%BC%E8%88%AA/" rel="section"><i class="fa fa-paper-plane fa-fw"></i>å¯¼èˆª</a></li><li class="menu-item menu-item-è½¯ä»¶"><a href="/%E8%BD%AF%E4%BB%B6/" rel="section"><i class="fa fa-briefcase fa-fw"></i>è½¯ä»¶</a></li><li class="menu-item menu-item-æ”¶è—"><a href="/%E6%94%B6%E8%97%8F/" rel="section"><i class="fa fa-folder fa-fw"></i>æ”¶è—</a></li><li class="menu-item menu-item-å·¥ä½œ"><a href="/%E5%B7%A5%E4%BD%9C/" rel="section"><i class="fa fa-folder fa-fw"></i>å·¥ä½œ</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>æœç´¢
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="æœç´¢..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%A8-neovim-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua"><span class="nav-number">1.</span> <span class="nav-text">åœ¨ neovim ä¸­ä½¿ç”¨ Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">ç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0-lua"><span class="nav-number">1.1.1.</span> <span class="nav-text">å­¦ä¹  Lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E6%9C%89%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9C%A8-neovim-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua-%E7%9A%84%E6%95%99%E7%A8%8B"><span class="nav-number">1.1.2.</span> <span class="nav-text">ç°æœ‰çš„ä¸€äº›åœ¨ Neovim
ä¸­ä½¿ç”¨ Lua çš„æ•™ç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><span class="nav-number">1.1.3.</span> <span class="nav-text">ç›¸å…³æ’ä»¶</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lua-%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">Lua æ–‡ä»¶ä½ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#init.lua"><span class="nav-number">1.2.1.</span> <span class="nav-text">init.lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.2.</span> <span class="nav-text">æ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">æç¤º</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">è¿è¡Œæ—¶æ–‡ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA-1"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">æç¤º</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-vimscript-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua"><span class="nav-number">1.3.</span> <span class="nav-text">åœ¨ Vimscript ä¸­ä½¿ç”¨ Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lua"><span class="nav-number">1.3.1.</span> <span class="nav-text">:lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#luado"><span class="nav-number">1.3.2.</span> <span class="nav-text">:luado</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-lua-%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.</span> <span class="nav-text">åŠ è½½ Lua æ–‡ä»¶</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-lua-%E6%96%87%E4%BB%B6%E5%AF%B9%E6%AF%94-require"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">åŠ è½½ Lua æ–‡ä»¶å¯¹æ¯” require():</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#luaeval"><span class="nav-number">1.3.4.</span> <span class="nav-text">luaeval()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vlua"><span class="nav-number">1.3.5.</span> <span class="nav-text">v:lua</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">Caveats</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA-2"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">æç¤º</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vim-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">1.4.</span> <span class="nav-text">Vim å‘½åç©ºé—´</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">Tips</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-lua-%E4%B8%AD%E4%BD%BF%E7%94%A8-vimscript"><span class="nav-number">1.5.</span> <span class="nav-text">åœ¨ Lua ä¸­ä½¿ç”¨ Vimscript</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_eval"><span class="nav-number">1.5.1.</span> <span class="nav-text">vim.api.nvim_eval()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-1"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_exec"><span class="nav-number">1.5.2.</span> <span class="nav-text">vim.api.nvim_exec()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-2"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_command"><span class="nav-number">1.5.3.</span> <span class="nav-text">vim.api.nvim_command()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.cmd"><span class="nav-number">1.5.4.</span> <span class="nav-text">vim.cmd()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips-1"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">Tips</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_replace_termcodes"><span class="nav-number">1.5.5.</span> <span class="nav-text">vim.api.nvim_replace_termcodes()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86-vim-%E7%9A%84%E8%AE%BE%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="nav-number">1.6.</span> <span class="nav-text">ç®¡ç† vim çš„è®¾ç½®é€‰é¡¹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-api-%E5%87%BD%E6%95%B0"><span class="nav-number">1.6.1.</span> <span class="nav-text">ä½¿ç”¨ api å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%83%E8%AE%BF%E9%97%AE%E5%99%A8"><span class="nav-number">1.6.2.</span> <span class="nav-text">ä½¿ç”¨å…ƒè®¿é—®å™¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86-vim-%E7%9A%84%E5%86%85%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-number">1.7.</span> <span class="nav-text">ç®¡ç† vim çš„å†…éƒ¨å˜é‡</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-api-%E5%87%BD%E6%95%B0-1"><span class="nav-number">1.7.1.</span> <span class="nav-text">ä½¿ç”¨ api å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%83%E8%AE%BF%E9%97%AE%E5%99%A8-1"><span class="nav-number">1.7.2.</span> <span class="nav-text">ä½¿ç”¨å…ƒè®¿é—®å™¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-3"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-vimscript-%E5%87%BD%E6%95%B0"><span class="nav-number">1.8.</span> <span class="nav-text">è°ƒç”¨ Vimscript å‡½æ•°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.fn.function"><span class="nav-number">1.8.1.</span> <span class="nav-text">vim.fn.{function}()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips-2"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">Tips</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-4"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">Caveats</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84"><span class="nav-number">1.9.</span> <span class="nav-text">å®šä¹‰æ˜ å°„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#api-%E5%87%BD%E6%95%B0"><span class="nav-number">1.9.1.</span> <span class="nav-text">API å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.keymap"><span class="nav-number">1.9.2.</span> <span class="nav-text">vim.keymap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4"><span class="nav-number">1.10.</span> <span class="nav-text">å®šä¹‰ç”¨æˆ·å‘½ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#caveats-5"><span class="nav-number">1.10.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.11.</span> <span class="nav-text">å®šä¹‰è‡ªåŠ¨å‘½ä»¤</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="nav-number">1.12.</span> <span class="nav-text">å®šä¹‰è¯­æ³•é«˜äº®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#general-tips-and-recommendations"><span class="nav-number">1.13.</span> <span class="nav-text">General tips and
recommendations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E7%BC%93%E5%AD%98%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">1.13.1.</span> <span class="nav-text">é‡æ–°åŠ è½½ç¼“å­˜çš„æ¨¡å—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E8%A6%81%E5%A1%AB%E5%85%85-lua-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.13.2.</span> <span class="nav-text">ä¸è¦å¡«å…… Lua å­—ç¬¦ä¸²ï¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-vimscript---lua-%E4%B9%8B%E9%97%B4%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.13.3.</span> <span class="nav-text">å…³äº Vimscript
&lt;-&gt; Lua ä¹‹é—´ç±»å‹è½¬æ¢çš„æ³¨æ„äº‹é¡¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E8%BD%AC%E6%8D%A2%E6%97%B6%E4%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%89%AF%E6%9C%AC"><span class="nav-number">1.13.3.1.</span> <span class="nav-text">å˜é‡è½¬æ¢æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%80%BB%E8%83%BD%E8%BF%9B%E8%A1%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.13.3.2.</span> <span class="nav-text">å¹¶ä¸æ˜¯æ€»èƒ½è¿›è¡Œç±»å‹è½¬æ¢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vim-booleans"><span class="nav-number">1.13.3.3.</span> <span class="nav-text">Vim booleans</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-linterslanguage-servers"><span class="nav-number">1.13.4.</span> <span class="nav-text">è®¾ç½® linters&#x2F;language servers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#luacheck"><span class="nav-number">1.13.4.1.</span> <span class="nav-text">luacheck</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sumnekolua-language-server"><span class="nav-number">1.13.4.2.</span> <span class="nav-text">sumneko&#x2F;lua-language-server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#coc.nvim"><span class="nav-number">1.13.4.3.</span> <span class="nav-text">coc.nvim</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95-lua-%E4%BB%A3%E7%A0%81"><span class="nav-number">1.13.5.</span> <span class="nav-text">è°ƒè¯• Lua ä»£ç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95-lua-%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84-%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4-%E8%87%AA%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.13.6.</span> <span class="nav-text">è°ƒè¯• Lua
è®¾ç½®çš„æŒ‰é”®æ˜ å°„ &#x2F; ç”¨æˆ·å‘½ä»¤ &#x2F; è‡ªåŠ¨å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-lua-%E4%BB%A3%E7%A0%81"><span class="nav-number">1.13.7.</span> <span class="nav-text">æµ‹è¯• Lua ä»£ç </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-luarocks-%E5%8C%85"><span class="nav-number">1.13.8.</span> <span class="nav-text">ä½¿ç”¨ Luarocks åŒ…</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#miscellaneous"><span class="nav-number">1.14.</span> <span class="nav-text">Miscellaneous</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.loop"><span class="nav-number">1.14.1.</span> <span class="nav-text">vim.loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.lsp"><span class="nav-number">1.14.2.</span> <span class="nav-text">vim.lsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.treesitter"><span class="nav-number">1.14.3.</span> <span class="nav-text">vim.treesitter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#transpilers"><span class="nav-number">1.14.4.</span> <span class="nav-text">Transpilers</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">559</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://www.zxxk.com/" title="å­¦ç§‘èµ„æº â†’ https:&#x2F;&#x2F;www.zxxk.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cloud fa-fw"></i>å­¦ç§‘èµ„æº</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://zujuan.xkw.com/" title="ç»„å·é¢˜åº“ â†’ https:&#x2F;&#x2F;zujuan.xkw.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cloud fa-fw"></i>ç»„å·é¢˜åº“</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://192.168.1.14/" title="å®éªŒä¿¡æ¯ â†’ http:&#x2F;&#x2F;192.168.1.14&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cloud fa-fw"></i>å®éªŒä¿¡æ¯</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhixue.com/" title="æ™ºå­¦é˜…å· â†’ https:&#x2F;&#x2F;www.zhixue.com" rel="noopener me" target="_blank"><i class="fa-solid fa-cloud fa-fw"></i>æ™ºå­¦é˜…å·</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://chat.deepseek.com/" title="æ·±åº¦æ±‚ç´¢ â†’ https:&#x2F;&#x2F;chat.deepseek.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>æ·±åº¦æ±‚ç´¢</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.tongyi.com/" title="é€šä¹‰åƒé—® â†’ https:&#x2F;&#x2F;www.tongyi.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>é€šä¹‰åƒé—®</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.scnet.cn/ui/chatbot/" title="å›½å®¶è¶…ç®— â†’ https:&#x2F;&#x2F;www.scnet.cn&#x2F;ui&#x2F;chatbot&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>å›½å®¶è¶…ç®—</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yuanbao.tencent.com/chat" title="è…¾è®¯å…ƒå® â†’ https:&#x2F;&#x2F;yuanbao.tencent.com&#x2F;chat" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>è…¾è®¯å…ƒå®</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.bing.com/" title="å¿…åº”æœç´¢ â†’ https:&#x2F;&#x2F;cn.bing.com" rel="noopener me" target="_blank"><i class="fa fa-search fa-fw"></i>å¿…åº”æœç´¢</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.hao268.com/" title="ç½‘å€ä¹‹å®¶ â†’ https:&#x2F;&#x2F;www.hao268.com" rel="noopener me" target="_blank"><i class="fa fa-search fa-fw"></i>ç½‘å€ä¹‹å®¶</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://ac.scmor.com/" title="æ€è°‹å­¦æœ¯ â†’ https:&#x2F;&#x2F;ac.scmor.com" rel="noopener me" target="_blank"><i class="fa fa-graduation-cap fa-fw"></i>æ€è°‹å­¦æœ¯</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://search.essclick.com/" title="çˆ±æ€å­¦æœ¯ â†’ https:&#x2F;&#x2F;search.essclick.com" rel="noopener me" target="_blank"><i class="fa fa-graduation-cap fa-fw"></i>çˆ±æ€å­¦æœ¯</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://scholar.lanfanshu.cn/" title="ç•ªè–¯å­¦æœ¯ â†’ https:&#x2F;&#x2F;scholar.lanfanshu.cn&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>ç•ªè–¯å­¦æœ¯</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://xmsoushu.com/" title="ç†ŠçŒ«æœä¹¦ â†’ https:&#x2F;&#x2F;xmsoushu.com&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>ç†ŠçŒ«æœä¹¦</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.bing.com/translator" title="å¿…åº”ç¿»è¯‘ â†’ https:&#x2F;&#x2F;cn.bing.com&#x2F;translator" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>å¿…åº”ç¿»è¯‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fanyi.baidu.com/#zh/en" title="ç™¾åº¦ç¿»è¯‘ â†’ https:&#x2F;&#x2F;fanyi.baidu.com&#x2F;#zh&#x2F;en" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>ç™¾åº¦ç¿»è¯‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fanyi.youdao.com/?keyfrom=fanyi.logo" title="æœ‰é“ç¿»è¯‘ â†’ https:&#x2F;&#x2F;fanyi.youdao.com&#x2F;?keyfrom&#x3D;fanyi.logo" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>æœ‰é“ç¿»è¯‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.oxfordlearnersdictionaries.com/definition/english/" title="ç‰›æ´¥ç¿»è¯‘ â†’ https:&#x2F;&#x2F;www.oxfordlearnersdictionaries.com&#x2F;definition&#x2F;english&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>ç‰›æ´¥ç¿»è¯‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://wx.qq.com/" title="ç½‘é¡µå¾®ä¿¡ â†’ https:&#x2F;&#x2F;wx.qq.com" rel="noopener me" target="_blank"><i class="fab fa-weixin fa-fw"></i>ç½‘é¡µå¾®ä¿¡</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://login.partner.microsoftonline.cn/" title="å¾®è½¯åŠå…¬ â†’ https:&#x2F;&#x2F;login.partner.microsoftonline.cn" rel="noopener me" target="_blank"><i class="fas fa-file fa-fw"></i>å¾®è½¯åŠå…¬</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mathsolver.microsoft.com/" title="å¾®è½¯æ•°å­¦ â†’ https:&#x2F;&#x2F;mathsolver.microsoft.com" rel="noopener me" target="_blank"><i class="fas fa-file fa-fw"></i>å¾®è½¯æ•°å­¦</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.mail.bnu.edu.cn/" title="å¸ˆå¤§é‚®ç®± â†’ https:&#x2F;&#x2F;www.mail.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>å¸ˆå¤§é‚®ç®±</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mail.sina.com.cn/" title="æ–°æµªé‚®ç®± â†’ https:&#x2F;&#x2F;mail.sina.com.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>æ–°æµªé‚®ç®±</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.aliyundrive.com/sign/in" title="é˜¿é‡Œäº‘ç›˜ â†’ https:&#x2F;&#x2F;www.aliyundrive.com&#x2F;sign&#x2F;in" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>é˜¿é‡Œäº‘ç›˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yun.139.com/w/#/" title="ç§»åŠ¨äº‘ç›˜ â†’ https:&#x2F;&#x2F;yun.139.com&#x2F;w&#x2F;#&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>ç§»åŠ¨äº‘ç›˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianguoyun.com/d/login" title="åšæœç½‘ç›˜ â†’ https:&#x2F;&#x2F;www.jianguoyun.com&#x2F;d&#x2F;login" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>åšæœç½‘ç›˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://efss.qloud.my/index.php/login?clear=1" title="Nextäº‘ç›˜ â†’ https:&#x2F;&#x2F;efss.qloud.my&#x2F;index.php&#x2F;login?clear&#x3D;1" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>Nextäº‘ç›˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.123pan.com/" title="123 ç½‘ç›˜ â†’ https:&#x2F;&#x2F;www.123pan.com&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>123 ç½‘ç›˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://annas-archive.org/" title="å®‰å¨œæ¡£æ¡ˆ â†’ https:&#x2F;&#x2F;annas-archive.org&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>å®‰å¨œæ¡£æ¡ˆ</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://book.sciencereading.cn/" title="ç§‘å­¦æ–‡åº“ â†’ https:&#x2F;&#x2F;book.sciencereading.cn" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>ç§‘å­¦æ–‡åº“</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://ylibrary.org/" title="Ylibrary â†’ https:&#x2F;&#x2F;ylibrary.org&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>Ylibrary</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.tboxn.com/sites/320.html" title="Zlibrary â†’ https:&#x2F;&#x2F;www.tboxn.com&#x2F;sites&#x2F;320.html" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>Zlibrary</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.koushare.com/" title="è”»äº«å®˜ç½‘ â†’ https:&#x2F;&#x2F;www.koushare.com" rel="noopener me" target="_blank"><i class="fas fa-globe-asia fa-fw"></i>è”»äº«å®˜ç½‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.duolingo.cn/" title="å¤šé‚»å›½å®˜ â†’ https:&#x2F;&#x2F;www.duolingo.cn" rel="noopener me" target="_blank"><i class="fas fa-school fa-fw"></i>å¤šé‚»å›½å®˜</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.bnu.edu.cn/" title="å¸ˆå¤§å®˜ç½‘ â†’ https:&#x2F;&#x2F;www.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fas fa-university fa-fw"></i>å¸ˆå¤§å®˜ç½‘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://one.bnu.edu.cn/" title="æ•°å­—äº¬å¸ˆ â†’ https:&#x2F;&#x2F;one.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fas fa-university fa-fw"></i>æ•°å­—äº¬å¸ˆ</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.runoob.com/font-awesome/fontawesome-icons-brand.html" title="å›¾ç«™å›¾æ ‡ â†’ https:&#x2F;&#x2F;www.runoob.com&#x2F;font-awesome&#x2F;fontawesome-icons-brand.html" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>å›¾ç«™å›¾æ ‡</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://shields.io/badges" title="é¡¹ç›®å¾®æ ‡ â†’ https:&#x2F;&#x2F;shields.io&#x2F;badges" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>é¡¹ç›®å¾®æ ‡</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jd.com/" title="äº¬ä¸œè´­ç‰© â†’ https:&#x2F;&#x2F;www.jd.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cart-shopping fa-fw"></i>äº¬ä¸œè´­ç‰©</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.taobao.com/" title="æ·˜å®è´­ç‰© â†’ https:&#x2F;&#x2F;www.taobao.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cart-shopping fa-fw"></i>æ·˜å®è´­ç‰©</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.latexlive.com/" title="LaTeXLiv â†’ https:&#x2F;&#x2F;www.latexlive.com" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>LaTeXLiv</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.latexlive.com/help" title="LaTeXHel â†’ https:&#x2F;&#x2F;www.latexlive.com&#x2F;help" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>LaTeXHel</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://p2t.breezedeus.com/" title="Pix2Text â†’ https:&#x2F;&#x2F;p2t.breezedeus.com" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>Pix2Text</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://simpletex.cn/" title="Simplete â†’ https:&#x2F;&#x2F;simpletex.cn" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>Simplete</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="è¿”å›é¡¶éƒ¨">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BNU-FZH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="åœ¨Neovimä¸­ä½¿ç”¨Lua | BNU-FZH">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          åœ¨Neovimä¸­ä½¿ç”¨Lua
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2023-06-20 10:19:49" itemprop="dateCreated datePublished" datetime="2023-06-20T10:19:49+08:00">2023-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-03-26 18:21:20" itemprop="dateModified" datetime="2025-03-26T18:21:20+08:00">2025-03-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="åœ¨-neovim-ä¸­ä½¿ç”¨-lua">åœ¨ neovim ä¸­ä½¿ç”¨ Lua</h1>
<p>æœ¬æ–‡æœ¬æœ€åˆæ¥æºæ˜¯<a
target="_blank" rel="noopener" href="https://gitee.com/zhengqijun/nvim-lua-guide-zh/blob/main/README.md">nvim-lua-guide</a>,ç”±äºè¿™æ®µæ—¶é—´ä¸€ç›´åœ¨å­¦ä¹ ä½¿ç”¨Luaé…ç½®Neovim,
ä½†æ˜¯æ²¡æœ‰ç³»ç»Ÿçš„æ•™æï¼Œè€Œè¿™ç¯‡æ–‡ç« å´æ°å¥½ç»™äº†ä¸€ä¸ªå¤§è‡´çš„æ¡†æ¶ï¼Œæ‰€ä»¥æœ¬æ–‡æœ€åˆå€Ÿç”¨æ­¤æ–‡ï¼Œå¾…æ—¶æœºæˆç†Ÿå†æ­£å¼å¼€å§‹å†™ä½œã€‚</p>
<p><a
target="_blank" rel="noopener" href="https://github.com/nanotee/nvim-lua-guide">nvim-lua-guide</a>
ä¸­æ–‡ç‰ˆç®€æ˜“æ•™ç¨‹</p>
<p>è¯‘è€…ï¼šNeovim Core Developer</p>
<p>:arrow_upper_left: ï¼ˆæ„Ÿè§‰å¤ªå¤šå¤ªæ‚ä¹±ï¼Ÿä½¿ç”¨ Github TOC
æ¥æµè§ˆå¤§çº²ï¼ï¼‰</p>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>Lua ä½œä¸º Neovim
ä¸­çš„ä¸€ç­‰è¯­è¨€çš„é›†æˆæ­£åœ¨æˆä¸ºå®ƒçš„æ€æ‰‹çº§ç‰¹æ€§ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œå­¦ä¹ å¦‚ä½•ç”¨ Lua
ç¼–å†™æ’ä»¶çš„æ•™ç¨‹æ•°é‡å¹¶ä¸åƒç”¨ Vimscript
ç¼–å†™æ’ä»¶é‚£æ ·å¤šã€‚è¿™æ˜¯ä¸€ç§å°è¯•ï¼Œè¯•å›¾æä¾›ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œè®©äººä»¬å¯ä»¥ä½¿ç”¨ Lua
ç¼–å†™ Neovim æ’ä»¶ã€‚</p>
<span id="more"></span>
<p>æœ¬æŒ‡å—å‡å®šæ‚¨ä½¿ç”¨çš„æ˜¯ Neovim 0.5+</p>
<h3 id="å­¦ä¹ -lua">å­¦ä¹  Lua</h3>
<p>ä¸åŒäºåŸç‰ˆæ•™ç¨‹ï¼Œä»¥ä¸‹èµ„æºé€‚ç”¨äºå›½å†…ç”¨æˆ·ï¼š - <a
target="_blank" rel="noopener" href="https://learnxinyminutes.com/docs/lua/">åœ¨ Y åˆ†é’Ÿå†…å­¦ä¹  X å…³äº Lua
çš„é¡µé¢</a> - <a target="_blank" rel="noopener" href="https://www.runoob.com/lua/lua-tutorial.html">Lua
èœé¸Ÿæ•™ç¨‹</a> - <a target="_blank" rel="noopener" href="http://lua-users.org/wiki/LuaDirectory">Lua
ç”¨æˆ·ç»´åŸº</a> - <a target="_blank" rel="noopener" href="https://www.lua.org/manual/5.1/">Lua
çš„å®˜æ–¹å‚è€ƒæ‰‹å†Œ</a></p>
<p>Lua
æ˜¯ä¸€ç§éå¸¸å¹²å‡€å’Œç®€å•çš„è¯­è¨€ã€‚å®ƒå¾ˆå®¹æ˜“å­¦ä¹ ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½ æœ‰å…¶ä»–ç¼–ç¨‹è¯­è¨€åŸºç¡€çš„ä¾‹å¦‚
TypeScript / JavaScript ç­‰ï¼Œä¼šæ›´åŠ å®¹æ˜“ä¸Šæ‰‹ Luaã€‚æ³¨æ„ï¼šNeovim åµŒå…¥çš„ Lua
ç‰ˆæœ¬æ˜¯ LuaJIT 2.1.0ï¼Œå®ƒä¸ Lua 5.1 ä¿æŒå…¼å®¹ï¼ˆå¸¦æœ‰å‡ ä¸ª 5.2 æ‰©å±•ï¼‰</p>
<h3 id="ç°æœ‰çš„ä¸€äº›åœ¨-neovim-ä¸­ä½¿ç”¨-lua-çš„æ•™ç¨‹">ç°æœ‰çš„ä¸€äº›åœ¨ Neovim
ä¸­ä½¿ç”¨ Lua çš„æ•™ç¨‹</h3>
<p>å·²ç»ç¼–å†™äº†ä¸€äº›æ•™ç¨‹æ¥å¸®åŠ©äººä»¬ç”¨ Lua
ç¼–å†™æ’ä»¶ã€‚ä»–ä»¬ä¸­çš„ä¸€äº›äººåœ¨å†™è¿™æœ¬æŒ‡å—æ—¶æä¾›äº†ä¸å°‘çš„å¸®åŠ©ã€‚éå¸¸æ„Ÿè°¢å®ƒä»¬çš„ä½œè€…ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://teukka.tech/luanvim.html">teukka.tech - ä» init.vim
è½¬åˆ° init.lua</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.2n.pl/blog/how-to-write-neovim-plugins-in-lua.md">2n.pl
- å¦‚ä½•ä½¿ç”¨ Lua ç¼–å†™ neovim æ’ä»¶</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.2n.pl/blog/how-to-make-ui-for-neovim-plugins-in-lua">2n.pl
- å¦‚ä½•ä½¿ç”¨ Lua åˆ¶ä½œ neovim UI</a></li>
<li><a target="_blank" rel="noopener" href="https://ms-jpq.github.io/lua-async-await/index.html">ms-jpq
- NeoVim å¼‚æ­¥æ•™ç¨‹</a></li>
</ul>
<h3 id="ç›¸å…³æ’ä»¶">ç›¸å…³æ’ä»¶</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/svermeulen/vimpeccable">Vimpeccable</a>
- Plugin to help write your .vimrc in Lua</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim">plenary.nvim</a>
- All the lua functions I don't want to write twice</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nvim-lua/popup.nvim">popup.nvim</a> - An
implementation of the Popup API from vim in Neovim</li>
<li><a target="_blank" rel="noopener" href="https://github.com/norcalli/nvim_utils">nvim_utils</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bfredl/nvim-luadev">nvim-luadev</a> -
REPL/debug console for nvim lua plugins</li>
<li><a target="_blank" rel="noopener" href="https://github.com/rafcamlet/nvim-luapad">nvim-luapad</a> -
Interactive real time neovim scratchpad for embedded lua engine</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tjdevries/nlua.nvim">nlua.nvim</a> - Lua
Development for Neovim</li>
<li><a
target="_blank" rel="noopener" href="https://github.com/glepnir/galaxyline.nvim">galaxyline.nvim</a> -
neovim statusline plugin written in lua</li>
<li><a
target="_blank" rel="noopener" href="https://github.com/euclidianAce/BetterLua.vim">BetterLua.vim</a> -
Better Lua syntax highlighting in Vim/NeoVim</li>
</ul>
<h2 id="lua-æ–‡ä»¶ä½ç½®">Lua æ–‡ä»¶ä½ç½®</h2>
<h3 id="init.lua">init.lua</h3>
<p>Neovim æ”¯æŒä» <code>init.lua</code> æ–‡ä»¶åŠ è½½é…ç½®è€Œä¸æ˜¯é€šå¸¸çš„
<code>init.vim</code> æ–‡ä»¶ã€‚</p>
<p>æ³¨æ„ï¼š<code>init.lua</code> æ–‡ä»¶æ˜¯å®Œå…¨å¯é€‰çš„ã€‚Neovim ä»ç„¶æ”¯æŒä»
<code>init.vim</code> åŠ è½½é…ç½®ã€‚è¯·è®°ä½ï¼ŒNeovim çš„ä¸€äº›åŠŸèƒ½è¿˜æ²¡æœ‰ 100%
æš´éœ²ç»™ Lua æ¨¡å—éƒ¨åˆ†ã€‚</p>
<h3 id="æ¨¡å—">æ¨¡å—</h3>
<p>Lua æ¨¡å—é€šå¸¸ä½äºæ‚¨çš„ <code>runtimepath</code> ä¸­çš„ <code>lua/</code>
æ–‡ä»¶å¤¹ä¸­ï¼ˆå¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¥è¯´ï¼Œåœ¨ *nix ç³»ç»Ÿä¸Šä¸º
<code>~/.config/nvim/lua</code>ï¼Œåœ¨ Windows ç³»ç»Ÿä¸Šä¸º
<code>~/appdata/Local/nvim/lua</code>)ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥
<code>require()</code> è¿™äº›æ–‡ä»¶ä½œä¸º Lua æ¨¡å—</p>
<p>æˆ‘ä»¬ä»¥ä¸‹é¢çš„æ–‡ä»¶å¤¹ç»“æ„ä¸ºä¾‹ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ğŸ“‚ ~/.config/nvim</span><br><span class="line">â”œâ”€â”€ ğŸ“ after</span><br><span class="line">â”œâ”€â”€ ğŸ“ ftplugin</span><br><span class="line">â”œâ”€â”€ ğŸ“‚ lua</span><br><span class="line">â”‚  â”œâ”€â”€ ğŸŒ‘ myluamodule.lua</span><br><span class="line">â”‚  â””â”€â”€ ğŸ“‚ other_modules</span><br><span class="line">â”‚     â”œâ”€â”€ ğŸŒ‘ anothermodule.lua</span><br><span class="line">â”‚     â””â”€â”€ ğŸŒ‘ init.lua</span><br><span class="line">â”œâ”€â”€ ğŸ“ pack</span><br><span class="line">â”œâ”€â”€ ğŸ“ plugin</span><br><span class="line">â”œâ”€â”€ ğŸ“ syntax</span><br><span class="line">â””â”€â”€ ğŸ‡» init.vim</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢çš„ Lua ä»£ç å°†åŠ è½½ <code>myluamodule.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;myluamodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æ²¡æœ‰ <code>.lua</code> æ‰©å±•åã€‚</p>
<p>ç±»ä¼¼åœ°ï¼ŒåŠ è½½ <code>other_modules/anothermodule.lua</code>
çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules.anothermodule&#x27;</span>)</span><br><span class="line"><span class="comment">-- or</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules/anothermodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>è·¯å¾„åˆ†éš”ç¬¦å¯ä»¥ç”¨ç‚¹ <code>.</code> è¡¨ç¤ºï¼Œä¹Ÿå¯ä»¥ç”¨æ–œæ  <code>/</code>
è¡¨ç¤ºã€‚</p>
<p>æ–‡ä»¶å¤¹å¦‚æœåŒ…å« <code>init.lua</code>
æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨è¯¥æ–‡ä»¶å¤¹è€Œä¸å¿…æŒ‡å®šè¯¥æ–‡ä»¶çš„åç§°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules&#x27;</span>) <span class="comment">-- loads other_modules/init.lua</span></span><br></pre></td></tr></table></figure>
<p>åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ¨¡å—æˆ–è€…åŠ è½½çš„æ¨¡å—æœ‰è¯­æ³•é”™è¯¯ä¼šç›´æ¥ä¸­æ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬ã€‚<code>pcall()</code>
å‡½æ•°å¯ä»¥ç”¨æ¥å¤„ç†è¿™ç±»é”™è¯¯</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ok, _ = <span class="built_in">pcall</span>(<span class="built_in">require</span>, <span class="string">&#x27;module_with_error&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- not loaded</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-require"><code>:help lua-require</code></a></li>
</ul>
<h4 id="æç¤º">æç¤º</h4>
<p>å¤šä¸ª Lua æ’ä»¶åœ¨å®ƒä»¬çš„ <code>lua/</code>
æ–‡ä»¶å¤¹ä¸­å¯èƒ½æœ‰ç›¸åŒçš„æ–‡ä»¶åã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´å‘½åç©ºé—´å†²çªã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„æ’ä»¶æœ‰ä¸€ä¸ª
<code>lua/main.lua</code> æ–‡ä»¶ï¼Œé‚£ä¹ˆæ‰§è¡Œ <code>require('main')</code>
æ˜¯ä¸æ˜ç¡®çš„ï¼šæˆ‘ä»¬æƒ³è¦åŠ è½½å“ªä¸ªæ–‡ä»¶ï¼Ÿæœ€å¥½å°†æ‚¨çš„é…ç½®æˆ–æ’ä»¶å‘½åä¸ºé¡¶çº§æ–‡ä»¶å¤¹ï¼Œ
ä¾‹å¦‚è¿™æ ·çš„å½¢å¼ï¼š<code>lua/plugin_name/main.lua</code>ã€‚</p>
<h3 id="è¿è¡Œæ—¶æ–‡ä»¶">è¿è¡Œæ—¶æ–‡ä»¶</h3>
<p>å’Œ Vimscript æ–‡ä»¶å¾ˆåƒï¼Œä½äº <code>runtimepath</code>
ä¸­çš„ä¸€äº›ç‰¹æ®Šç›®å½•ä¸­çš„ Lua æ–‡ä»¶å¯ä»¥è¢« Neovim
è‡ªåŠ¨åŠ è½½ã€‚ç›®å‰æœ‰ä»¥ä¸‹è¿™äº›ç‰¹æ®Šç›®å½•ï¼š</p>
<ul>
<li><code>colors/</code></li>
<li><code>compiler/</code></li>
<li><code>ftplugin/</code></li>
<li><code>indent/</code></li>
<li><code>plugin/</code></li>
<li><code>syntax/</code></li>
</ul>
<p>æ³¨æ„ï¼šåœ¨åŒä¸€ä¸ªè¿è¡Œæ—¶ç›®å½•ä¸­ï¼Œ<code>*.vim</code> æ–‡ä»¶ä¼šå…ˆäºæ‰€æœ‰çš„
<code>*.lua</code> æ–‡ä»¶è¢«åŠ è½½ã€‚</p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/options.html#&#39;runtimepath&#39;"><code>:help 'runtimepath'</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/starting.html#load-plugins"><code>:help load-plugins</code></a></li>
</ul>
<h4 id="æç¤º-1">æç¤º</h4>
<p>å› ä¸ºè¿è¡Œæ—¶æ–‡ä»¶å¹¶ä¸åŸºäº Lua æ¨¡å—ç³»ç»Ÿï¼Œæ‰€ä»¥ä¸¤ä¸ªä¸åŒçš„æ’ä»¶éƒ½æ‹¥æœ‰
<code>plugins/main.lua</code> æ–‡ä»¶æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚</p>
<h2 id="åœ¨-vimscript-ä¸­ä½¿ç”¨-lua">åœ¨ Vimscript ä¸­ä½¿ç”¨ Lua</h2>
<h3 id="lua">:lua</h3>
<p>è¯¥å‘½ä»¤æ‰§è¡Œä¸€æ®µ Lua ä»£ç </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> require(<span class="string">&#x27;myluamodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ç¼–å†™å¤šè¡Œè„šæœ¬ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Here&#x27;s a bigger chunk of Lua code&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line">local <span class="keyword">mod</span> = require(<span class="string">&#x27;mymodule&#x27;</span>)</span><br><span class="line">local tbl = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">k</span>, v in ipairs(tbl) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">mod</span>.method(v)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(tbl)</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šæ¯ä¸ª <code>:lua</code> å‘½ä»¤éƒ½æœ‰å®ƒè‡ªå·±ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œåœ¨ä¸€æ¡
<code>:lua</code> å‘½ä»¤ä¸­ä½¿ç”¨ <code>local</code>
å…³é”®å­—å£°æ˜çš„å˜é‡æ˜¯æ— æ³•åœ¨è¿™æ¡å‘½ä»¤ä¹‹å¤–è®¿é—®çš„ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤º</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> local foo = <span class="number">1</span></span><br><span class="line">:<span class="keyword">lua</span> <span class="keyword">print</span>(foo)</span><br><span class="line"><span class="comment">&quot; prints &#x27;nil&#x27; instead of &#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šLua ä¸­çš„ <code>print()</code> å‡½æ•°çš„è¡Œä¸ºç±»ä¼¼äº
<code>:echomsg</code> å‘½ä»¤ã€‚å®ƒçš„è¾“å‡ºä¼šè¢«ä¿å­˜åœ¨æ¶ˆæ¯å†å²ä¸­ï¼Œå¯ä»¥ä½¿ç”¨
<code>:slient</code> å‘½ä»¤æ¥æŠ›å¼ƒè¾“å‡ºã€‚</p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#Lua"><code>:help :lua</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:lua-heredoc"><code>:help :lua-heredoc</code></a></li>
</ul>
<h3 id="luado">:luado</h3>
<p>è¯¥å‘½ä»¤æ‰§è¡Œä¸€æ®µ Lua
ä»£ç ï¼Œè¯¥ä»£ç ä½œç”¨äºå½“å‰ç¼“å†²åŒºä¸­çš„é€‰ä¸­çš„è¡Œã€‚å¦‚æœæœªæŒ‡å®šèŒƒå›´ï¼Œåˆ™æ”¹ä¸ºä½¿ç”¨æ•´ä¸ªç¼“å†²åŒºã€‚ä»å—
<code>return</code> çš„ä»»ä½•å­—ç¬¦ä¸²éƒ½ç”¨äºç¡®å®šåº”è¯¥ç”¨ä»€ä¹ˆæ›¿æ¢æ¯è¡Œã€‚</p>
<p>ä»¥ä¸‹å‘½ä»¤ä¼šå°†å½“å‰ç¼“å†²åŒºä¸­çš„æ¯ä¸€è¡Œæ›¿æ¢ä¸ºæ–‡æœ¬
<code>hello world</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luado</span> <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æä¾›äº†ä¸¤ä¸ªéšå¼çš„ <code>line</code> å’Œ <code>linenr</code>
å˜é‡ã€‚<code>line</code> æ˜¯è¢«è¿­ä»£çš„è¡Œçš„æ–‡æœ¬ï¼Œè€Œ <code>linenr</code>
æ˜¯å®ƒçš„ç¼–å·ã€‚ä»¥ä¸‹å‘½ä»¤å°†å¯ä»¥è¢« 2 æ•´æ•°çš„è¡Œè½¬æˆå¤§å†™ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luado</span> <span class="keyword">if</span> linenr % <span class="number">2</span> == <span class="number">0</span> then <span class="keyword">return</span> <span class="built_in">line</span>:upper() end</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:luado"><code>:help :luado</code></a></li>
</ul>
<h3 id="åŠ è½½-lua-æ–‡ä»¶">åŠ è½½ Lua æ–‡ä»¶</h3>
<p>Neovim æä¾›äº†ä¸‰ç§æ‰§è¡Œå‘½ä»¤æ¥åŠ è½½ Lua æ–‡ä»¶</p>
<ul>
<li><code>:luafile</code></li>
<li><code>:source</code></li>
<li><code>:runtime</code></li>
</ul>
<p>å…¶ä¸­ <code>:luafile</code> å’Œ <code>:source</code> éå¸¸ç±»ä¼¼ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luafile</span> ~/foo/bar/baz/myluafile.<span class="keyword">lua</span> <span class="comment">&quot; åŠ è½½ myluafile.lua</span></span><br><span class="line">:<span class="keyword">luafile</span> %                           <span class="comment">&quot; åŠ è½½å½“å‰æ­£åœ¨å¤„ç†çš„æ–‡ä»¶</span></span><br><span class="line">:<span class="keyword">source</span> ~/foo/bar/baz/myluafile.<span class="keyword">lua</span></span><br><span class="line">:<span class="keyword">source</span> %</span><br></pre></td></tr></table></figure>
<p>ä¸¤ç§å‘½ä»¤éƒ½å¯ä»¥æŒ‡å®šæ–‡ä»¶èŒƒå›´ï¼Œå¯ä»¥åªæ‰§è¡Œè„šæœ¬çš„ä¸€éƒ¨åˆ†</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1</span>,<span class="number">10</span><span class="keyword">source</span></span><br></pre></td></tr></table></figure>
<p><code>:runtime</code> ä¸ä¸Šè¿°ä¸¤ç§å‘½ä»¤æœ‰æ‰€ä¸åŒï¼Œå®ƒä½¿ç”¨
<code>'runtimepath'</code> é€‰é¡¹æ¥å†³å®šåŠ è½½å“ªä¸ªæ–‡ä»¶ã€‚æ›´å¤šç»†èŠ‚ä¿¡æ¯è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:runtime"><code>:help :runtime</code></a></p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:luafile"><code>:help :luafile</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:source"><code>:help :source</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:runtime"><code>:help :runtime</code></a></li>
</ul>
<h4 id="åŠ è½½-lua-æ–‡ä»¶å¯¹æ¯”-require">åŠ è½½ Lua æ–‡ä»¶å¯¹æ¯” require():</h4>
<p>æ‚¨å¯èƒ½æƒ³çŸ¥é“è°ƒç”¨ <code>require()</code>
å‡½æ•°å’Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤åŠ è½½ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œä»¥åŠæ‚¨æ˜¯å¦åº”è¯¥ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªè€Œä¸æ˜¯å¦ä¸€ä¸ªã€‚å®ƒä»¬æœ‰ä¸åŒçš„ä½¿ç”¨æƒ…å½¢ï¼š</p>
<ul>
<li><code>require()</code>:
<ul>
<li>æ˜¯å†…ç½®çš„ Lua å‡½æ•°ï¼Œå®ƒå…è®¸ä½ ä½¿ç”¨ Lua çš„æ¨¡å—ç³»ç»Ÿ</li>
<li>åœ¨ <code>'runtimepath'</code> ä¸­çš„ <code>lua/</code>
æ–‡ä»¶å¤¹ä¸­æœç´¢æ¨¡å—</li>
<li>è·Ÿè¸ªå·²åŠ è½½çš„æ¨¡å—ï¼Œå¹¶é˜²æ­¢ç¬¬äºŒæ¬¡è§£æå’Œæ‰§è¡Œè„šæœ¬ã€‚å¦‚æœæ‚¨æ›´æ”¹åŒ…å«æŸä¸ªæ¨¡å—ä»£ç çš„æ–‡ä»¶ï¼Œå¹¶åœ¨
Neovim è¿è¡Œæ—¶å†æ¬¡å°è¯•
<code>required()</code>ï¼Œåˆ™è¯¥æ¨¡å—å®é™…ä¸Šä¸ä¼šæ›´æ–°</li>
</ul></li>
<li><code>:luafile</code>/<code>:source</code>/<code>:runtime</code>:
<ul>
<li>æ˜¯ä¸€ä¸ªæ‰§è¡Œå‘½ä»¤ï¼Œå®ƒä¸æ”¯æŒæ¨¡å—</li>
<li>æ‰§è¡Œè„šæœ¬çš„å†…å®¹ï¼Œè€Œä¸ç®¡è¯¥è„šæœ¬ä»¥å‰æ˜¯å¦æ‰§è¡Œè¿‡</li>
<li><code>:luafile</code>/<code>:source</code>
å‘½ä»¤é‡‡ç”¨ç›¸å¯¹äºå½“å‰çª—å£çš„å·¥ä½œç›®å½•çš„ç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„</li>
<li><code>:runtime</code> å‘½ä»¤ä½¿ç”¨ <code>'runtimepath'</code>
é€‰é¡¹æ¥å¯»æ‰¾æ–‡ä»¶</li>
</ul></li>
</ul>
<p>åŒæ—¶ï¼Œé€šè¿‡ <code>:source</code>/<code>:runtime</code> å‘½ä»¤ï¼ˆä¸åŒ…æ‹¬
<code>:luafile</code> ï¼‰åŠ è½½æˆ–è€…ä»è¿è¡Œæ—¶ç›®å½•è¢«è‡ªåŠ¨åŠ è½½çš„æ–‡ä»¶ä¼šæ˜¾ç¤ºåœ¨
<code>:scriptnames</code> å’Œ <code>--startuptime</code> ä¸­ã€‚</p>
<h3 id="luaeval">luaeval()</h3>
<p><code>luaeval()</code> æ˜¯å†…ç½®çš„ Vimscript å‡½æ•°è®¡ç®— Lua
è¡¨è¾¾å¼å­—ç¬¦ä¸²å¹¶è¿”å›å®ƒçš„å€¼ã€‚Lua çš„æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º Vimscript
ç±»å‹ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot; ä½ å¯ä»¥å°†ç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªå˜é‡ä¸­</span></span><br><span class="line"><span class="keyword">let</span> variable = <span class="built_in">luaeval</span>(<span class="string">&#x27;1 + 1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> variable</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"><span class="keyword">let</span> concat = <span class="built_in">luaeval</span>(<span class="string">&#x27;&quot;Lua&quot;..&quot; is &quot;..&quot;awesome&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> concat</span><br><span class="line"><span class="comment">&quot; &#x27;Lua is awesome&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Lua ä¸­çš„ table æ•°ç»„è½¬æˆæˆ Vimscript çš„ list</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">list</span> = <span class="built_in">luaeval</span>(<span class="string">&#x27;&#123;1, 2, 3, 4&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">list</span>[<span class="number">0</span>]</span><br><span class="line"><span class="comment">&quot; 1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">list</span>[<span class="number">1</span>]</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"><span class="comment">&quot; æ³¨æ„ Vimscript çš„æ•°ç»„ç´¢å¼•ä¸‹æ ‡ä¸ Lua ä¸åŒæ˜¯ä» 0 å¼€å§‹çš„ï¼ŒLua ä¸­æ˜¯ä» 1 å¼€å§‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Lua ä¸­ç±»ä¼¼ dict çš„ table ä¼šè¢«è½¬æˆ Vimscript ä¸­çš„ dict</span></span><br><span class="line"><span class="keyword">let</span> dict = <span class="built_in">luaeval</span>(<span class="string">&#x27;&#123;foo = &quot;bar&quot;, baz = &quot;qux&quot;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> dict.foo</span><br><span class="line"><span class="comment">&quot; &#x27;bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; å¸ƒå°”ç±»å‹å’Œ nil æ˜¯ç±»ä¼¼çš„</span></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;true&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; v:true</span></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;nil&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; v:null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; æ‚¨å¯ä»¥ä¸º Lua å‡½æ•°åˆ›å»º Vimscript åˆ«å</span></span><br><span class="line"><span class="keyword">let</span> LuaMathPow = <span class="built_in">luaeval</span>(<span class="string">&#x27;math.pow&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> LuaMathPow(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">&quot; 4</span></span><br><span class="line"><span class="keyword">let</span> LuaModuleFunction = <span class="built_in">luaeval</span>(<span class="string">&#x27;require(&quot;mymodule&quot;).myfunction&#x27;</span>)</span><br><span class="line"><span class="keyword">call</span> LuaModuleFunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; è¿˜å¯ä»¥å°† Lua å‡½æ•°ä½œä¸ºå€¼ä¼ é€’ç»™ Vim å‡½æ•°</span></span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">X</span> = <span class="keyword">function</span>(<span class="keyword">k</span>, v) <span class="keyword">return</span> <span class="built_in">string</span>.format(<span class="string">&quot;%s:%s&quot;</span>, <span class="keyword">k</span>, v) end</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">map</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="built_in">luaeval</span>(<span class="string">&quot;X&quot;</span>))</span><br></pre></td></tr></table></figure>
<p><code>luaeval()</code>
æ¥å—å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè¯¥å‚æ•°å…è®¸æ‚¨å°†æ•°æ®ä¼ é€’ç»™è¡¨è¾¾å¼ã€‚ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨å…¨å±€çš„
<code>_A</code> ä» Lua è®¿é—®è¯¥æ•°æ®ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;_A[1] + _A[2]&#x27;</span>, [<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;string.format(&quot;Lua is %s&quot;, _A)&#x27;</span>, <span class="string">&#x27;awesome&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; &#x27;Lua is awesome&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#luaeval()"><code>:help luaeval()</code></a></p>
<h3 id="vlua">v:lua</h3>
<p>è¿™ä¸ªå…¨å±€ Vim å˜é‡å…è®¸æ‚¨ç›´æ¥ä» Vimscript è°ƒç”¨å…¨å±€ Lua å‡½æ•°ï¼ˆ<a
target="_blank" rel="noopener" href="https://www.lua.org/manual/5.1/manual.html#pdf-_G"><code>_G</code></a>ï¼‰ã€‚åŒæ ·
Vim æ•°æ®ç±»å‹è¢«è½¬æ¢ä¸º Lua ç±»å‹ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.<span class="keyword">print</span>(<span class="string">&#x27;Hello from Lua!&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; &#x27;Hello from Lua!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scream = <span class="variable">v:lua</span>.<span class="built_in">string</span>.rep(<span class="string">&#x27;A&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">echo</span> scream</span><br><span class="line"><span class="comment">&quot; &#x27;AAAAAAAAAA&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Requiring modules works</span></span><br><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.require(<span class="string">&#x27;mymodule&#x27;</span>).myfunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; How about a nice statusline?</span></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line"><span class="keyword">function</span> _G.statusline()</span><br><span class="line">    local filepath = <span class="string">&#x27;%f&#x27;</span></span><br><span class="line">    local align_section = <span class="string">&#x27;%=&#x27;</span></span><br><span class="line">    local percentage_through_file = <span class="string">&#x27;%p%%&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">string</span>.format(</span><br><span class="line">        <span class="string">&#x27;%s%s%s&#x27;</span>,</span><br><span class="line">        filepath,</span><br><span class="line">        align_section,</span><br><span class="line">        percentage_through_file</span><br><span class="line">    )</span><br><span class="line">end</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> statusline=%!<span class="variable">v:lua</span>.statusline()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Also works in expression mappings</span></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line"><span class="keyword">function</span> _G.check_back_space()</span><br><span class="line">    local <span class="keyword">col</span> = <span class="keyword">vim</span>.fn.<span class="keyword">col</span>(<span class="string">&#x27;.&#x27;</span>) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">col</span> == <span class="number">0</span> <span class="built_in">or</span> <span class="keyword">vim</span>.fn.<span class="built_in">getline</span>(<span class="string">&#x27;.&#x27;</span>):sub(<span class="keyword">col</span>, <span class="keyword">col</span>):<span class="keyword">match</span>(<span class="string">&#x27;%s&#x27;</span>) then</span><br><span class="line">        <span class="keyword">return</span> true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> false</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;Tab&gt;</span></span><br><span class="line">    \ <span class="built_in">pumvisible</span>() ? <span class="string">&#x27;\&lt;C-n&gt;&#x27;</span> :</span><br><span class="line">    \ <span class="variable">v:lua</span>.check_back_space() ? <span class="string">&#x27;\&lt;Tab&gt;&#x27;</span> :</span><br><span class="line">    \ completion#trigger_completion()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; é€šè¿‡ä½¿ç”¨å•å¼•å·åŒ…å›´æ¨¡å—åå¹¶çœç•¥ require çš„æ‹¬å·æ¥è°ƒç”¨ Lua æ¨¡å—ä¸­çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.require<span class="string">&#x27;module&#x27;</span>.foo()</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#v:lua"><code>:help v:lua</code></a>
- <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#v:lua-call"><code>:help v:lua-call</code></a></p>
<h4 id="caveats">Caveats</h4>
<p><code>v:lua</code> å˜é‡åªèƒ½ç”¨äºè°ƒç”¨å‡½æ•°ã€‚ä»¥ä¸‹ä»£ç å°†å§‹ç»ˆå¼•å‘é”™è¯¯ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot; ä¸é€‚ç”¨äºåˆ«åä¸€ä¸ªå‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> LuaPrint = <span class="variable">v:lua</span>.<span class="keyword">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; ä¸é€‚ç”¨äºè®¿é—® dict</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">v:lua</span>.some_global_dict[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; ä¸é€‚ç”¨äºå°†å‡½æ•°ä½œä¸ºå€¼ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">map</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="variable">v:lua</span>.global_callback)</span><br></pre></td></tr></table></figure>
<h4 id="æç¤º-2">æç¤º</h4>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® <code>let g:vimsyn_embed = 'l'</code> å®ç°
.vim æ–‡ä»¶ä¸­çš„ Lua è¯­æ³•é«˜äº®ã€‚å…³äºæ­¤é€‰é¡¹çš„æ›´å¤šä¿¡æ¯è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/syntax.html#g:vimsyn_embed"><code>:help g:vimsyn_embed</code></a></p>
<h2 id="vim-å‘½åç©ºé—´">Vim å‘½åç©ºé—´</h2>
<p>Neovim ä¼šæš´éœ²ä¸€ä¸ªå…¨å±€çš„ <code>vim</code> å˜é‡æ¥ä½œä¸º Lua è°ƒç”¨ Vim çš„
APIs çš„å…¥å£ã€‚å®ƒè¿˜æä¾›ç»™ç”¨æˆ·ä¸€äº›é¢å¤–çš„å‡½æ•°å’Œå­æ¨¡å—â€œæ ‡å‡†åº“â€</p>
<p>ä¸€äº›æ¯”è¾ƒå®ç”¨çš„å‡½æ•°å’Œå­æ¨¡å—å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>vim.inspect</code>: æŠŠ Lua å¯¹è±¡ä»¥æ›´æ˜“è¯»çš„æ–¹å¼æ‰“å°ï¼ˆåœ¨æ‰“å° Lua
table æ—¶ä¼šå¾ˆæœ‰ç”¨ï¼‰</li>
<li><code>vim.regex</code>: åœ¨ Lua ä¸­ä½¿ç”¨ Vim æ­£åˆ™è¡¨è¾¾å¼</li>
<li><code>vim.api</code>: æš´éœ² vim çš„ API(<code>:h API</code>)
çš„æ¨¡å—ï¼ˆåˆ«çš„è¿œç¨‹è°ƒç”¨ä¹Ÿæ˜¯è°ƒç”¨åŒæ ·çš„ API)</li>
<li><code>vim.ui</code>: å¯è¢«æ’ä»¶è¦†å†™çš„ UI ç›¸å…³å‡½æ•°</li>
<li><code>vim.loop</code>: Neovim çš„ event lopp æ¨¡å—ï¼ˆä½¿ç”¨ LibUV)</li>
<li><code>vim.lsp</code>: æ§åˆ¶å†…ç½® LSP å®¢æˆ·ç«¯çš„æ¨¡å—</li>
<li><code>vim.treesitter</code>: æš´éœ² tree-sitter
åº“ä¸­ä¸€äº›å®ç”¨å‡½æ•°çš„æ¨¡å—</li>
</ul>
<p>ä¸Šé¢åˆ—ä¸¾åŠŸèƒ½çš„å¹¶ä¸å…¨é¢ã€‚å¦‚æœä½ æƒ³çŸ¥é“æ›´å¤šå¯è¡Œçš„æ“ä½œå¯ä»¥å‚è§ï¼š<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-stdlib"><code>:help lua-stdlib</code></a>
å’Œ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim"><code>:help lua-vim</code></a>ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡
<code>:lua print(vim.inspect(vim))</code> è·å¾—æ‰€æœ‰å¯ç”¨æ¨¡å—ã€‚API
å‡½æ•°çš„è¯¦ç»†æ–‡æ¡£è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#api-global"><code>:help api-global</code></a></p>
<h4 id="tips">Tips</h4>
<p>æ¯æ¬¡ä½ æƒ³æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ—¶åˆ°è¦ç”¨ <code>print(vim.inspect(x))</code>
æ˜¯ç›¸å½“ç¹ççš„ã€‚ä½ å¯ä»¥ä½ çš„é…ç½®ä¸­å†™ä¸€ä¸ªå…¨å±€çš„åŒ…è£…å™¨å‡½æ•°æ¥æ›¿ä»£è¿™ä¸ªç¹ççš„è¿‡ç¨‹ï¼ˆåœ¨
Neovim 0.7.0+ ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…å»ºçš„ <code>vim.pretty_print()</code>
ï¼Œè¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.pretty_print()"><code>:help vim.pretty_print()</code></a>ï¼‰</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.put</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> objects = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">select</span>(<span class="string">&#x27;#&#x27;</span>, ...) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> v = <span class="built_in">select</span>(i, ...)</span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">insert</span>(objects, vim.inspect(v))</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     <span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">concat</span>(objects, <span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">     <span class="keyword">return</span> ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹åä½ å°±å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å¿«é€Ÿæ£€æŸ¥å¯¹è±¡å†…å®¹äº†</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> <span class="keyword">put</span>(<span class="keyword">vim</span>.loop)</span><br></pre></td></tr></table></figure>
<p>æ­¤å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>:lua</code> å‘½ä»¤é€šè¿‡åœ¨ Lua è¡¨è¾¾å¼å‰åŠ ä¸Š
<code>=</code> æ¥ç¾è§‚åœ°æ‰“å°å®ƒ</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> =<span class="keyword">vim</span>.loop</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¦æ³¨æ„çš„æ˜¯ï¼Œä½ å¯èƒ½ä¼šå‘ç° Lua
ä¼šæ¯”å…¶ä»–è¯­è¨€å°‘ä¸€äº›å®ç”¨çš„å†…ç½®å‡½æ•°ï¼ˆä¾‹å¦‚ï¼š<code>os.clock()</code>ï¼Œè¿”å›ä»¥ç§’ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯ä»¥æ¯«ç§’ä¸ºå•ä½çš„å€¼ï¼‰ã€‚ä»”ç»†é˜…è¯»
Neovim æä¾›çš„æ ‡å‡†åº“å’Œ <code>vim.fn</code>
ï¼ˆåç»­è¿˜ä¼šæœ‰æ›´å¤šå†…å®¹ï¼‰ï¼Œé‡Œé¢å¯ä»¥ä¼šæœ‰ä½ æƒ³è¦çš„ä¸œè¥¿ã€‚</p>
<h2 id="åœ¨-lua-ä¸­ä½¿ç”¨-vimscript">åœ¨ Lua ä¸­ä½¿ç”¨ Vimscript</h2>
<h3 id="vim.api.nvim_eval">vim.api.nvim_eval()</h3>
<p>æ­¤å‡½æ•°è®¡ç®— Vimscript è¡¨è¾¾å¼å­—ç¬¦ä¸²å¹¶è¿”å›å…¶å€¼ã€‚Vimscript
æ•°æ®ç±»å‹è‡ªåŠ¨è½¬æ¢ä¸º Lua ç±»å‹ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚</p>
<p>å®ƒç­‰åŒäº vimscript ä¸­çš„ <code>luaeval()</code> å‡½æ•°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Data types are converted correctly</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;1 + 1&#x27;</span>)) <span class="comment">-- 2</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_eval(<span class="string">&#x27;[1, 2, 3]&#x27;</span>))) <span class="comment">-- &#123; 1, 2, 3 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_eval(<span class="string">&#x27;&#123;&quot;foo&quot;: &quot;bar&quot;, &quot;baz&quot;: &quot;qux&quot;&#125;&#x27;</span>))) <span class="comment">-- &#123; baz = &quot;qux&quot;, foo = &quot;bar&quot; &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;v:true&#x27;</span>)) <span class="comment">-- true</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;v:null&#x27;</span>)) <span class="comment">-- nil</span></span><br></pre></td></tr></table></figure>
<h4 id="caveats-1">Caveats</h4>
<p>ä¸ <code>luaeval()</code> ä¸åŒï¼Œ<code>vim.api.nvim_eval()</code>
ä¸æä¾›éšå¼ <code>_A</code> å˜é‡æ¥ä¼ é€’æ•°æ®ç»™è¡¨è¾¾å¼ã€‚</p>
<h3 id="vim.api.nvim_exec">vim.api.nvim_exec()</h3>
<p>æ­¤å‡½æ•°ç”¨äºè®¡ç®— Vimscript
ä»£ç å—ã€‚å®ƒæ¥å—ä¸€ä¸ªåŒ…å«è¦æ‰§è¡Œçš„æºä»£ç çš„å­—ç¬¦ä¸²å’Œä¸€ä¸ªå¸ƒå°”å€¼ï¼Œä»¥ç¡®å®šä»£ç çš„è¾“å‡ºæ˜¯å¦åº”è¯¥ç”±å‡½æ•°è¿”å›ï¼ˆä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†è¾“å‡ºå­˜å‚¨åœ¨å˜é‡ä¸­ï¼‰ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> result = vim.api.nvim_exec(</span><br><span class="line"><span class="string">[[</span></span><br><span class="line"><span class="string">let mytext = &#x27;hello world&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function! MyFunction(text)</span></span><br><span class="line"><span class="string">    echo a:text</span></span><br><span class="line"><span class="string">endfunction</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">call MyFunction(mytext)</span></span><br><span class="line"><span class="string">]]</span>,</span><br><span class="line"><span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment">-- &#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="caveats-2">Caveats</h4>
<p>åœ¨ Neovim 0.6.0 ä¹‹å‰ï¼Œ<code>nvim_exec</code> ä¸æ”¯æŒ script-local
çš„å˜é‡ ï¼ˆ<code>s:</code>ï¼‰ ã€‚</p>
<h3 id="vim.api.nvim_command">vim.api.nvim_command()</h3>
<p>æ­¤å‡½æ•°æ‰§è¡Œä¸€ä¸ª EX å‘½ä»¤ã€‚å®ƒæ¥å—åŒ…å«è¦æ‰§è¡Œçš„å‘½ä»¤çš„å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_command(<span class="string">&#x27;new&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;wincmd H&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;set nonumber&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;%s/foo/bar/g&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="vim.cmd">vim.cmd()</h3>
<p><code>vim.api.nvim_exec()</code>
çš„åˆ«åã€‚åªéœ€è¦å‘½ä»¤éƒ¨åˆ†çš„å‚æ•°ï¼Œ<code>output</code> å‚æ•°å§‹ç»ˆä¸º
<code>false</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span>.cmd(<span class="string">&#x27;buffers&#x27;</span>)</span><br><span class="line"><span class="keyword">vim</span>.cmd([[</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:multiline_list</span> = [</span><br><span class="line">            \ <span class="number">1</span>,</span><br><span class="line">            \ <span class="number">2</span>,</span><br><span class="line">            \ <span class="number">3</span>,</span><br><span class="line">            \ ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:multiline_list</span></span><br><span class="line">]])</span><br></pre></td></tr></table></figure>
<h4 id="tips-1">Tips</h4>
<p>ç”±äºæ‚¨å¿…é¡»å°†å­—ç¬¦ä¸²ä¼ é€’ç»™è¿™äº›å‡½æ•°ï¼Œå› æ­¤é€šå¸¸éœ€è¦æ·»åŠ è½¬ä¹‰çš„åæ–œæ ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.cmd(<span class="string">&#x27;%s/\\Vfoo/bar/g&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>éè½¬ä¹‰å­—ç¬¦ä¸²æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œå®ƒä»¬ä¸éœ€è¦é¢å¤–çš„è½¬ä¹‰åæ–œæ ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.cmd(<span class="string">[[%s/\Vfoo/bar/g]]</span>)</span><br></pre></td></tr></table></figure>
<h3
id="vim.api.nvim_replace_termcodes">vim.api.nvim_replace_termcodes()</h3>
<p>è¿™ä¸ª API å‡½æ•°å…è®¸ä½ è½¬ä¹‰ç»ˆç«¯ä»£ç å’Œ Vim é”®ç ã€‚</p>
<p>ä½ å¯èƒ½è§è¿‡è¿™æ ·çš„æ˜ å°„ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;Tab&gt;</span> <span class="built_in">pumvisible</span>() ? <span class="string">&quot;\&lt;C-N&gt;&quot;</span> : <span class="string">&quot;\&lt;Tab&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ Lua ä¸­å®ç°ç›¸åŒçš„åŠŸèƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ã€‚ä½ å¯èƒ½ä¼šåƒè¿™æ ·å®ç°</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.smart_tab</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> <span class="string">[[\&lt;C-N&gt;]]</span> <span class="keyword">or</span> <span class="string">[[\&lt;Tab&gt;]]</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="string">&#x27;v:lua.smart_tab()&#x27;</span>, &#123;expr = <span class="literal">true</span>, noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>ç„¶åä½ ä¼šå‘ç°è¿™æ ·å®ç°ä¸Šè¿°æ˜ å°„åªä¼šå•çº¯æ’å…¥ <code>\&lt;Tab&gt;</code> å’Œ
<code>\&lt;C-N&gt;</code> ä¸¤ä¸ªå­—ç¬¦ä¸²å­—é¢é‡â€¦â€¦</p>
<p>èƒ½å¤Ÿè½¬ä¹‰é”®ç å®é™…ä¸Šæ˜¯ Vimscript çš„ä¸€é¡¹åŠŸèƒ½ã€‚
é™¤äº†è®¸å¤šç¼–ç¨‹è¯­è¨€å¸¸ç”¨çš„è½¬ä¹‰åºåˆ—ï¼ˆå¦‚ <code>\r</code>ã€<code>\42</code> æˆ–
<code>\x10</code>ï¼‰å¤–ï¼ŒVimscript ä¸­çš„
<code>expr-quotes</code>ï¼ˆç”¨åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼‰å…è®¸ä½ è½¬ä¹‰ Vim
é”®ç çš„æ˜“è¯»å½¢å¼ã€‚</p>
<p>Lua ä¸­å¹¶æ²¡æœ‰å†…ç½®è¿™ç§åŠŸèƒ½ã€‚å¹¸è¿çš„æ˜¯ï¼ŒNeovim
æä¾›äº†ä¸€ä¸ªç”¨æ¥è½¬ä¹‰ç»ˆç«¯ä»£ç å’Œ Vim é”®ç çš„ API
å‡½æ•°ï¼š<code>nvim_replace_termcodes()</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.api.nvim_replace_termcodes(<span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>))</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è°ƒç”¨è¿‡äºå†—é•¿ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–¹ä¾¿é‡å¤è°ƒç”¨çš„åŒ…è£…ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The function is called `t` for `termcodes`.</span></span><br><span class="line"><span class="comment">-- You don&#x27;t have to call it that, but I find the terseness convenient</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="comment">-- Adjust boolean arguments as needed</span></span><br><span class="line">    <span class="keyword">return</span> vim.api.nvim_replace_termcodes(str, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t<span class="string">&#x27;&lt;Tab&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>å›åˆ°å…ˆå‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°é‚£ä¸ªæ˜ å°„</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.api.nvim_replace_termcodes(str, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.smart_tab</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> t<span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> t<span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="string">&#x27;v:lua.smart_tab()&#x27;</span>, &#123;expr = <span class="literal">true</span>, noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>vim.keymap.set()</code> å‡½æ•°ï¼ˆNeovim
0.7.0+ï¼‰æ¥è®¾ç½®çš„è¯å°±ä¸éœ€è¦è½¬ä¹‰é”®ç ï¼Œ<code>vim.keymap.set()</code>
é»˜è®¤ä¼šè‡ªåŠ¨è½¬ä¹‰è¿”å›å€¼ä¸­çš„é”®ç ï¼ˆ<code>expr</code> é€‰é¡¹è®¾ç½®ä¸º
<code>true</code>ï¼‰ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> <span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span>, &#123;expr = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/intro.html#keycodes"><code>:help keycodes</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#expr-quote"><code>:help expr-quote</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_replace_termcodes()"><code>:help nvim_replace_termcodes()</code></a></li>
</ul>
<h2 id="ç®¡ç†-vim-çš„è®¾ç½®é€‰é¡¹">ç®¡ç† vim çš„è®¾ç½®é€‰é¡¹</h2>
<h3 id="ä½¿ç”¨-api-å‡½æ•°">ä½¿ç”¨ api å‡½æ•°</h3>
<p>Neovim æä¾›äº†ä¸€ç»„ API å‡½æ•°æ¥è®¾ç½®é€‰é¡¹æˆ–è·å–å…¶å½“å‰å€¼ï¼š</p>
<ul>
<li>å…¨å±€é€‰é¡¹ï¼š
<ul>
<li><code>vim.api.nvim_set_option()</code></li>
<li><code>vim.api.nvim_get_option()</code></li>
</ul></li>
<li>ç¼“å†²åŒºé€‰é¡¹ï¼š
<ul>
<li><code>vim.api.nvim_buf_set_option()</code></li>
<li><code>vim.api.nvim_buf_get_option()</code></li>
</ul></li>
<li>çª—å£é€‰é¡¹ï¼š
<ul>
<li><code>vim.api.nvim_win_set_option()</code></li>
<li><code>vim.api.nvim_win_get_option()</code></li>
</ul></li>
</ul>
<p>å®ƒä»¬æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«è¦è®¾ç½®æˆ–è€…è¦è·å–çš„é€‰é¡¹çš„åç§°ä»¥åŠè¦å°†å…¶è®¾ç½®ä¸ºçš„å€¼ã€‚</p>
<p>å¸ƒå°”é€‰é¡¹ï¼ˆå¦‚ <code>(no)number</code>) å¿…é¡»è®¾ç½®ä¸º <code>true</code> æˆ–
<code>false</code>ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;smarttab&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;smarttab&#x27;</span>)) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<p>å­—ç¬¦ä¸²é€‰é¡¹å¿…é¡»è®¾ç½®ä¸ºå­—ç¬¦ä¸²ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;selection&#x27;</span>, <span class="string">&#x27;exclusive&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;selection&#x27;</span>)) <span class="comment">-- &#x27;exclusive&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ•°å­—é€‰é¡¹å¿…é¡»æ¥å—æ•°å­—ç±»å‹</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;updatetime&#x27;</span>, <span class="number">3000</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;updatetime&#x27;</span>)) <span class="comment">-- 3000</span></span><br></pre></td></tr></table></figure>
<p>Buffer-local å’Œ Window-local é€‰é¡¹è¿˜éœ€è¦ç¼“å†²åŒºç¼–å·æˆ–çª—å£ç¼–å·ï¼ˆä½¿ç”¨
<code>0</code> å°†è®¾ç½® / è·å–å½“å‰ç¼“å†²åŒº / çª—å£çš„é€‰é¡¹ï¼‰ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_win_set_option(<span class="number">0</span>, <span class="string">&#x27;number&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">vim.api.nvim_buf_set_option(<span class="number">10</span>, <span class="string">&#x27;shiftwidth&#x27;</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_win_get_option(<span class="number">0</span>, <span class="string">&#x27;number&#x27;</span>)) <span class="comment">-- true</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_buf_get_option(<span class="number">10</span>, <span class="string">&#x27;shiftwidth&#x27;</span>)) <span class="comment">-- 4</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨å…ƒè®¿é—®å™¨">ä½¿ç”¨å…ƒè®¿é—®å™¨</h3>
<p>å¦‚æœæ‚¨æƒ³ä»¥æ›´â€œæƒ¯ç”¨â€çš„æ–¹å¼è®¾ç½®é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ä¸€äº›å…ƒè®¿é—®å™¨ã€‚å®ƒä»¬æœ¬è´¨ä¸ŠåŒ…è£…äº†ä¸Šè¿°
API å‡½æ•°ï¼Œå¹¶å…è®¸æ‚¨åƒå¤„ç†å˜é‡ä¸€æ ·æ“ä½œé€‰é¡¹ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.o"><code>vim.o</code></a>:
è¡Œä¸ºç±»ä¼¼äº <code>:let &amp;&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.go"><code>vim.go</code></a>:
è¡Œä¸ºç±»ä¼¼äº <code>:let &amp;g:&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.bo"><code>vim.bo</code></a>:
é€‚ç”¨äº buffer-local é€‰é¡¹ï¼Œè¡Œä¸ºç±»ä¼¼äº
<code>:let &amp;l:&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.wo"><code>vim.wo</code></a>:
é€‚ç”¨äº window-local é€‰é¡¹ï¼Œè¡Œä¸ºç±»ä¼¼äº
<code>:let &amp;l:&#123;option-name&#125;</code></li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.o.smarttab = <span class="literal">false</span> <span class="comment">-- let &amp;smarttab = v:false</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.smarttab) <span class="comment">-- false</span></span><br><span class="line">vim.o.isfname = vim.o.isfname .. <span class="string">&#x27;,@-@&#x27;</span> <span class="comment">-- on Linux: let &amp;isfname = &amp;isfname .. &#x27;,@-@&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.isfname) <span class="comment">-- &#x27;@,48-57,/,.,-,_,+,,,#,$,%,~,=,@-@&#x27;</span></span><br><span class="line"></span><br><span class="line">vim.bo.shiftwidth = <span class="number">4</span></span><br><span class="line"><span class="built_in">print</span>(vim.bo.shiftwidth) <span class="comment">-- 4</span></span><br></pre></td></tr></table></figure>
<p>æ‚¨å¯ä»¥ä¸ºç¼“å†²åŒºæœ¬åœ°å’Œçª—å£æœ¬åœ°é€‰é¡¹æŒ‡å®šä¸€ä¸ªæ•°å­—ã€‚å¦‚æœæœªç»™å‡ºç¼–å·ï¼Œåˆ™ä½¿ç”¨å½“å‰ç¼“å†²åŒº
/ çª—å£ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.bo[<span class="number">4</span>].expandtab = <span class="literal">true</span> <span class="comment">-- same as vim.api.nvim_buf_set_option(4, &#x27;expandtab&#x27;, true)</span></span><br><span class="line">vim.wo.number = <span class="literal">true</span> <span class="comment">-- same as vim.api.nvim_win_set_option(0, &#x27;number&#x27;, true)</span></span><br></pre></td></tr></table></figure>
<p>è¿™äº›è®¿é—®å™¨è¿˜æœ‰æ›´ä¸ºå¤æ‚çš„ <code>vim.opt*</code> å˜ä½“ï¼Œå®ƒä»¬ä¸ºåœ¨ Lua
ä¸­è®¾ç½®é€‰é¡¹æä¾›äº†æ›´ä¸ºçµæ´»ä¾¿åˆ©çš„æœºåˆ¶ï¼Œå°±åƒä½ åœ¨ <code>init.vim</code>
ä¸­ä½¿ç”¨çš„
<code>:set</code>/<code>:setglobal</code>/<code>:setlocal</code>:</p>
<ul>
<li><code>vim.opt</code>: è¡Œä¸ºç±»ä¼¼äº <code>:set</code></li>
<li><code>vim.opt_global</code>: è¡Œä¸ºç±»ä¼¼äº <code>:setglobal</code></li>
<li><code>vim.opt_local</code>: è¡Œä¸ºç±»ä¼¼äº <code>:setlocal</code></li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.smarttab = <span class="literal">false</span></span><br><span class="line"><span class="built_in">print</span>(vim.opt.smarttab:get()) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<p>ä¸€äº›é€‰é¡¹ä¹Ÿå¯ä»¥é€šè¿‡ Lua çš„ table æ¥è®¾ç½®ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.completeopt = &#123;<span class="string">&#x27;menuone&#x27;</span>, <span class="string">&#x27;noselect&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.opt.completeopt:get())) <span class="comment">-- &#123; &quot;menuone&quot;, &quot;noselect&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºç±»ä¼¼äº list/map/set
çš„é€‰é¡¹ï¼Œå®ƒä»¬å¯¹åº”çš„åŒ…è£…å™¨è¿˜å®ç°äº†å„ç§æ–¹æ³•ä¸å…ƒæ–¹æ³•ï¼Œè¡Œä¸ºç±»ä¼¼äº Vimscript
ä¸­çš„ <code>:set+=</code>/<code>:set^=</code>/<code>:set-=</code>ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.shortmess:append(&#123; I = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- alternative form:</span></span><br><span class="line">vim.opt.shortmess = vim.opt.shortmess + &#123; I = <span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line">vim.opt.whichwrap:<span class="built_in">remove</span>(&#123; <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;s&#x27;</span> &#125;)</span><br><span class="line"><span class="comment">-- alternative form:</span></span><br><span class="line">vim.opt.whichwrap = vim.opt.whichwrap - &#123; <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;s&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>
<p>å…³äº <code>vim.opt</code> çš„æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.opt"><code>:help vim.opt</code></a></p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim-options"><code>:help lua-vim-options</code></a></li>
</ul>
<h2 id="ç®¡ç†-vim-çš„å†…éƒ¨å˜é‡">ç®¡ç† vim çš„å†…éƒ¨å˜é‡</h2>
<h3 id="ä½¿ç”¨-api-å‡½æ•°-1">ä½¿ç”¨ api å‡½æ•°</h3>
<p>ä¸é€‰é¡¹éå¸¸çš„ç›¸ä¼¼ï¼Œå†…éƒ¨å˜é‡ä¹Ÿæœ‰è‡ªå·±çš„ api å‡½æ•°ï¼š</p>
<ul>
<li>å…¨å±€å˜é‡ (<code>g:</code>):
<ul>
<li><code>vim.api.nvim_set_var()</code></li>
<li><code>vim.api.nvim_get_var()</code></li>
<li><code>vim.api.nvim_del_var()</code></li>
</ul></li>
<li>ç¼“å†²åŒºå˜é‡ (<code>b:</code>):
<ul>
<li><code>vim.api.nvim_buf_set_var()</code></li>
<li><code>vim.api.nvim_buf_get_var()</code></li>
<li><code>vim.api.nvim_buf_del_var()</code></li>
</ul></li>
<li>çª—å£å˜é‡ (<code>w:</code>):
<ul>
<li><code>vim.api.nvim_win_set_var()</code></li>
<li><code>vim.api.nvim_win_get_var()</code></li>
<li><code>vim.api.nvim_win_del_var()</code></li>
</ul></li>
<li>é€‰é¡¹å¡å˜é‡ (<code>t:</code>):
<ul>
<li><code>vim.api.nvim_tabpage_set_var()</code></li>
<li><code>vim.api.nvim_tabpage_get_var()</code></li>
<li><code>vim.api.nvim_tabpage_del_var()</code></li>
</ul></li>
<li>é¢„å®šä¹‰çš„ vim å˜é‡ (<code>v:</code>):
<ul>
<li><code>vim.api.nvim_set_vvar()</code></li>
<li><code>vim.api.nvim_get_vvar()</code></li>
</ul></li>
</ul>
<p>é™¤äº†é¢„å®šä¹‰çš„ Vim å˜é‡å¤–ï¼Œè¿˜å¯ä»¥åˆ é™¤å®ƒä»¬ï¼ˆç­‰åŒäº Vimscript ä¸­çš„
<code>:unlet</code>)ã€‚å±€éƒ¨å˜é‡ (<code>l:</code>)ã€è„šæœ¬å˜é‡
(<code>s:</code>) å’Œå‡½æ•°å‚æ•° (<code>a:</code>) ä¸èƒ½æ“ä½œï¼Œå› ä¸ºå®ƒä»¬åªåœ¨
Vim è„šæœ¬ä¸Šä¸‹æ–‡ä¸­æœ‰æ„ä¹‰ï¼ŒLua æœ‰è‡ªå·±çš„ä½œç”¨åŸŸè§„åˆ™ã€‚
å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰è¿™äº›å˜é‡çš„ä½œç”¨ï¼Œè¯·å‚è€ƒ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#internal-variables"><code>:help internal-variables</code></a>
å¯¹å…¶è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚ è¿™äº›å‡½æ•°æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åŒ…å«è¦è®¾ç½® / è·å– /
åˆ é™¤çš„å˜é‡çš„åç§°ä»¥åŠè¦å°†å…¶è®¾ç½®ä¸ºçš„å€¼ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_var(<span class="string">&#x27;some_global_variable&#x27;</span>, &#123; key1 = <span class="string">&#x27;value&#x27;</span>, key2 = <span class="number">300</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_get_var(<span class="string">&#x27;some_global_variable&#x27;</span>))) <span class="comment">-- &#123; key1 = &quot;value&quot;, key2 = 300 &#125;</span></span><br><span class="line">vim.api.nvim_del_var(<span class="string">&#x27;some_global_variable&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>èŒƒå›´ä¸ºç¼“å†²åŒºã€çª—å£æˆ–é€‰é¡¹å¡çš„å˜é‡ä¼šæ¥å—ä¸€ä¸ªæ•°å­—ç±»å‹çš„å‚æ•° (0
æ„å‘³ç€è®¾ç½® / è·å– / åˆ é™¤å½“å‰ç¼“å†²åŒº / çª—å£ / é€‰é¡¹å¡é¡µçš„å˜é‡ï¼‰ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_win_set_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>, <span class="number">2500</span>)</span><br><span class="line">vim.api.nvim_tab_set_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_win_get_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>)) <span class="comment">-- 2500</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_buf_get_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>)) <span class="comment">-- &#x27;hello world&#x27;</span></span><br><span class="line">vim.api.nvim_win_del_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>)</span><br><span class="line">vim.api.nvim_buf_del_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨å…ƒè®¿é—®å™¨-1">ä½¿ç”¨å…ƒè®¿é—®å™¨</h3>
<p>ä½¿ç”¨è¿™äº›å…ƒè®¿é—®å™¨å¯ä»¥æ›´ç›´è§‚åœ°æ“ä½œå†…éƒ¨å˜é‡ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.g"><code>vim.g</code></a>:
å…¨å±€å˜é‡</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.b"><code>vim.b</code></a>:
ç¼“å†²åŒºå˜é‡</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.w"><code>vim.w</code></a>:
çª—å£å˜é‡</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.t"><code>vim.t</code></a>:
é€‰é¡¹å¡å˜é‡</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.v"><code>vim.v</code></a>:
é¢„å®šä¹‰å˜é‡</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.env"><code>vim.env</code></a>:
ç¯å¢ƒå˜é‡</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim.g.some_global_variable = &#123;</span><br><span class="line">    key1 = <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">    key2 = <span class="number">300</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.g.some_global_variable)) <span class="comment">-- &#123; key1 = &quot;value&quot;, key2 = 300 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- é’ˆå¯¹ç‰¹å®š buffer/window/tabpage çš„å˜é‡ (Neovim 0.6+)</span></span><br><span class="line">vim.b[<span class="number">2</span>].myvar = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ä¸€äº›å˜é‡åå¯èƒ½åŒ…å«ä¸èƒ½åœ¨ Lua
ä¸­ç”¨ä½œæ ‡è¯†ç¬¦çš„å­—ç¬¦ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¯­æ³•æ“ä½œè¿™äº›å˜é‡ï¼š<code>vim.g['my#variable']</code>ã€‚</p>
<blockquote>
<p>åœ¨ Lua ä¸­ï¼Œ<code>some_table.some_item</code> æœ¬è´¨ä¸Šæ˜¯
<code>some_table["some_item"]</code>
çš„è¯­æ³•ç³–ï¼Œæ‰€ä»¥<code>vim.g['my#variable']</code> ä¹Ÿå¯ä»¥å†™ä¸º
<code>vim['g']['my#variable']</code></p>
<p>â€”â€” è¯‘è€…æ³¨</p>
</blockquote>
<p>åˆ é™¤å˜é‡åªéœ€è¦å°†å®ƒçš„å€¼è®¾ç½®ä¸º nil</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.g.some_global_variable = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim-variables"><code>:help lua-vim-variables</code></a></li>
</ul>
<h4 id="caveats-3">Caveats</h4>
<p>æ‚¨ä¸èƒ½ä»å­˜å‚¨åœ¨è¿™äº›å˜é‡ä¹‹ä¸€çš„å­—å…¸ä¸­æ·»åŠ  / æ›´æ–° / åˆ é™¤é”®ã€‚ ä¾‹å¦‚ï¼Œè¿™æ®µ
Vimscript ä»£ç ä¸èƒ½æŒ‰é¢„æœŸå·¥ä½œï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:variable</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.variable.key = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:variable</span></span><br><span class="line"><span class="comment">&quot; &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡æ¥è§£å†³</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:variable</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line">local tmp = <span class="keyword">vim</span>.g.variable</span><br><span class="line">tmp.key = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">vim</span>.g.variable = tmp</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:variable</span></span><br><span class="line"><span class="comment">&quot; &#123;&#x27;key&#x27;: &#x27;a&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ªå·²çŸ¥çš„é—®é¢˜</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/issues/12544">Issue
#12544</a></li>
</ul>
<h2 id="è°ƒç”¨-vimscript-å‡½æ•°">è°ƒç”¨ Vimscript å‡½æ•°</h2>
<h3 id="vim.fn.function">vim.fn.{function}()</h3>
<p><code>vim.fn</code> å¯ä»¥ç”¨æ¥è°ƒç”¨ Vimscript å‡½æ•°ã€‚æ•°æ®ç±»å‹åœ¨ Lua å’Œ
Vimscript ä¹‹é—´è‡ªåŠ¨è½¬æ¢ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.fn.printf(<span class="string">&#x27;Hello from %s&#x27;</span>, <span class="string">&#x27;Lua&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> reversed_list = vim.fn.<span class="built_in">reverse</span>(&#123; <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(reversed_list)) <span class="comment">-- &#123; &quot;c&quot;, &quot;b&quot;, &quot;a&quot; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">print_stdout</span><span class="params">(chan_id, data, name)</span></span></span><br><span class="line">    <span class="built_in">print</span>(data[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.fn.jobstart(<span class="string">&#x27;ls&#x27;</span>, &#123; on_stdout = print_stdout &#125;)</span><br></pre></td></tr></table></figure>
<p>Hashes <code>#</code> ä¸æ˜¯ Lua
ä¸­è¯†åˆ«ç¬¦çš„æœ‰æ•ˆå­—ç¬¦ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ä»¥ä¸‹è¯­æ³•è°ƒç”¨ autoload å‡½æ•°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.fn[<span class="string">&#x27;my#autoload#function&#x27;</span>]()</span><br></pre></td></tr></table></figure>
<p><code>vim.fn</code> çš„åŠŸèƒ½ä¸ <code>vim.call</code>
å®Œå…¨ç›¸åŒï¼Œä½†çœ‹èµ·æ¥æ›´åƒæ˜¯åŸç”Ÿ Lua å‡½æ•°è°ƒç”¨ã€‚</p>
<p>å’Œ <code>vim.api.nvim_call_function</code>
çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œ<code>vim.fn</code>
ä¸­æ•°æ®ç±»å‹çš„è½¬æ¢æ˜¯è‡ªåŠ¨çš„ï¼šå¯¹äºæµ®ç‚¹æ•°ç±»å‹ï¼Œ<code>vim.api.nvim_call_function</code>
ä¼šè¿”å›ä¸€ä¸ª table å¹¶ä¸”å®ƒä¸æ”¯æŒ Lua é—­åŒ…ä½œä¸ºå‚æ•°ï¼›<code>vim.fn</code>
å¯ä»¥ç›´æ¥å¤„ç†è¿™äº›ç±»å‹ã€‚</p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.fn"><code>:help vim.fn</code></a></li>
</ul>
<h4 id="tips-2">Tips</h4>
<p>Neovim
æœ‰ä¸€ä¸ªå¼ºå¤§çš„å†…ç½®å‡½æ•°åº“ï¼Œè¿™äº›å‡½æ•°å¯¹æ’ä»¶éå¸¸æœ‰ç”¨ã€‚æŒ‰å­—æ¯é¡ºåºæ’åˆ—çš„å‡½æ•°åˆ—è¡¨å‚è§
<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#vim-function"><code>:help vim-function</code></a>ï¼ŒæŒ‰ä¸»é¢˜åˆ†ç»„çš„å‡½æ•°åˆ—è¡¨å‚è§<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/usr_41.html#function-list"><code>:help function-list</code></a>ã€‚</p>
<p>Neovim ä¸­çš„ API å‡½æ•°å¯ä»¥é€šè¿‡ <code>vim.api.&#123;..&#125;</code>
çš„æ–¹å¼ç›´æ¥è°ƒç”¨ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#API"><code>:help api</code></a></p>
<h4 id="caveats-4">Caveats</h4>
<p>ä¸€äº›åº”è¯¥è¿”å›å¸ƒå°”å€¼çš„ Vim å‡½æ•°è¿”å› <code>1</code> æˆ–
<code>0</code>ã€‚è¿™åœ¨ Vimscript ä¸­ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸º <code>1</code>
æ˜¯çœŸçš„ï¼Œè€Œ <code>0</code> æ˜¯å‡çš„ï¼Œæ”¯æŒå¦‚ä¸‹ç»“æ„ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&#x27;nvim&#x27;</span>)</span><br><span class="line">    <span class="comment">&quot; do something...</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œï¼Œåœ¨ Lua ä¸­ï¼Œåªæœ‰ <code>false</code> å’Œ <code>nil</code>
è¢«è®¤ä¸ºæ˜¯å‡çš„ï¼Œæ•°å­—çš„è®¡ç®—ç»“æœæ€»æ˜¯
<code>true</code>ï¼Œæ— è®ºå®ƒä»¬çš„å€¼æ˜¯ä»€ä¹ˆã€‚æ‚¨å¿…é¡»æ˜¾å¼æ£€æŸ¥ <code>1</code> æˆ–
<code>0</code>ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> vim.fn.has(<span class="string">&#x27;nvim&#x27;</span>) == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- do something...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰æ˜ å°„">å®šä¹‰æ˜ å°„</h2>
<h3 id="api-å‡½æ•°">API å‡½æ•°</h3>
<p>Neovim æä¾›äº†ä¸€ç³»åˆ—çš„ api å‡½æ•°æ¥è®¾ç½®è·å–å’Œåˆ é™¤æ˜ å°„ï¼š</p>
<ul>
<li>å…¨å±€æ˜ å°„ï¼š
<ul>
<li><code>vim.api.nvim_set_keymap()</code></li>
<li><code>vim.api.nvim_get_keymap()</code></li>
<li><code>vim.api.nvim_del_keymap()</code></li>
</ul></li>
<li>ç¼“å†²åŒºæ˜ å°„ï¼š
<ul>
<li><code>vim.api.nvim_buf_set_keymap()</code></li>
<li><code>vim.api.nvim_buf_get_keymap()</code></li>
<li><code>vim.api.nvim_buf_del_keymap()</code></li>
</ul></li>
</ul>
<p>è®©æˆ‘ä»¬ä» <code>vim.api.nvim_set_keymap()</code> å’Œ
<code>vim.api.nvim_buf_set_keymap()</code>
å¼€å§‹ï¼Œä¼ é€’ç»™å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ˜ å°„ç”Ÿæ•ˆæ¨¡å¼åç§°çš„å­—ç¬¦ä¸²ï¼š</p>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 14%" />
<col style="width: 40%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>String value</th>
<th>Help page</th>
<th>Affected modes</th>
<th>Vimscript equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>''</code> (an empty string)</td>
<td><code>mapmode-nvo</code></td>
<td>Normal, Visual, Select, Operator-pending</td>
<td><code>:map</code></td>
</tr>
<tr>
<td><code>'n'</code></td>
<td><code>mapmode-n</code></td>
<td>Normal</td>
<td><code>:nmap</code></td>
</tr>
<tr>
<td><code>'v'</code></td>
<td><code>mapmode-v</code></td>
<td>Visual and Select</td>
<td><code>:vmap</code></td>
</tr>
<tr>
<td><code>'s'</code></td>
<td><code>mapmode-s</code></td>
<td>Select</td>
<td><code>:smap</code></td>
</tr>
<tr>
<td><code>'x'</code></td>
<td><code>mapmode-x</code></td>
<td>Visual</td>
<td><code>:xmap</code></td>
</tr>
<tr>
<td><code>'o'</code></td>
<td><code>mapmode-o</code></td>
<td>Operator-pending</td>
<td><code>:omap</code></td>
</tr>
<tr>
<td><code>'!'</code></td>
<td><code>mapmode-ic</code></td>
<td>Insert and Command-line</td>
<td><code>:map!</code></td>
</tr>
<tr>
<td><code>'i'</code></td>
<td><code>mapmode-i</code></td>
<td>Insert</td>
<td><code>:imap</code></td>
</tr>
<tr>
<td><code>'l'</code></td>
<td><code>mapmode-l</code></td>
<td>Insert, Command-line, Lang-Arg</td>
<td><code>:lmap</code></td>
</tr>
<tr>
<td><code>'c'</code></td>
<td><code>mapmode-c</code></td>
<td>Command-line</td>
<td><code>:cmap</code></td>
</tr>
<tr>
<td><code>'t'</code></td>
<td><code>mapmode-t</code></td>
<td>Terminal</td>
<td><code>:tmap</code></td>
</tr>
</tbody>
</table>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…å«æ˜ å°„å·¦ä¾§çš„å­—ç¬¦ä¸²ï¼ˆè§¦å‘æ˜ å°„ä¸­å®šä¹‰çš„å‘½ä»¤çš„é”®æˆ–é”®é›†ï¼‰ã€‚ç©ºå­—ç¬¦ä¸²ç›¸å½“äº
<code>&lt;Nop&gt;</code>ï¼Œè¡¨ç¤ºç¦ç”¨é”®ä½ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯åŒ…å«æ˜ å°„å³ä¾§ï¼ˆè¦æ‰§è¡Œçš„å‘½ä»¤ï¼‰çš„å­—ç¬¦ä¸²ã€‚</p>
<p>æœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªè¡¨ï¼ŒåŒ…å« <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#:map-arguments"><code>:help :map-arguments</code></a>
ä¸­å®šä¹‰çš„æ˜ å°„çš„å¸ƒå°”å€¼é€‰é¡¹ï¼ˆåŒ…æ‹¬ <code>noremap</code>ï¼Œä¸åŒ…æ‹¬
<code>buffer</code>)ã€‚</p>
<p>ç¼“å†²åŒº-æœ¬åœ°æ˜ å°„ä¹Ÿå°†ç¼“å†²åŒºç¼–å·ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•°(<code>0</code>
è®¾ç½®å½“å‰ç¼“å†²åŒºçš„æ˜ å°„ï¼‰ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;leader&gt;&lt;Space&gt;&#x27;</span>, <span class="string">&#x27;:set hlsearch!&lt;CR&gt;&#x27;</span>, &#123; noremap = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- :nnoremap &lt;silent&gt; &lt;leader&gt;&lt;Space&gt; :set hlsearch&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_buf_set_keymap(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;line(&quot;.&quot;) == 1 ? &quot;cc&quot; : &quot;ggcc&quot;&#x27;</span>, &#123; noremap = <span class="literal">true</span>, expr = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- :noremap &lt;buffer&gt; &lt;expr&gt; cc line(&#x27;.&#x27;) == 1 ? &#x27;cc&#x27; : &#x27;ggcc&#x27;</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123;</span><br><span class="line">    noremap = <span class="literal">true</span>,</span><br><span class="line">    callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;My example&#x27;</span>)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="comment">-- Since Lua function don&#x27;t have a useful string representation, you can use the &quot;desc&quot; option to document your mapping</span></span><br><span class="line">    desc = <span class="string">&#x27;Prints &quot;My example&quot; in the message area&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_get_keymap()</code>
æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åŒ…å«æ‚¨æƒ³è¦æ˜ å°„åˆ—è¡¨çš„æ¨¡å¼çš„çŸ­åç§°ï¼ˆè§ä¸Šè¡¨ï¼‰ã€‚è¿”å›å€¼æ˜¯åŒ…å«è¯¥æ¨¡å¼çš„æ‰€æœ‰å…¨å±€æ˜ å°„çš„è¡¨ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_get_keymap(<span class="string">&#x27;n&#x27;</span>)))</span><br><span class="line"><span class="comment">-- :verbose nmap</span></span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_buf_get_keymap()</code>
å°†ç¼“å†²åŒºç¼–å·ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå‚æ•° (<code>0</code>
å°†è·å–å½“å‰ç¼“å†²åŒºçš„æ˜ å°„ï¼‰</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_buf_get_keymap(<span class="number">0</span>, <span class="string">&#x27;i&#x27;</span>)))</span><br><span class="line"><span class="comment">-- :verbose imap &lt;buffer&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_del_keymap()</code> è·å–æ˜ å°„å·¦ä¾§çš„æ¨¡å¼ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_del_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;leader&gt;&lt;Space&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nunmap &lt;leader&gt;&lt;Space&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŒæ ·ï¼Œ<code>vim.api.nvim_buf_del_keymap()</code>
ä»¥ç¼“å†²åŒºç¼–å·ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶ä¸­ <code>0</code> è¡¨ç¤ºå½“å‰ç¼“å†²åŒºã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_del_keymap(<span class="number">0</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :iunmap &lt;buffer&gt; &lt;Tab&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="vim.keymap">vim.keymap</h3>
<p>:warning: æœ¬èŠ‚è®¨è®ºçš„å‡½æ•°ä»…é€‚ç”¨äº Neovim 0.7.0+</p>
<p>Neovim æä¾›äº†ä¸¤ä¸ªå‡½æ•°æ¥è®¾ç½® / åˆ é™¤æ˜ å°„ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.set()"><code>vim.keymap.set()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.del()"><code>vim.keymap.del()</code></a></li>
</ul>
<p>å®ƒä»¬æ˜¯ä¸Šè¿° API å‡½æ•°çš„è¯­æ³•ç³–ç‰ˆæœ¬ã€‚</p>
<p><code>vim.keymap.set()</code>
ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œä»£è¡¨æ˜ å°„ç”Ÿæ•ˆçš„æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
tableï¼Œè¿™æ ·å¯ä»¥ä¸€æ¬¡æ€§å®šä¹‰å¤šä¸ªæ¨¡å¼ä¸‹çš„æ˜ å°„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;lua vim.notify(&quot;Example 1&quot;)&lt;CR&gt;&#x27;</span>)</span><br><span class="line">vim.keymap.set(&#123;<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;lua vim.notify(&quot;Example 2&quot;)&lt;CR&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ˜ å°„çš„å·¦ä¾§ï¼Œæ˜¯å­—ç¬¦ä¸²ç±»å‹</p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯æ˜ å°„çš„å³ä¾§ï¼Œæ—¢å¯ä»¥æ˜¯å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Lua å‡½æ•°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echomsg &quot;Example 1&quot;&lt;CR&gt;&#x27;</span>)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&quot;Example 2&quot;</span>) <span class="keyword">end</span>)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;pl1&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;plugin&#x27;</span>).plugin_action)</span><br><span class="line"><span class="comment">-- To avoid the startup cost of requiring the module, you can wrap it in a function to require it lazily when invoking the mapping:</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;pl2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">require</span>(<span class="string">&#x27;plugin&#x27;</span>).plugin_action() <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››ä¸ªå‚æ•°æ˜¯æ˜¯ä¸€ä¸ªé€‰é¡¹çš„ tableï¼Œå®ƒæ˜¯å¯é€‰çš„ï¼Œå¯¹åº”äºä¼ é€’ç»™
<code>vim.apt.nvim_set_keymap()</code>
çš„é€‰é¡¹ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›å†…å®¹ï¼ˆå®Œæ•´åˆ—è¡¨è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.set()"><code>:help vim.keymap.set()</code></a>ï¼‰ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echomsg &quot;Example 1&quot;&lt;CR&gt;&#x27;</span>, &#123;buffer = <span class="literal">true</span>&#125;)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&#x27;Example 2&#x27;</span>) <span class="keyword">end</span>, &#123;desc = <span class="string">&#x27;Prints &quot;Example 2&quot; to the message area&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ Lua å‡½æ•°å®šä¹‰æ˜ å°„ä¸åŒäºä½¿ç”¨å­—ç¬¦ä¸²ã€‚ åƒ
<code>:nmap &lt;Leader&gt;ex1</code>
ä¹‹ç±»çš„æ˜¾ç¤ºæ˜ å°„ä¿¡æ¯çš„å¸¸ç”¨æ–¹æ³•ä¸ä¼šè¾“å‡ºæœ‰ç”¨çš„ä¿¡æ¯ï¼ˆæ˜ å°„åˆ°çš„å­—ç¬¦ä¸²æœ¬èº«ï¼‰ï¼Œè€Œåªä¼šæ˜¾ç¤º
Lua å‡½æ•°ã€‚ å»ºè®®æ·»åŠ ä¸€ä¸ª <code>desc</code>
é¡¹æ¥æè¿°ä½ çš„æŒ‰é”®æ˜ å°„çš„è¡Œä¸ºã€‚è¿™å¯¹äºè®°å½•æ’ä»¶æ˜ å°„å°¤å…¶é‡è¦ï¼Œç”¨æˆ·å¯ä»¥æ›´è½»æ¾åœ°äº†è§£æ¡ˆä»¶æ˜ å°„çš„ç”¨æ³•ã€‚</p>
<p>è¿™ä¸ª API çš„æœ‰ç”¨ä¹‹å¤„åœ¨äºå®ƒæ¶ˆé™¤äº† Vim æ˜ å°„çš„å†å²é—ç•™é—®é¢˜ï¼š</p>
<ul>
<li><p>æ˜ å°„é»˜è®¤æ˜¯ <code>noremap</code> çš„ï¼Œé™¤é <code>rhs</code> æ˜¯ä¸€ä¸ª
<code>&lt;Plug&gt;</code>
æ˜ å°„ã€‚è¿™æ„å‘³ç€ä½ å¾ˆå°‘éœ€è¦è€ƒè™‘æ˜ å°„æ˜¯å¦åº”è¯¥æ˜¯é€’å½’çš„ï¼š</p>
<p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;test1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echo &quot;test&quot;&lt;CR&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nnoremap &lt;Leader&gt;test &lt;Cmd&gt;echo &quot;test&quot;&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¦‚æœä½ ç¡®å®šè¦è®¾ç½®ä¸€ä¸ªé€’å½’çš„æ˜ å°„ï¼ŒæŠŠ &quot;remap&quot; é€‰é¡¹è®¾ç½®ä¸º &quot;true&quot;</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, &#123;remap = <span class="literal">true</span>&#125;)</span><br><span class="line"><span class="comment">-- :nmap &gt; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- é™¤éæ˜¯é€’å½’æ˜ å°„ï¼Œå¦åˆ™ &lt;Plug&gt; æ˜ å°„ä¸ä¼šèµ·ä½œç”¨ï¼Œvim.keymap.set() ä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;plug&#x27;</span>, <span class="string">&#x27;&lt;Plug&gt;(plugin)&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nmap &lt;Leader&gt;plug &lt;Plug&gt;(plugin)</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>åœ¨ <code>expr</code>
æ˜ å°„ä¸­ï¼Œ<code>nvim_replace_termcodes()</code> ä¼šè¢«è‡ªåŠ¨åº”ç”¨äº Lua
å‡½æ•°è¿”å›çš„å­—ç¬¦ä¸²</p>
<p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible == <span class="number">1</span> <span class="keyword">and</span> <span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span>, &#123;expr = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure></p></li>
</ul>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#recursive_mapping"><code>:help recursive_mapping</code></a></li>
</ul>
<p><code>vim.keymap.del()</code> å·¥ä½œåŸç†ç›¸åŒï¼Œä½†æ˜¯æ•ˆæœæ˜¯åˆ é™¤æ˜ å°„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.del(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>)</span><br><span class="line">vim.keymap.del(&#123;<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, &#123;buffer = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰ç”¨æˆ·å‘½ä»¤">å®šä¹‰ç”¨æˆ·å‘½ä»¤</h2>
<p>:warning: æœ¬èŠ‚è®¨è®ºçš„ API å‡½æ•°ä»…é€‚ç”¨äº Neovim 0.7.0+</p>
<p>Neovim æä¾›äº†å¦‚ä¸‹ API å‡½æ•°æ¥åˆ›å»ºç”¨æˆ·å‘½ä»¤</p>
<ul>
<li>å…¨å±€ç”¨æˆ·å‘½ä»¤
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>vim.api.nvim_create_user_command()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_del_user_command()"><code>vim.api.nvim_del_user_command()</code></a></li>
</ul></li>
<li>Buffer-local çš„ç”¨æˆ·å‘½ä»¤
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_buf_create_user_command()"><code>vim.api.nvim_buf_create_user_command()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_buf_del_user_command()"><code>vim.api.nvim_buf_del_user_command()</code></a></li>
</ul></li>
</ul>
<p>ä»¥ <code>vim.api.nvim_create_user_command()</code> ä¸ºä¾‹è¯´æ˜ç”¨æ³•</p>
<p>æ­¤å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‘½ä»¤çš„åå­—ï¼ˆå¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼‰ã€‚</p>
<p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è°ƒç”¨è¯¥å‘½ä»¤æ—¶è¦æ‰§è¡Œçš„ä»£ç ã€‚å®ƒå¯ä»¥æ˜¯ï¼š</p>
<p>ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹å®ƒå°†ä½œä¸º Vimscript æ‰§è¡Œï¼‰ã€‚ä½ å¯ä»¥åƒä½¿ç”¨
<code>:command</code> ä¸€æ ·ä½¿ç”¨è½¬ä¹‰åºåˆ—ï¼Œè­¬å¦‚
<code>&lt;q-args&gt;</code>ã€<code>&lt;range&gt;</code> ç­‰</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Upper&#x27;</span>, <span class="string">&#x27;echo toupper(&lt;q-args&gt;)&#x27;</span>, &#123; nargs = <span class="number">1</span> &#125;)</span><br><span class="line"><span class="comment">-- :command! -nargs=1 Upper echo toupper(&lt;q-args&gt;)</span></span><br><span class="line"></span><br><span class="line">vim.cmd(<span class="string">&#x27;Upper hello world&#x27;</span>) <span class="comment">-- prints &quot;HELLO WORLD&quot;</span></span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æ˜¯ä¸€ä¸ª Lua å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªç±»ä¼¼å­—å…¸çš„
tableï¼Œå…¶ä¸­åŒ…å«é€šå¸¸æ˜¯ç”±è½¬ä¹‰åºåˆ—æä¾›çš„æ•°æ®ï¼ˆå¯ç”¨çš„æ‰€æœ‰é”®è¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>:help nvim_create_user_command()</code></a>ï¼‰</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(</span><br><span class="line">    <span class="string">&#x27;Upper&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(opts)</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">upper</span>(opts.args))</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    &#123; nargs = <span class="number">1</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«å‘½ä»¤å±æ€§çš„ tableï¼ˆè¯·å‚è§ <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#command-attributes"><code>:help command-attributes</code></a>ï¼‰ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºä½ å¯ä»¥ä½¿ç”¨
<code>vim.api.nvim_buf_create_user_command()</code> æ¥åˆ›å»º buffer-local
çš„ç”¨æˆ·å‘½ä»¤ï¼Œæ‰€ä»¥ <code>-buffer</code> ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å±æ€§ã€‚</p>
<p>æ­¤å¤–è¿˜æœ‰ä¸¤ç§å±æ€§å¯ç”¨ï¼š</p>
<ul>
<li><code>desc</code> å±æ€§æ˜¯ä½ åœ¨å®šä¹‰ä¸º Lua å›è°ƒå‡½æ•°çš„å‘½ä»¤ä¸Šè¿è¡Œ
<code>:command &#123;cmd&#125;</code>
æ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚ä¸ä¸Šæ–‡ä¸­çš„é”®ç›˜æ˜ å°„ç±»ä¼¼ï¼Œæˆ‘ä»¬å»ºè®®åœ¨å®šä¹‰ä¸º Lua
å‡½æ•°çš„å‘½ä»¤ä¸­åŠ å…¥æ­¤å±æ€§ã€‚</li>
<li><code>force</code> å±æ€§ç›¸å½“äºè°ƒç”¨ <code>:command!</code>
å¹¶ä¸”æ›¿æ¢å·²ç»å­˜åœ¨çš„åŒåå‘½ä»¤ã€‚ä¸ Vimscript ä¸åŒï¼Œå®ƒçš„é»˜è®¤å€¼ä¸º
<code>true</code></li>
</ul>
<p>é™¤äº† <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#:command-complete"><code>:help :command-complete</code></a>
ä¸­åˆ—å‡ºçš„å±æ€§ä¹‹å¤–ï¼Œ<code>-complete</code> è¿˜å¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ª Lua å‡½æ•°ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Upper&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;</span><br><span class="line">    nargs = <span class="number">1</span>,</span><br><span class="line">    complete = <span class="function"><span class="keyword">function</span><span class="params">(ArgLead, CmdLine, CursorPos)</span></span></span><br><span class="line">        <span class="comment">-- return completion candidates as a list-like table</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span> &#125;</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Buffer-local çš„ç”¨æˆ·å‘½ä»¤æŠŠ buffer ç¼–å·ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚è¿™æ¯”
<code>-buffer</code> æ›´ä¼˜ï¼Œåè€…åªèƒ½ä¸ºå½“å‰çš„ buffer å®šä¹‰å‘½ä»¤ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_create_user_command(<span class="number">4</span>, <span class="string">&#x27;Upper&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_del_user_command()</code>
çš„å‚æ•°æ˜¯è¦åˆ é™¤å‘½ä»¤çš„åå­—ã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_del_user_command(<span class="string">&#x27;Upper&#x27;</span>)</span><br><span class="line"><span class="comment">-- :delcommand Upper</span></span><br></pre></td></tr></table></figure>
<p>åŒæ ·çš„ï¼Œ<code>vim.api.nvim_buf_del_user_command()</code> ä¹ŸæŠŠ buffer
ç¼–å·ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ<code>0</code> ä»£è¡¨å½“å‰çš„ bufferã€‚</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_del_user_command(<span class="number">4</span>, <span class="string">&#x27;Upper&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>:help nvim_create_user_command</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/usr_40.html#40.2"><code>:help 40.2</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#command-attributes"><code>:help command-attributes</code></a></li>
</ul>
<h3 id="caveats-5">Caveats</h3>
<p><code>-complete=custom</code>
å±æ€§è‡ªåŠ¨é€‰å‡ºåˆé€‚çš„å€™é€‰è¡¥å…¨å¹¶ä¸”æ”¯æŒå†…ç½®çš„é€šé…ç¬¦ï¼ˆ<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/editing.html#wildcard"><code>:help wildcard</code></a>ï¼‰</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function!</span> <span class="title">s</span>:completion_function<span class="params">(ArgLead, CmdLine, CursorPos)</span> abort</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">join</span>([</span><br><span class="line">        \ <span class="string">&#x27;strawberry&#x27;</span>,</span><br><span class="line">        \ <span class="string">&#x27;star&#x27;</span>,</span><br><span class="line">        \ <span class="string">&#x27;stellar&#x27;</span>,</span><br><span class="line">        \ ], <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line">command! -nargs=<span class="number">1</span> -<span class="built_in">complete</span>=custom,<span class="variable">s:completion_function</span> Test <span class="keyword">echo</span> <span class="symbol">&lt;q-args&gt;</span></span><br><span class="line"><span class="string">&quot; Typing `:Test st[ae]&lt;Tab&gt;` returns &quot;</span><span class="keyword">star</span><span class="string">&quot; and &quot;</span>stellar<span class="comment">&quot;</span></span><br></pre></td></tr></table></figure>
<p>æŠŠ <code>complete</code> è®¾ç½®ä¸º Lua å‡½æ•°çš„è¯ï¼Œå®ƒçš„è¡Œä¸ºä¼šç±»ä¼¼äº
<code>customlist</code> ï¼ŒNeovim ä¸ä¼šç­›é€‰å‡½æ•°è¿”å›çš„å€™é€‰åˆ—è¡¨</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Test&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;</span><br><span class="line">    nargs = <span class="number">1</span>,</span><br><span class="line">    complete = <span class="function"><span class="keyword">function</span><span class="params">(ArgLead, CmdLine, CursorPos)</span></span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;strawberry&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;star&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;stellar&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Typing `:Test z&lt;Tab&gt;` returns all the completion results because the list was not filtered</span></span><br></pre></td></tr></table></figure>
<h2 id="å®šä¹‰è‡ªåŠ¨å‘½ä»¤">å®šä¹‰è‡ªåŠ¨å‘½ä»¤</h2>
<p>ï¼ˆæœ¬èŠ‚å†…å®¹å°šæœªå®Œæˆï¼‰</p>
<p>Neovim 0.7.0 ä¸ºåˆ›å»ºè‡ªåŠ¨å‘½ä»¤æä¾›äº†ç›¸åº”çš„ API å‡½æ•°ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§
<code>:help api-autocmd</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/14661">Pull request
#14661</a> (lua: autocmds take 2)</li>
</ul>
<h2 id="å®šä¹‰è¯­æ³•é«˜äº®">å®šä¹‰è¯­æ³•é«˜äº®</h2>
<p>ï¼ˆæœ¬èŠ‚å†…å®¹å°šæœªå®Œæˆï¼‰</p>
<p>Neovim 0.7.0 ä¸ºå¤„ç†é«˜äº®ç»„æä¾›äº†ç›¸åº”çš„ API å‡½æ•°ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_set_hl()"><code>:help nvim_set_hl()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_get_hl_by_id()"><code>:help nvim_get_hl_by_id()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_get_hl_by_name()"><code>:help nvim_get_hl_by_name()</code></a></li>
</ul>
<h2 id="general-tips-and-recommendations">General tips and
recommendations</h2>
<h3 id="é‡æ–°åŠ è½½ç¼“å­˜çš„æ¨¡å—">é‡æ–°åŠ è½½ç¼“å­˜çš„æ¨¡å—</h3>
<p>åœ¨ Lua ä¸­ï¼Œ<code>require()</code>
å‡½æ•°ä¼šç¼“å­˜å·²åŠ è½½çš„æ¨¡å—ï¼Œè¿™å¯¹æå‡æ€§èƒ½æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ä½†æ˜¯å®ƒä¼šå¯¹æ’ä»¶çš„å·¥ä½œé€ æˆå½±å“ï¼Œå› ä¸ºå·²åŠ è½½çš„æ¨¡å—ä¸ä¼šåœ¨åç»­çš„
<code>require()</code> è°ƒç”¨ä¸­æ›´æ–°ã€‚</p>
<p>å¦‚æœä½ æƒ³åˆ·æ–°æŸä¸ªç‰¹å®šæ¨¡å—çš„ç¼“å­˜ï¼Œé‚£ä¹ˆä½ å¿…é¡»å»ä¿®æ”¹å…¨å±€çš„
<code>package.loaded</code> :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">package</span>.<span class="built_in">loaded</span>[<span class="string">&#x27;modname&#x27;</span>] = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;modname&#x27;</span>) <span class="comment">-- loads an updated version of module &#x27;modname&#x27;</span></span><br></pre></td></tr></table></figure>
<p><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim">nvim-lua/plenary.nvim</a>
æ’ä»¶æä¾›äº†å®ç°æ­¤åŠŸèƒ½çš„<a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim/blob/master/lua/plenary/reload.lua">è‡ªå®šä¹‰å‡½æ•°</a></p>
<h3 id="ä¸è¦å¡«å……-lua-å­—ç¬¦ä¸²">ä¸è¦å¡«å…… Lua å­—ç¬¦ä¸²ï¼</h3>
<p>å½“ä½¿ç”¨åŒé‡ä¸­æ‹¬å·çš„å­—ç¬¦ä¸²æ—¶ï¼Œå°½é‡ä¸è¦å¡«å……å¤šä½™çš„å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰ï¼å½“å­—ç¬¦æ²¡æœ‰ç‰¹æ®Šæ„ä¹‰çš„æ—¶å€™è¿™æ ·åšæ— å¯éè®®ï¼›ä½†æ˜¯å½“å­—ç¬¦å…·æœ‰ç‰¹æ®Šæ„ä¹‰æ—¶ï¼Œè¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›éš¾ä»¥å‘ç°çš„é—®é¢˜</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;f&#x27;</span>, <span class="string">[[ &lt;Cmd&gt;call foo()&lt;CR&gt; ]]</span>, &#123;noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<code>&lt;Leader&gt;f</code> è¢«æ˜ å°„åˆ°äº†
<code>&lt;Space&gt;&lt;Cmd&gt;call foo()&lt;CR&gt;&lt;Space&gt;</code>
ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ <code>&lt;Cmd&gt;call foo()&lt;CR&gt;</code>ã€‚</p>
<h3 id="å…³äº-vimscript---lua-ä¹‹é—´ç±»å‹è½¬æ¢çš„æ³¨æ„äº‹é¡¹">å…³äº Vimscript
&lt;-&gt; Lua ä¹‹é—´ç±»å‹è½¬æ¢çš„æ³¨æ„äº‹é¡¹</h3>
<h4 id="å˜é‡è½¬æ¢æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬">å˜é‡è½¬æ¢æ—¶ä¼šåˆ›å»ºä¸€ä¸ªå‰¯æœ¬</h4>
<p>è¿™æ„å‘³ç€ä½ å¯¹å¯¹è±¡ï¼ˆä» Lua è½¬æ¢åˆ° Vimscript
çš„å¯¹è±¡æˆ–è€…åè¿‡æ¥ï¼‰çš„å¼•ç”¨è¿›è¡Œä¿®æ”¹ä¸ä¼šå½±å“åˆ°åŸå¯¹è±¡ã€‚</p>
<p>ä¾‹å¦‚ï¼ŒVimscript ä¸­çš„ <code>map()</code> å‡½æ•°å°±åœ°ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s:list</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s:newlist</span> = <span class="keyword">map</span>(<span class="variable">s:list</span>, &#123;_, v -&gt; v * <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:list</span></span><br><span class="line"><span class="comment">&quot; [2, 4, 6]</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:newlist</span></span><br><span class="line"><span class="comment">&quot; [2, 4, 6]</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:list</span> is# <span class="variable">s:newlist</span></span><br><span class="line"><span class="comment">&quot; 1</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ Lua ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒæ”¹å˜çš„å°†ä¼šæ˜¯å‚æ•°çš„ä¸€ä¸ªå‰¯æœ¬ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tbl = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">local</span> newtbl = vim.fn.map(tbl, <span class="function"><span class="keyword">function</span><span class="params">(_, v)</span></span> <span class="keyword">return</span> v * <span class="number">2</span> <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(tbl)) <span class="comment">-- &#123; 1, 2, 3 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(newtbl)) <span class="comment">-- &#123; 2, 4, 6 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(tbl == newtbl) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<h4 id="å¹¶ä¸æ˜¯æ€»èƒ½è¿›è¡Œç±»å‹è½¬æ¢">å¹¶ä¸æ˜¯æ€»èƒ½è¿›è¡Œç±»å‹è½¬æ¢</h4>
<p>è¿™ä¸»è¦å½±å“å‡½æ•°å’Œ tableï¼š</p>
<p>æ··åˆåˆ—è¡¨å’Œå­—å…¸çš„ Lua table æ˜¯æ— æ³•è½¬æ¢çš„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.fn.count(&#123;<span class="number">1</span>, <span class="number">1</span>, number = <span class="number">1</span>&#125;, <span class="number">1</span>))</span><br><span class="line"><span class="comment">-- E5100: Cannot convert given lua table: table should either have a sequence of positive integer keys or contain only string keys</span></span><br></pre></td></tr></table></figure>
<p>å°½ç®¡ä½ å¯ä»¥åœ¨ Lua ä¸­é€šè¿‡ <code>vim.fn</code> è°ƒç”¨ VIm
å‡½æ•°ï¼Œä½†æ˜¯ä½ ä¸èƒ½ä¿å­˜å¯¹å®ƒä»¬çš„å¼•ç”¨ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„å¤–çš„è¡Œä¸ºï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> FugitiveHead = vim.fn.funcref(<span class="string">&#x27;FugitiveHead&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(FugitiveHead) <span class="comment">-- vim.NIL</span></span><br><span class="line"></span><br><span class="line">vim.cmd(<span class="string">&quot;let g:test_dict = &#123;&#x27;test_lambda&#x27;: &#123;-&gt; 1&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.g.test_dict.test_lambda) <span class="comment">-- nil</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.g.test_dict)) <span class="comment">-- &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>æŠŠ Lua å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™ Vim å‡½æ•°æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä¸èƒ½æŠŠå®ƒä»¬å­˜åœ¨ Vim
å˜é‡ä¸­ï¼ˆNeovim 0.7.0+ ä¸­ä¿®å¤äº†è¿™ä¸ªé—®é¢˜ï¼‰ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This works:</span></span><br><span class="line">vim.fn.jobstart(&#123;<span class="string">&#x27;ls&#x27;</span>&#125;, &#123;</span><br><span class="line">    on_stdout = <span class="function"><span class="keyword">function</span><span class="params">(chan_id, data, name)</span></span></span><br><span class="line">        <span class="built_in">print</span>(vim.inspect(data))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- This doesn&#x27;t:</span></span><br><span class="line">vim.g.test_dict = &#123;test_lambda = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">end</span>&#125; <span class="comment">-- Error: Cannot convert given lua type</span></span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ Vimscript ä¸­ä½¿ç”¨ <code>luaeval()</code>
æ‰§è¡Œç›¸åŒæ“ä½œå´æ˜¯å¯è¡Œçš„ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:test_dict</span> = &#123;<span class="string">&#x27;test_lambda&#x27;</span>: <span class="built_in">luaeval</span>(<span class="string">&#x27;function() return 1 end&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:test_dict</span></span><br><span class="line"><span class="comment">&quot; &#123;&#x27;test_lambda&#x27;: function(&#x27;&lt;lambda&gt;4714&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="vim-booleans">Vim booleans</h4>
<p>åœ¨ Vim è„šæœ¬ä¸­ï¼Œä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯ä½¿ç”¨ <code>1</code> æˆ– <code>0</code>
æ¥ä»£è¡¨å¸ƒå°”å€¼ã€‚äº‹å®ä¸Šï¼Œç›´åˆ°ç‰ˆæœ¬ 7.4.1154ï¼ŒVim æ‰æœ‰å•ç‹¬çš„å¸ƒå°”ç±»å‹ã€‚</p>
<p>åœ¨ Vimscript ä¸­ï¼ŒLua çš„å¸ƒå°”å€¼ä¼šè¢«è½¬æ¢ä¸ºçœŸæ­£çš„å¸ƒå°”å€¼ï¼Œè€Œä¸æ˜¯æ•°å­—ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.lua_true = true</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:lua_true</span></span><br><span class="line"><span class="comment">&quot; v:true</span></span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.lua_false = false</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:lua_false</span></span><br><span class="line"><span class="comment">&quot; v:false</span></span><br></pre></td></tr></table></figure>
<h3 id="è®¾ç½®-linterslanguage-servers">è®¾ç½® linters/language servers</h3>
<p>å¦‚æœä½ ä½¿ç”¨ liner å’Œ / æˆ– language server æ¥è·å¾— Lua
é¡¹ç›®çš„è‡ªåŠ¨è¡¥å…¨å’Œé”™è¯¯æ£€æŸ¥ï¼Œä½ å¯èƒ½éœ€è¦ä¸ºå®ƒä»¬é…ç½® Neovim
ç‰¹å®šçš„è®¾ç½®ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æµè¡Œå·¥å…·çš„æ¨èé…ç½®ï¼š</p>
<h4 id="luacheck">luacheck</h4>
<p>ä½ å¯ä»¥é€šè¿‡æŠŠæ­¤é…ç½®æ”¾å…¥ <code>~/.luacheckrc</code> ï¼ˆæˆ–
<code>$XDG_CONFIG_HOME/luacheck/.luacheckrc</code>ï¼‰ä¸­æ¥è®© <a
target="_blank" rel="noopener" href="https://github.com/mpeterv/luacheck/">luacheck</a> è¯†åˆ«å…¨å±€çš„
<code>vim</code> å˜é‡ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">globals = &#123;</span><br><span class="line">    <span class="string">&quot;vim&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/Alloyed/lua-lsp/">Alloyed/lua-lsp</a>
ä½¿ç”¨ <code>luacheck</code> æä¾› linting å¹¶è¯»å–ç›¸åŒçš„æ–‡ä»¶ã€‚</p>
<p>æœ‰å…³å¦‚ä½•é…ç½® <code>luacheck</code> çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§å®ƒçš„<a
target="_blank" rel="noopener" href="https://luacheck.readthedocs.io/en/stable/config.html">æ–‡æ¡£</a></p>
<h4 id="sumnekolua-language-server">sumneko/lua-language-server</h4>
<p><a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/">nvim-lspconfig</a>
ä»“åº“ä¸­åŒ…å«äº†å¦‚ä½•é…ç½® sumneko/lua-language-server çš„<a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#sumneko_lua">è¯´æ˜</a>ï¼ˆç¤ºä¾‹ä½¿ç”¨å†…ç½®
LSP å®¢æˆ·ç«¯ï¼Œä½†å…¶ä»– LSP å®¢æˆ·ç«¯å®ç°çš„é…ç½®åº”è¯¥ç›¸åŒï¼‰ã€‚</p>
<p>æœ‰å…³å¦‚ä½•é…ç½® <a
target="_blank" rel="noopener" href="https://github.com/sumneko/lua-language-server/">sumneko/lua-language-server</a>
çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… <a
target="_blank" rel="noopener" href="https://github.com/sumneko/lua-language-server/wiki/Setting">"Setting"</a></p>
<h4 id="coc.nvim">coc.nvim</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/neoclide/coc.nvim/">coc.nvim</a> çš„ <a
target="_blank" rel="noopener" href="https://github.com/rafcamlet/coc-nvim-lua/">rafcamlet/coc-nvim-lua</a>
è¡¥å…¨æºä¸º Neovim æ ‡å‡†åº“æä¾›äº†è¡¥å…¨é¡¹ã€‚</p>
<h3 id="è°ƒè¯•-lua-ä»£ç ">è°ƒè¯• Lua ä»£ç </h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ <a
target="_blank" rel="noopener" href="https://github.com/jbyuki/one-small-step-for-vimkind">jbyuki/one-small-step-for-vimkind</a>
è°ƒè¯•åœ¨å•ç‹¬çš„ Neovim å®ä¾‹ä¸­è¿è¡Œçš„ Lua ä»£ç </p>
<p>è¯¥æ’ä»¶ä½¿ç”¨ <a
target="_blank" rel="noopener" href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter
Protocol</a>ã€‚è¿æ¥åˆ°ä¸€ä¸ª debug adapter éœ€è¦ DAP å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ <a
target="_blank" rel="noopener" href="https://github.com/mfussenegger/nvim-dap/">mfussenegger/nvim-dap</a>
æˆ– <a
target="_blank" rel="noopener" href="https://github.com/puremourning/vimspector/">puremourning/vimspector</a>ã€‚</p>
<h3 id="è°ƒè¯•-lua-è®¾ç½®çš„æŒ‰é”®æ˜ å°„-ç”¨æˆ·å‘½ä»¤-è‡ªåŠ¨å‘½ä»¤">è°ƒè¯• Lua
è®¾ç½®çš„æŒ‰é”®æ˜ å°„ / ç”¨æˆ·å‘½ä»¤ / è‡ªåŠ¨å‘½ä»¤</h3>
<p><code>:verbose</code> å‘½ä»¤å…è®¸ä½ æŸ¥çœ‹ æŒ‰é”®æ˜ å°„ / ç”¨æˆ·å‘½ä»¤ /
è‡ªåŠ¨å‘½ä»¤çš„å®šä¹‰ä½ç½®ï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">verbose</span> <span class="keyword">map</span> <span class="keyword">m</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n  m_          * <span class="symbol">&lt;Cmd&gt;</span><span class="keyword">echo</span> <span class="string">&#x27;example&#x27;</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line">        Last <span class="keyword">set</span> from ~/.config/nvim/init.<span class="keyword">vim</span> <span class="built_in">line</span> <span class="number">26</span></span><br></pre></td></tr></table></figure>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå‡ºäºæ€§èƒ½åŸå› ï¼Œæ­¤åŠŸèƒ½åœ¨ Lua ä¸­æ˜¯ç¦ç”¨çš„ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¤§äº
0 çš„ verbose level å¯åŠ¨ Neovim æ¥å¯ç”¨å®ƒï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvim -V1</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/options.html#&#39;verbose&#39;"><code>:help 'verbose'</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/starting.html#-V"><code>:help -V</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/15079">neovim/neovim#15079</a></li>
</ul>
<h3 id="æµ‹è¯•-lua-ä»£ç ">æµ‹è¯• Lua ä»£ç </h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim/#plenarytest_harness">plenary.nvim:
test harness</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/notomo/vusted">notomo/vusted</a></li>
</ul>
<h3 id="ä½¿ç”¨-luarocks-åŒ…">ä½¿ç”¨ Luarocks åŒ…</h3>
<p><a
target="_blank" rel="noopener" href="https://github.com/wbthomason/packer.nvim">wbthomason/packer.nvim</a>
æ”¯æŒ Luarocks åŒ…ã€‚å®ƒçš„ <a
target="_blank" rel="noopener" href="https://github.com/wbthomason/packer.nvim/#luarocks-support">README</a>
ä¸­æä¾›äº†æœ‰å…³å¦‚ä½•è®¾ç½®çš„è¯´æ˜</p>
<h2 id="miscellaneous">Miscellaneous</h2>
<h3 id="vim.loop">vim.loop</h3>
<p><code>vim.loop</code> æ˜¯æš´éœ² LibUV æ¥å£çš„æ¨¡å—ã€‚ä¸€äº›ç›¸å…³èµ„æºï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.libuv.org/en/v1.x/">Official documentation for
LibUV</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/luvit/luv/blob/master/docs.md">Luv
documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://teukka.tech/vimloop.html">teukka.tech - Using LibUV
in Neovim</a></li>
</ul>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.loop"><code>:help vim.loop</code></a></p>
<h3 id="vim.lsp">vim.lsp</h3>
<p><code>vim.lsp</code> æ˜¯å†…ç½®çš„ lsp åº“ã€‚å®˜æ–¹çš„ lsp é…ç½®æ’ä»¶ <a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/">neovim/nvim-lspconfig</a>
åŒ…å«ä¸€äº›æµè¡Œçš„ language server çš„é»˜è®¤é…ç½®ã€‚</p>
<p>å®¢æˆ·ç«¯çš„è¡Œä¸ºå¯ä»¥ä½¿ç”¨ "sp-handlers" è¿›è¡Œé…ç½®ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lsp.html#lsp-handler"><code>:help lsp-handler</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/12655">neovim/neovim#12655</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/diagnostic-nvim/issues/73#issue-737897078">how
to migrate from diagnostic-nvim</a></li>
</ul>
<p>ä½ å¯èƒ½è¿˜æƒ³äº†è§£ä¸€ä¸‹ä¸€äº›åŸºäº LSP å®¢æˆ·ç«¯æ„å»ºçš„<a
target="_blank" rel="noopener" href="https://github.com/rockerBOO/awesome-neovim#lsp">æ’ä»¶</a></p>
<p>æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lsp.html#LSP"><code>:help lsp</code></a></li>
</ul>
<h3 id="vim.treesitter">vim.treesitter</h3>
<p><code>vim.treesitter</code> æ˜¯ <a
target="_blank" rel="noopener" href="https://tree-sitter.github.io/tree-sitter/">Tree-sitter</a> çš„
neovim é›†æˆï¼Œå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå¯ä»¥å‚è€ƒ <a
target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Jes3bD6P0To">presentation
(38:37)</a>.</p>
<p>The <a target="_blank" rel="noopener" href="https://github.com/nvim-treesitter/">nvim-treesitter</a>
organisation hosts various plugins taking advantage of the library.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/glepnir">glepnir</a> åˆ¶ä½œçš„ä¸»é¢˜ <a
target="_blank" rel="noopener" href="https://github.com/glepnir/zephyr-nvim">zephyr-nvim</a>
è¯­æ³•é«˜äº®åŸºäº nvim-treesitter</p>
<p>â€”â€” è¯‘è€…æ³¨</p>
</blockquote>
<p>See also: - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/treesitter.html#lua-treesitter"><code>:help lua-treesitter</code></a></p>
<h3 id="transpilers">Transpilers</h3>
<p>ä½¿ç”¨ Lua çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯æ‚¨å®é™…ä¸Šä¸å¿…ç¼–å†™ Lua
ä»£ç ï¼æœ‰è®¸å¤šå…¶ä»–è¯­è¨€å¯ä»¥è½¬è¯‘åˆ° Luaã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://moonscript.org/">Moonscript</a></li>
</ul>
<p>å¯èƒ½æ˜¯ Lua
æœ€è‘—åçš„è½¬è¯‘å™¨ä¹‹ä¸€ã€‚æ·»åŠ äº†è®¸å¤šæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œå¦‚ç±»ã€åˆ—è¡¨æ¨å¯¼æˆ–å‡½æ•°å­—é¢é‡ã€‚
<a
target="_blank" rel="noopener" href="https://github.com/svermeulen/nvim-moonmaker">svermeulen/nvim-moonmaker</a>
æ’ä»¶å…è®¸æ‚¨ç›´æ¥åœ¨ Moonscript ä¸­ç¼–å†™ Neovim æ’ä»¶å’Œé…ç½®ã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://fennel-lang.org/">Fennel</a></li>
</ul>
<p>å¯ä»¥ç¼–è¯‘ä¸º Lua çš„ lisp æ–¹è¨€ã€‚ä½ å¯ä»¥ä½¿ç”¨ <a
target="_blank" rel="noopener" href="https://github.com/Olical/aniseed">Olical/aniseed</a> æˆ– <a
target="_blank" rel="noopener" href="https://github.com/rktjmp/hotpot.nvim">Hotpot</a> æ’ä»¶åœ¨ Fennel
ä¸­ä¸º Neovim ç¼–å†™é…ç½®å’Œæ’ä»¶ã€‚æ­¤å¤–ï¼Œ<a
target="_blank" rel="noopener" href="https://github.com/Olical/conjure">Olical/conjure</a>
æ’ä»¶æä¾›äº†ä¸€ä¸ªæ”¯æŒ Fennelï¼ˆä»¥åŠå…¶ä»–è¯­è¨€ï¼‰çš„äº¤äº’å¼å¼€å‘ç¯å¢ƒã€‚</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/teal-language/tl">Teal</a></li>
</ul>
<p>Teal è¿™ä¸ªåå­—æ¥è‡ª TLï¼ˆtyped luaï¼‰çš„å‘éŸ³ã€‚è¿™ä»£è¡¨äº†å®ƒçš„ç›®æ ‡â€”â€”å‘ lua
æ·»åŠ å¼ºç±»å‹ï¼ŒåŒæ—¶è¯­æ³•å°½é‡ä¿æŒæ¥è¿‘æ ‡å‡† lua è¯­æ³•ã€‚ <a
target="_blank" rel="noopener" href="https://github.com/svermeulen/nvim-teal-maker">nvim-teal-maker</a>
æ’ä»¶å¯ç”¨äºç›´æ¥åœ¨ Teal ä¸­ç¼–å†™ Neovim æ’ä»¶æˆ–é…ç½®æ–‡ä»¶</p>
<p>å…¶ä»–ä¸€äº›æœ‰è¶£çš„é¡¹ç›®ï¼š</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://github.com/TypeScriptToLua/TypeScriptToLua">TypeScriptToLua/TypeScriptToLua</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/teal-language/tl">teal-language/tl</a></li>
<li><a target="_blank" rel="noopener" href="https://haxe.org/">Haxe</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/SwadicalRag/wasm2lua">SwadicalRag/wasm2lua</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/hengestone/lua-languages">hengestone/lua-languages</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E6%9C%AF/" rel="tag"># ç”µè„‘æŠ€æœ¯</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/18/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%A7%84%E5%88%92/" rel="prev" title="è½¯ä»¶å¼€å‘è§„åˆ’">
                  <i class="fa fa-angle-left"></i> è½¯ä»¶å¼€å‘è§„åˆ’
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/21/Neovim%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/" rel="next" title="Neovimé…ç½®æ•™ç¨‹">
                  Neovimé…ç½®æ•™ç¨‹ <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; Sat Sep 03 2022 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) â€“ 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa-solid fa-star"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">fengzhenhua</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/fungzhenhua" class="github-corner" title="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" aria-label="åœ¨ GitHub ä¸Šå…³æ³¨æˆ‘" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://s4.zstatic.net/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://s4.zstatic.net/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://s4.zstatic.net/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://s4.zstatic.net/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://s4.zstatic.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
