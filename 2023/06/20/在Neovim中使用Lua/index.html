<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#9400D3"><meta name="generator" content="Hexo 5.4.2">
<link rel="preconnect" href="https://s4.zstatic.net" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#9400D3">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":"default"},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#9400D3","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":false,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script>



<link rel="canonical" href="http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/","path":"2023/06/20/在Neovim中使用Lua/","title":"在Neovim中使用Lua"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>在Neovim中使用Lua | BNU-FZH</title>
  







<script async src="/lib/fireworks.js"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">BNU-FZH</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">fengzhenhua@outlook.com</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-导航"><a href="/%E5%AF%BC%E8%88%AA/" rel="section"><i class="fa fa-paper-plane fa-fw"></i>导航</a></li><li class="menu-item menu-item-软件"><a href="/%E8%BD%AF%E4%BB%B6/" rel="section"><i class="fa fa-briefcase fa-fw"></i>软件</a></li><li class="menu-item menu-item-收藏"><a href="/%E6%94%B6%E8%97%8F/" rel="section"><i class="fa fa-folder fa-fw"></i>收藏</a></li><li class="menu-item menu-item-工作"><a href="/%E5%B7%A5%E4%BD%9C/" rel="section"><i class="fa fa-folder fa-fw"></i>工作</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%A8-neovim-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua"><span class="nav-number">1.</span> <span class="nav-text">在 neovim 中使用 Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0-lua"><span class="nav-number">1.1.1.</span> <span class="nav-text">学习 Lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E6%9C%89%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9C%A8-neovim-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua-%E7%9A%84%E6%95%99%E7%A8%8B"><span class="nav-number">1.1.2.</span> <span class="nav-text">现有的一些在 Neovim
中使用 Lua 的教程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6"><span class="nav-number">1.1.3.</span> <span class="nav-text">相关插件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#lua-%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">Lua 文件位置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#init.lua"><span class="nav-number">1.2.1.</span> <span class="nav-text">init.lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97"><span class="nav-number">1.2.2.</span> <span class="nav-text">模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">提示</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%96%87%E4%BB%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">运行时文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA-1"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">提示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-vimscript-%E4%B8%AD%E4%BD%BF%E7%94%A8-lua"><span class="nav-number">1.3.</span> <span class="nav-text">在 Vimscript 中使用 Lua</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lua"><span class="nav-number">1.3.1.</span> <span class="nav-text">:lua</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#luado"><span class="nav-number">1.3.2.</span> <span class="nav-text">:luado</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-lua-%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.3.</span> <span class="nav-text">加载 Lua 文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD-lua-%E6%96%87%E4%BB%B6%E5%AF%B9%E6%AF%94-require"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">加载 Lua 文件对比 require():</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#luaeval"><span class="nav-number">1.3.4.</span> <span class="nav-text">luaeval()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vlua"><span class="nav-number">1.3.5.</span> <span class="nav-text">v:lua</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats"><span class="nav-number">1.3.5.1.</span> <span class="nav-text">Caveats</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E7%A4%BA-2"><span class="nav-number">1.3.5.2.</span> <span class="nav-text">提示</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#vim-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="nav-number">1.4.</span> <span class="nav-text">Vim 命名空间</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips"><span class="nav-number">1.4.0.1.</span> <span class="nav-text">Tips</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8-lua-%E4%B8%AD%E4%BD%BF%E7%94%A8-vimscript"><span class="nav-number">1.5.</span> <span class="nav-text">在 Lua 中使用 Vimscript</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_eval"><span class="nav-number">1.5.1.</span> <span class="nav-text">vim.api.nvim_eval()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-1"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_exec"><span class="nav-number">1.5.2.</span> <span class="nav-text">vim.api.nvim_exec()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-2"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_command"><span class="nav-number">1.5.3.</span> <span class="nav-text">vim.api.nvim_command()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.cmd"><span class="nav-number">1.5.4.</span> <span class="nav-text">vim.cmd()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips-1"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">Tips</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.api.nvim_replace_termcodes"><span class="nav-number">1.5.5.</span> <span class="nav-text">vim.api.nvim_replace_termcodes()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86-vim-%E7%9A%84%E8%AE%BE%E7%BD%AE%E9%80%89%E9%A1%B9"><span class="nav-number">1.6.</span> <span class="nav-text">管理 vim 的设置选项</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-api-%E5%87%BD%E6%95%B0"><span class="nav-number">1.6.1.</span> <span class="nav-text">使用 api 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%83%E8%AE%BF%E9%97%AE%E5%99%A8"><span class="nav-number">1.6.2.</span> <span class="nav-text">使用元访问器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%A1%E7%90%86-vim-%E7%9A%84%E5%86%85%E9%83%A8%E5%8F%98%E9%87%8F"><span class="nav-number">1.7.</span> <span class="nav-text">管理 vim 的内部变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-api-%E5%87%BD%E6%95%B0-1"><span class="nav-number">1.7.1.</span> <span class="nav-text">使用 api 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%85%83%E8%AE%BF%E9%97%AE%E5%99%A8-1"><span class="nav-number">1.7.2.</span> <span class="nav-text">使用元访问器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-3"><span class="nav-number">1.7.2.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E7%94%A8-vimscript-%E5%87%BD%E6%95%B0"><span class="nav-number">1.8.</span> <span class="nav-text">调用 Vimscript 函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.fn.function"><span class="nav-number">1.8.1.</span> <span class="nav-text">vim.fn.{function}()</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#tips-2"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">Tips</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#caveats-4"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">Caveats</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84"><span class="nav-number">1.9.</span> <span class="nav-text">定义映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#api-%E5%87%BD%E6%95%B0"><span class="nav-number">1.9.1.</span> <span class="nav-text">API 函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.keymap"><span class="nav-number">1.9.2.</span> <span class="nav-text">vim.keymap</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4"><span class="nav-number">1.10.</span> <span class="nav-text">定义用户命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#caveats-5"><span class="nav-number">1.10.1.</span> <span class="nav-text">Caveats</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%87%AA%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.11.</span> <span class="nav-text">定义自动命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89%E8%AF%AD%E6%B3%95%E9%AB%98%E4%BA%AE"><span class="nav-number">1.12.</span> <span class="nav-text">定义语法高亮</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#general-tips-and-recommendations"><span class="nav-number">1.13.</span> <span class="nav-text">General tips and
recommendations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E7%BC%93%E5%AD%98%E7%9A%84%E6%A8%A1%E5%9D%97"><span class="nav-number">1.13.1.</span> <span class="nav-text">重新加载缓存的模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8D%E8%A6%81%E5%A1%AB%E5%85%85-lua-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.13.2.</span> <span class="nav-text">不要填充 Lua 字符串！</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-vimscript---lua-%E4%B9%8B%E9%97%B4%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.13.3.</span> <span class="nav-text">关于 Vimscript
&lt;-&gt; Lua 之间类型转换的注意事项</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E8%BD%AC%E6%8D%A2%E6%97%B6%E4%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%89%AF%E6%9C%AC"><span class="nav-number">1.13.3.1.</span> <span class="nav-text">变量转换时会创建一个副本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B9%B6%E4%B8%8D%E6%98%AF%E6%80%BB%E8%83%BD%E8%BF%9B%E8%A1%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.13.3.2.</span> <span class="nav-text">并不是总能进行类型转换</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vim-booleans"><span class="nav-number">1.13.3.3.</span> <span class="nav-text">Vim booleans</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE-linterslanguage-servers"><span class="nav-number">1.13.4.</span> <span class="nav-text">设置 linters&#x2F;language servers</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#luacheck"><span class="nav-number">1.13.4.1.</span> <span class="nav-text">luacheck</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sumnekolua-language-server"><span class="nav-number">1.13.4.2.</span> <span class="nav-text">sumneko&#x2F;lua-language-server</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#coc.nvim"><span class="nav-number">1.13.4.3.</span> <span class="nav-text">coc.nvim</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95-lua-%E4%BB%A3%E7%A0%81"><span class="nav-number">1.13.5.</span> <span class="nav-text">调试 Lua 代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95-lua-%E8%AE%BE%E7%BD%AE%E7%9A%84%E6%8C%89%E9%94%AE%E6%98%A0%E5%B0%84-%E7%94%A8%E6%88%B7%E5%91%BD%E4%BB%A4-%E8%87%AA%E5%8A%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.13.6.</span> <span class="nav-text">调试 Lua
设置的按键映射 &#x2F; 用户命令 &#x2F; 自动命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95-lua-%E4%BB%A3%E7%A0%81"><span class="nav-number">1.13.7.</span> <span class="nav-text">测试 Lua 代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-luarocks-%E5%8C%85"><span class="nav-number">1.13.8.</span> <span class="nav-text">使用 Luarocks 包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#miscellaneous"><span class="nav-number">1.14.</span> <span class="nav-text">Miscellaneous</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.loop"><span class="nav-number">1.14.1.</span> <span class="nav-text">vim.loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.lsp"><span class="nav-number">1.14.2.</span> <span class="nav-text">vim.lsp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim.treesitter"><span class="nav-number">1.14.3.</span> <span class="nav-text">vim.treesitter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#transpilers"><span class="nav-number">1.14.4.</span> <span class="nav-text">Transpilers</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name"></p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">549</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://chat.deepseek.com/" title="深度求索 → https:&#x2F;&#x2F;chat.deepseek.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>深度求索</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.tongyi.com/" title="通义千问 → https:&#x2F;&#x2F;www.tongyi.com&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>通义千问</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.scnet.cn/ui/chatbot/" title="国家超算 → https:&#x2F;&#x2F;www.scnet.cn&#x2F;ui&#x2F;chatbot&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>国家超算</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yuanbao.tencent.com/chat" title="腾讯元宝 → https:&#x2F;&#x2F;yuanbao.tencent.com&#x2F;chat" rel="noopener me" target="_blank"><i class="fa-solid fa-brain fa-fw"></i>腾讯元宝</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.bing.com/" title="必应搜索 → https:&#x2F;&#x2F;cn.bing.com" rel="noopener me" target="_blank"><i class="fa fa-search fa-fw"></i>必应搜索</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.hao268.com/" title="网址之家 → https:&#x2F;&#x2F;www.hao268.com" rel="noopener me" target="_blank"><i class="fa fa-search fa-fw"></i>网址之家</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://ac.scmor.com/" title="思谋学术 → https:&#x2F;&#x2F;ac.scmor.com" rel="noopener me" target="_blank"><i class="fa fa-graduation-cap fa-fw"></i>思谋学术</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://search.essclick.com/" title="爱思学术 → https:&#x2F;&#x2F;search.essclick.com" rel="noopener me" target="_blank"><i class="fa fa-graduation-cap fa-fw"></i>爱思学术</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://scholar.lanfanshu.cn/" title="番薯学术 → https:&#x2F;&#x2F;scholar.lanfanshu.cn&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>番薯学术</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://xmsoushu.com/" title="熊猫搜书 → https:&#x2F;&#x2F;xmsoushu.com&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>熊猫搜书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://cn.bing.com/translator" title="必应翻译 → https:&#x2F;&#x2F;cn.bing.com&#x2F;translator" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>必应翻译</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fanyi.baidu.com/#zh/en" title="百度翻译 → https:&#x2F;&#x2F;fanyi.baidu.com&#x2F;#zh&#x2F;en" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>百度翻译</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://fanyi.youdao.com/?keyfrom=fanyi.logo" title="有道翻译 → https:&#x2F;&#x2F;fanyi.youdao.com&#x2F;?keyfrom&#x3D;fanyi.logo" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>有道翻译</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.oxfordlearnersdictionaries.com/definition/english/" title="牛津翻译 → https:&#x2F;&#x2F;www.oxfordlearnersdictionaries.com&#x2F;definition&#x2F;english&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-language fa-fw"></i>牛津翻译</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://tools.liumingye.cn/music/#/" title="音乐下载 → http:&#x2F;&#x2F;tools.liumingye.cn&#x2F;music&#x2F;#&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-music fa-fw"></i>音乐下载</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://wx.qq.com/" title="网页微信 → https:&#x2F;&#x2F;wx.qq.com" rel="noopener me" target="_blank"><i class="fab fa-weixin fa-fw"></i>网页微信</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://login.partner.microsoftonline.cn/" title="微软办公 → https:&#x2F;&#x2F;login.partner.microsoftonline.cn" rel="noopener me" target="_blank"><i class="fas fa-file fa-fw"></i>微软办公</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mathsolver.microsoft.com/" title="微软数学 → https:&#x2F;&#x2F;mathsolver.microsoft.com" rel="noopener me" target="_blank"><i class="fas fa-file fa-fw"></i>微软数学</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.mail.bnu.edu.cn/" title="师大邮箱 → https:&#x2F;&#x2F;www.mail.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>师大邮箱</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://mail.sina.com.cn/" title="新浪邮箱 → https:&#x2F;&#x2F;mail.sina.com.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>新浪邮箱</a>
      </span>
      <span class="links-of-author-item">
        <a href="http://192.168.1.14/" title="实验信息 → http:&#x2F;&#x2F;192.168.1.14&#x2F;" rel="noopener me" target="_blank"><i class="fa-solid fa-cloud fa-fw"></i>实验信息</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.aliyundrive.com/sign/in" title="阿里云盘 → https:&#x2F;&#x2F;www.aliyundrive.com&#x2F;sign&#x2F;in" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>阿里云盘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yun.139.com/w/#/" title="移动云盘 → https:&#x2F;&#x2F;yun.139.com&#x2F;w&#x2F;#&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>移动云盘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianguoyun.com/d/login" title="坚果网盘 → https:&#x2F;&#x2F;www.jianguoyun.com&#x2F;d&#x2F;login" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>坚果网盘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://efss.qloud.my/index.php/login?clear=1" title="Next云盘 → https:&#x2F;&#x2F;efss.qloud.my&#x2F;index.php&#x2F;login?clear&#x3D;1" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>Next云盘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.123pan.com/" title="123 网盘 → https:&#x2F;&#x2F;www.123pan.com&#x2F;" rel="noopener me" target="_blank"><i class="fa fa-hdd fa-fw"></i>123 网盘</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://annas-archive.org/" title="安娜档案 → https:&#x2F;&#x2F;annas-archive.org&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>安娜档案</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://book.sciencereading.cn/" title="科学文库 → https:&#x2F;&#x2F;book.sciencereading.cn" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>科学文库</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://ylibrary.org/" title="Ylibrary → https:&#x2F;&#x2F;ylibrary.org&#x2F;" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>Ylibrary</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.tboxn.com/sites/320.html" title="Zlibrary → https:&#x2F;&#x2F;www.tboxn.com&#x2F;sites&#x2F;320.html" rel="noopener me" target="_blank"><i class="fas fa-book fa-fw"></i>Zlibrary</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.koushare.com/" title="蔻享官网 → https:&#x2F;&#x2F;www.koushare.com" rel="noopener me" target="_blank"><i class="fas fa-globe-asia fa-fw"></i>蔻享官网</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.duolingo.cn/" title="多邻国官 → https:&#x2F;&#x2F;www.duolingo.cn" rel="noopener me" target="_blank"><i class="fas fa-school fa-fw"></i>多邻国官</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.bnu.edu.cn/" title="师大官网 → https:&#x2F;&#x2F;www.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fas fa-university fa-fw"></i>师大官网</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://one.bnu.edu.cn/" title="数字京师 → https:&#x2F;&#x2F;one.bnu.edu.cn" rel="noopener me" target="_blank"><i class="fas fa-university fa-fw"></i>数字京师</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.runoob.com/font-awesome/fontawesome-icons-brand.html" title="图站图标 → https:&#x2F;&#x2F;www.runoob.com&#x2F;font-awesome&#x2F;fontawesome-icons-brand.html" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>图站图标</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://shields.io/badges" title="项目微标 → https:&#x2F;&#x2F;shields.io&#x2F;badges" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>项目微标</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.latexlive.com/" title="LaTeXLiv → https:&#x2F;&#x2F;www.latexlive.com" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>LaTeXLiv</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.latexlive.com/help" title="LaTeXHel → https:&#x2F;&#x2F;www.latexlive.com&#x2F;help" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>LaTeXHel</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://p2t.breezedeus.com/" title="Pix2Text → https:&#x2F;&#x2F;p2t.breezedeus.com" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>Pix2Text</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://simpletex.cn/" title="Simplete → https:&#x2F;&#x2F;simpletex.cn" rel="noopener me" target="_blank"><i class="fas fa-globe fa-fw"></i>Simplete</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/06/20/%E5%9C%A8Neovim%E4%B8%AD%E4%BD%BF%E7%94%A8Lua/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BNU-FZH">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="在Neovim中使用Lua | BNU-FZH">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          在Neovim中使用Lua
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-06-20 10:19:49" itemprop="dateCreated datePublished" datetime="2023-06-20T10:19:49+08:00">2023-06-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-26 18:21:20" itemprop="dateModified" datetime="2025-03-26T18:21:20+08:00">2025-03-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="在-neovim-中使用-lua">在 neovim 中使用 Lua</h1>
<p>本文本最初来源是<a
target="_blank" rel="noopener" href="https://gitee.com/zhengqijun/nvim-lua-guide-zh/blob/main/README.md">nvim-lua-guide</a>,由于这段时间一直在学习使用Lua配置Neovim,
但是没有系统的教材，而这篇文章却恰好给了一个大致的框架，所以本文最初借用此文，待时机成熟再正式开始写作。</p>
<p><a
target="_blank" rel="noopener" href="https://github.com/nanotee/nvim-lua-guide">nvim-lua-guide</a>
中文版简易教程</p>
<p>译者：Neovim Core Developer</p>
<p>:arrow_upper_left: （感觉太多太杂乱？使用 Github TOC
来浏览大纲！）</p>
<h2 id="简介">简介</h2>
<p>Lua 作为 Neovim
中的一等语言的集成正在成为它的杀手级特性之一。然而，学习如何用 Lua
编写插件的教程数量并不像用 Vimscript
编写插件那样多。这是一种尝试，试图提供一些基本信息，让人们可以使用 Lua
编写 Neovim 插件。</p>
<span id="more"></span>
<p>本指南假定您使用的是 Neovim 0.5+</p>
<h3 id="学习-lua">学习 Lua</h3>
<p>不同于原版教程，以下资源适用于国内用户： - <a
target="_blank" rel="noopener" href="https://learnxinyminutes.com/docs/lua/">在 Y 分钟内学习 X 关于 Lua
的页面</a> - <a target="_blank" rel="noopener" href="https://www.runoob.com/lua/lua-tutorial.html">Lua
菜鸟教程</a> - <a target="_blank" rel="noopener" href="http://lua-users.org/wiki/LuaDirectory">Lua
用户维基</a> - <a target="_blank" rel="noopener" href="https://www.lua.org/manual/5.1/">Lua
的官方参考手册</a></p>
<p>Lua
是一种非常干净和简单的语言。它很容易学习，特别是如果你有其他编程语言基础的例如
TypeScript / JavaScript 等，会更加容易上手 Lua。注意：Neovim 嵌入的 Lua
版本是 LuaJIT 2.1.0，它与 Lua 5.1 保持兼容（带有几个 5.2 扩展）</p>
<h3 id="现有的一些在-neovim-中使用-lua-的教程">现有的一些在 Neovim
中使用 Lua 的教程</h3>
<p>已经编写了一些教程来帮助人们用 Lua
编写插件。他们中的一些人在写这本指南时提供了不少的帮助。非常感谢它们的作者。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://teukka.tech/luanvim.html">teukka.tech - 从 init.vim
转到 init.lua</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.2n.pl/blog/how-to-write-neovim-plugins-in-lua.md">2n.pl
- 如何使用 Lua 编写 neovim 插件</a></li>
<li><a
target="_blank" rel="noopener" href="https://www.2n.pl/blog/how-to-make-ui-for-neovim-plugins-in-lua">2n.pl
- 如何使用 Lua 制作 neovim UI</a></li>
<li><a target="_blank" rel="noopener" href="https://ms-jpq.github.io/lua-async-await/index.html">ms-jpq
- NeoVim 异步教程</a></li>
</ul>
<h3 id="相关插件">相关插件</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/svermeulen/vimpeccable">Vimpeccable</a>
- Plugin to help write your .vimrc in Lua</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim">plenary.nvim</a>
- All the lua functions I don't want to write twice</li>
<li><a target="_blank" rel="noopener" href="https://github.com/nvim-lua/popup.nvim">popup.nvim</a> - An
implementation of the Popup API from vim in Neovim</li>
<li><a target="_blank" rel="noopener" href="https://github.com/norcalli/nvim_utils">nvim_utils</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bfredl/nvim-luadev">nvim-luadev</a> -
REPL/debug console for nvim lua plugins</li>
<li><a target="_blank" rel="noopener" href="https://github.com/rafcamlet/nvim-luapad">nvim-luapad</a> -
Interactive real time neovim scratchpad for embedded lua engine</li>
<li><a target="_blank" rel="noopener" href="https://github.com/tjdevries/nlua.nvim">nlua.nvim</a> - Lua
Development for Neovim</li>
<li><a
target="_blank" rel="noopener" href="https://github.com/glepnir/galaxyline.nvim">galaxyline.nvim</a> -
neovim statusline plugin written in lua</li>
<li><a
target="_blank" rel="noopener" href="https://github.com/euclidianAce/BetterLua.vim">BetterLua.vim</a> -
Better Lua syntax highlighting in Vim/NeoVim</li>
</ul>
<h2 id="lua-文件位置">Lua 文件位置</h2>
<h3 id="init.lua">init.lua</h3>
<p>Neovim 支持从 <code>init.lua</code> 文件加载配置而不是通常的
<code>init.vim</code> 文件。</p>
<p>注意：<code>init.lua</code> 文件是完全可选的。Neovim 仍然支持从
<code>init.vim</code> 加载配置。请记住，Neovim 的一些功能还没有 100%
暴露给 Lua 模块部分。</p>
<h3 id="模块">模块</h3>
<p>Lua 模块通常位于您的 <code>runtimepath</code> 中的 <code>lua/</code>
文件夹中（对于大多数用户来说，在 *nix 系统上为
<code>~/.config/nvim/lua</code>，在 Windows 系统上为
<code>~/appdata/Local/nvim/lua</code>)。这意味着您可以
<code>require()</code> 这些文件作为 Lua 模块</p>
<p>我们以下面的文件夹结构为例：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">📂 ~/.config/nvim</span><br><span class="line">├── 📁 after</span><br><span class="line">├── 📁 ftplugin</span><br><span class="line">├── 📂 lua</span><br><span class="line">│  ├── 🌑 myluamodule.lua</span><br><span class="line">│  └── 📂 other_modules</span><br><span class="line">│     ├── 🌑 anothermodule.lua</span><br><span class="line">│     └── 🌑 init.lua</span><br><span class="line">├── 📁 pack</span><br><span class="line">├── 📁 plugin</span><br><span class="line">├── 📁 syntax</span><br><span class="line">└── 🇻 init.vim</span><br></pre></td></tr></table></figure>
<p>下面的 Lua 代码将加载 <code>myluamodule.lua</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;myluamodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>注意没有 <code>.lua</code> 扩展名。</p>
<p>类似地，加载 <code>other_modules/anothermodule.lua</code>
的过程如下：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules.anothermodule&#x27;</span>)</span><br><span class="line"><span class="comment">-- or</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules/anothermodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>路径分隔符可以用点 <code>.</code> 表示，也可以用斜杠 <code>/</code>
表示。</p>
<p>文件夹如果包含 <code>init.lua</code>
文件，可以直接引用该文件夹而不必指定该文件的名称</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;other_modules&#x27;</span>) <span class="comment">-- loads other_modules/init.lua</span></span><br></pre></td></tr></table></figure>
<p>加载一个不存在的模块或者加载的模块有语法错误会直接中止当前正在执行的脚本。<code>pcall()</code>
函数可以用来处理这类错误</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> ok, _ = <span class="built_in">pcall</span>(<span class="built_in">require</span>, <span class="string">&#x27;module_with_error&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">  <span class="comment">-- not loaded</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-require"><code>:help lua-require</code></a></li>
</ul>
<h4 id="提示">提示</h4>
<p>多个 Lua 插件在它们的 <code>lua/</code>
文件夹中可能有相同的文件名。这可能会导致命名空间冲突。如果两个不同的插件有一个
<code>lua/main.lua</code> 文件，那么执行 <code>require('main')</code>
是不明确的：我们想要加载哪个文件？最好将您的配置或插件命名为顶级文件夹，
例如这样的形式：<code>lua/plugin_name/main.lua</code>。</p>
<h3 id="运行时文件">运行时文件</h3>
<p>和 Vimscript 文件很像，位于 <code>runtimepath</code>
中的一些特殊目录中的 Lua 文件可以被 Neovim
自动加载。目前有以下这些特殊目录：</p>
<ul>
<li><code>colors/</code></li>
<li><code>compiler/</code></li>
<li><code>ftplugin/</code></li>
<li><code>indent/</code></li>
<li><code>plugin/</code></li>
<li><code>syntax/</code></li>
</ul>
<p>注意：在同一个运行时目录中，<code>*.vim</code> 文件会先于所有的
<code>*.lua</code> 文件被加载。</p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/options.html#&#39;runtimepath&#39;"><code>:help 'runtimepath'</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/starting.html#load-plugins"><code>:help load-plugins</code></a></li>
</ul>
<h4 id="提示-1">提示</h4>
<p>因为运行时文件并不基于 Lua 模块系统，所以两个不同的插件都拥有
<code>plugins/main.lua</code> 文件是没有任何问题的。</p>
<h2 id="在-vimscript-中使用-lua">在 Vimscript 中使用 Lua</h2>
<h3 id="lua">:lua</h3>
<p>该命令执行一段 Lua 代码</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> require(<span class="string">&#x27;myluamodule&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>可以使用以下语法编写多行脚本：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Here&#x27;s a bigger chunk of Lua code&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line">local <span class="keyword">mod</span> = require(<span class="string">&#x27;mymodule&#x27;</span>)</span><br><span class="line">local tbl = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">k</span>, v in ipairs(tbl) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">mod</span>.method(v)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(tbl)</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>注意：每个 <code>:lua</code> 命令都有它自己独立的作用域，在一条
<code>:lua</code> 命令中使用 <code>local</code>
关键字声明的变量是无法在这条命令之外访问的。如下代码所示</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> local foo = <span class="number">1</span></span><br><span class="line">:<span class="keyword">lua</span> <span class="keyword">print</span>(foo)</span><br><span class="line"><span class="comment">&quot; prints &#x27;nil&#x27; instead of &#x27;1&#x27;</span></span><br></pre></td></tr></table></figure>
<p>注意：Lua 中的 <code>print()</code> 函数的行为类似于
<code>:echomsg</code> 命令。它的输出会被保存在消息历史中，可以使用
<code>:slient</code> 命令来抛弃输出。</p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#Lua"><code>:help :lua</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:lua-heredoc"><code>:help :lua-heredoc</code></a></li>
</ul>
<h3 id="luado">:luado</h3>
<p>该命令执行一段 Lua
代码，该代码作用于当前缓冲区中的选中的行。如果未指定范围，则改为使用整个缓冲区。从块
<code>return</code> 的任何字符串都用于确定应该用什么替换每行。</p>
<p>以下命令会将当前缓冲区中的每一行替换为文本
<code>hello world</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luado</span> <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure>
<p>提供了两个隐式的 <code>line</code> 和 <code>linenr</code>
变量。<code>line</code> 是被迭代的行的文本，而 <code>linenr</code>
是它的编号。以下命令将可以被 2 整数的行转成大写：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luado</span> <span class="keyword">if</span> linenr % <span class="number">2</span> == <span class="number">0</span> then <span class="keyword">return</span> <span class="built_in">line</span>:upper() end</span><br></pre></td></tr></table></figure>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:luado"><code>:help :luado</code></a></li>
</ul>
<h3 id="加载-lua-文件">加载 Lua 文件</h3>
<p>Neovim 提供了三种执行命令来加载 Lua 文件</p>
<ul>
<li><code>:luafile</code></li>
<li><code>:source</code></li>
<li><code>:runtime</code></li>
</ul>
<p>其中 <code>:luafile</code> 和 <code>:source</code> 非常类似：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">luafile</span> ~/foo/bar/baz/myluafile.<span class="keyword">lua</span> <span class="comment">&quot; 加载 myluafile.lua</span></span><br><span class="line">:<span class="keyword">luafile</span> %                           <span class="comment">&quot; 加载当前正在处理的文件</span></span><br><span class="line">:<span class="keyword">source</span> ~/foo/bar/baz/myluafile.<span class="keyword">lua</span></span><br><span class="line">:<span class="keyword">source</span> %</span><br></pre></td></tr></table></figure>
<p>两种命令都可以指定文件范围，可以只执行脚本的一部分</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="number">1</span>,<span class="number">10</span><span class="keyword">source</span></span><br></pre></td></tr></table></figure>
<p><code>:runtime</code> 与上述两种命令有所不同，它使用
<code>'runtimepath'</code> 选项来决定加载哪个文件。更多细节信息请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:runtime"><code>:help :runtime</code></a></p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#:luafile"><code>:help :luafile</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:source"><code>:help :source</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/repeat.html#:runtime"><code>:help :runtime</code></a></li>
</ul>
<h4 id="加载-lua-文件对比-require">加载 Lua 文件对比 require():</h4>
<p>您可能想知道调用 <code>require()</code>
函数和使用上述命令加载之间的区别是什么，以及您是否应该使用其中一个而不是另一个。它们有不同的使用情形：</p>
<ul>
<li><code>require()</code>:
<ul>
<li>是内置的 Lua 函数，它允许你使用 Lua 的模块系统</li>
<li>在 <code>'runtimepath'</code> 中的 <code>lua/</code>
文件夹中搜索模块</li>
<li>跟踪已加载的模块，并防止第二次解析和执行脚本。如果您更改包含某个模块代码的文件，并在
Neovim 运行时再次尝试
<code>required()</code>，则该模块实际上不会更新</li>
</ul></li>
<li><code>:luafile</code>/<code>:source</code>/<code>:runtime</code>:
<ul>
<li>是一个执行命令，它不支持模块</li>
<li>执行脚本的内容，而不管该脚本以前是否执行过</li>
<li><code>:luafile</code>/<code>:source</code>
命令采用相对于当前窗口的工作目录的绝对或相对路径</li>
<li><code>:runtime</code> 命令使用 <code>'runtimepath'</code>
选项来寻找文件</li>
</ul></li>
</ul>
<p>同时，通过 <code>:source</code>/<code>:runtime</code> 命令（不包括
<code>:luafile</code> ）加载或者从运行时目录被自动加载的文件会显示在
<code>:scriptnames</code> 和 <code>--startuptime</code> 中。</p>
<h3 id="luaeval">luaeval()</h3>
<p><code>luaeval()</code> 是内置的 Vimscript 函数计算 Lua
表达式字符串并返回它的值。Lua 的数据类型自动转换为 Vimscript
类型（反之亦然）。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot; 你可以将结果存储到一个变量中</span></span><br><span class="line"><span class="keyword">let</span> variable = <span class="built_in">luaeval</span>(<span class="string">&#x27;1 + 1&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> variable</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"><span class="keyword">let</span> concat = <span class="built_in">luaeval</span>(<span class="string">&#x27;&quot;Lua&quot;..&quot; is &quot;..&quot;awesome&quot;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> concat</span><br><span class="line"><span class="comment">&quot; &#x27;Lua is awesome&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Lua 中的 table 数组转成成 Vimscript 的 list</span></span><br><span class="line"><span class="keyword">let</span> <span class="keyword">list</span> = <span class="built_in">luaeval</span>(<span class="string">&#x27;&#123;1, 2, 3, 4&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">list</span>[<span class="number">0</span>]</span><br><span class="line"><span class="comment">&quot; 1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">list</span>[<span class="number">1</span>]</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"><span class="comment">&quot; 注意 Vimscript 的数组索引下标与 Lua 不同是从 0 开始的，Lua 中是从 1 开始</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Lua 中类似 dict 的 table 会被转成 Vimscript 中的 dict</span></span><br><span class="line"><span class="keyword">let</span> dict = <span class="built_in">luaeval</span>(<span class="string">&#x27;&#123;foo = &quot;bar&quot;, baz = &quot;qux&quot;&#125;&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> dict.foo</span><br><span class="line"><span class="comment">&quot; &#x27;bar&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 布尔类型和 nil 是类似的</span></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;true&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; v:true</span></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;nil&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; v:null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 您可以为 Lua 函数创建 Vimscript 别名</span></span><br><span class="line"><span class="keyword">let</span> LuaMathPow = <span class="built_in">luaeval</span>(<span class="string">&#x27;math.pow&#x27;</span>)</span><br><span class="line"><span class="keyword">echo</span> LuaMathPow(<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">&quot; 4</span></span><br><span class="line"><span class="keyword">let</span> LuaModuleFunction = <span class="built_in">luaeval</span>(<span class="string">&#x27;require(&quot;mymodule&quot;).myfunction&#x27;</span>)</span><br><span class="line"><span class="keyword">call</span> LuaModuleFunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 还可以将 Lua 函数作为值传递给 Vim 函数</span></span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">X</span> = <span class="keyword">function</span>(<span class="keyword">k</span>, v) <span class="keyword">return</span> <span class="built_in">string</span>.format(<span class="string">&quot;%s:%s&quot;</span>, <span class="keyword">k</span>, v) end</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">map</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="built_in">luaeval</span>(<span class="string">&quot;X&quot;</span>))</span><br></pre></td></tr></table></figure>
<p><code>luaeval()</code>
接受可选的第二个参数，该参数允许您将数据传递给表达式。然后您可以使用全局的
<code>_A</code> 从 Lua 访问该数据：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;_A[1] + _A[2]&#x27;</span>, [<span class="number">1</span>, <span class="number">1</span>])</span><br><span class="line"><span class="comment">&quot; 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="built_in">luaeval</span>(<span class="string">&#x27;string.format(&quot;Lua is %s&quot;, _A)&#x27;</span>, <span class="string">&#x27;awesome&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; &#x27;Lua is awesome&#x27;</span></span><br></pre></td></tr></table></figure>
<p>更多信息请参见： - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#luaeval()"><code>:help luaeval()</code></a></p>
<h3 id="vlua">v:lua</h3>
<p>这个全局 Vim 变量允许您直接从 Vimscript 调用全局 Lua 函数（<a
target="_blank" rel="noopener" href="https://www.lua.org/manual/5.1/manual.html#pdf-_G"><code>_G</code></a>）。同样
Vim 数据类型被转换为 Lua 类型，反之亦然。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.<span class="keyword">print</span>(<span class="string">&#x27;Hello from Lua!&#x27;</span>)</span><br><span class="line"><span class="comment">&quot; &#x27;Hello from Lua!&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> scream = <span class="variable">v:lua</span>.<span class="built_in">string</span>.rep(<span class="string">&#x27;A&#x27;</span>, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">echo</span> scream</span><br><span class="line"><span class="comment">&quot; &#x27;AAAAAAAAAA&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Requiring modules works</span></span><br><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.require(<span class="string">&#x27;mymodule&#x27;</span>).myfunction()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; How about a nice statusline?</span></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line"><span class="keyword">function</span> _G.statusline()</span><br><span class="line">    local filepath = <span class="string">&#x27;%f&#x27;</span></span><br><span class="line">    local align_section = <span class="string">&#x27;%=&#x27;</span></span><br><span class="line">    local percentage_through_file = <span class="string">&#x27;%p%%&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">string</span>.format(</span><br><span class="line">        <span class="string">&#x27;%s%s%s&#x27;</span>,</span><br><span class="line">        filepath,</span><br><span class="line">        align_section,</span><br><span class="line">        percentage_through_file</span><br><span class="line">    )</span><br><span class="line">end</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> statusline=%!<span class="variable">v:lua</span>.statusline()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Also works in expression mappings</span></span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line"><span class="keyword">function</span> _G.check_back_space()</span><br><span class="line">    local <span class="keyword">col</span> = <span class="keyword">vim</span>.fn.<span class="keyword">col</span>(<span class="string">&#x27;.&#x27;</span>) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">col</span> == <span class="number">0</span> <span class="built_in">or</span> <span class="keyword">vim</span>.fn.<span class="built_in">getline</span>(<span class="string">&#x27;.&#x27;</span>):sub(<span class="keyword">col</span>, <span class="keyword">col</span>):<span class="keyword">match</span>(<span class="string">&#x27;%s&#x27;</span>) then</span><br><span class="line">        <span class="keyword">return</span> true</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> false</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;silent&gt;</span> <span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;Tab&gt;</span></span><br><span class="line">    \ <span class="built_in">pumvisible</span>() ? <span class="string">&#x27;\&lt;C-n&gt;&#x27;</span> :</span><br><span class="line">    \ <span class="variable">v:lua</span>.check_back_space() ? <span class="string">&#x27;\&lt;Tab&gt;&#x27;</span> :</span><br><span class="line">    \ completion#trigger_completion()</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 通过使用单引号包围模块名并省略 require 的括号来调用 Lua 模块中的函数</span></span><br><span class="line"><span class="keyword">call</span> <span class="variable">v:lua</span>.require<span class="string">&#x27;module&#x27;</span>.foo()</span><br></pre></td></tr></table></figure>
<p>更多信息请参见： - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#v:lua"><code>:help v:lua</code></a>
- <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#v:lua-call"><code>:help v:lua-call</code></a></p>
<h4 id="caveats">Caveats</h4>
<p><code>v:lua</code> 变量只能用于调用函数。以下代码将始终引发错误：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&quot; 不适用于别名一个函数</span></span><br><span class="line"><span class="keyword">let</span> LuaPrint = <span class="variable">v:lua</span>.<span class="keyword">print</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 不适用于访问 dict</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">v:lua</span>.some_global_dict[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; 不适用于将函数作为值使用</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">map</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="variable">v:lua</span>.global_callback)</span><br></pre></td></tr></table></figure>
<h4 id="提示-2">提示</h4>
<p>在配置文件中，可以通过设置 <code>let g:vimsyn_embed = 'l'</code> 实现
.vim 文件中的 Lua 语法高亮。关于此选项的更多信息请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/syntax.html#g:vimsyn_embed"><code>:help g:vimsyn_embed</code></a></p>
<h2 id="vim-命名空间">Vim 命名空间</h2>
<p>Neovim 会暴露一个全局的 <code>vim</code> 变量来作为 Lua 调用 Vim 的
APIs 的入口。它还提供给用户一些额外的函数和子模块“标准库”</p>
<p>一些比较实用的函数和子模块如下：</p>
<ul>
<li><code>vim.inspect</code>: 把 Lua 对象以更易读的方式打印（在打印 Lua
table 时会很有用）</li>
<li><code>vim.regex</code>: 在 Lua 中使用 Vim 正则表达式</li>
<li><code>vim.api</code>: 暴露 vim 的 API(<code>:h API</code>)
的模块（别的远程调用也是调用同样的 API)</li>
<li><code>vim.ui</code>: 可被插件覆写的 UI 相关函数</li>
<li><code>vim.loop</code>: Neovim 的 event lopp 模块（使用 LibUV)</li>
<li><code>vim.lsp</code>: 控制内置 LSP 客户端的模块</li>
<li><code>vim.treesitter</code>: 暴露 tree-sitter
库中一些实用函数的模块</li>
</ul>
<p>上面列举功能的并不全面。如果你想知道更多可行的操作可以参见：<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-stdlib"><code>:help lua-stdlib</code></a>
和 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim"><code>:help lua-vim</code></a>。你也可以通过
<code>:lua print(vim.inspect(vim))</code> 获得所有可用模块。API
函数的详细文档请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#api-global"><code>:help api-global</code></a></p>
<h4 id="tips">Tips</h4>
<p>每次你想检查一个对象时到要用 <code>print(vim.inspect(x))</code>
是相当繁琐的。你可以你的配置中写一个全局的包装器函数来替代这个繁琐的过程（在
Neovim 0.7.0+ 中，你可以使用内建的 <code>vim.pretty_print()</code>
，请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.pretty_print()"><code>:help vim.pretty_print()</code></a>）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.put</span><span class="params">(...)</span></span></span><br><span class="line">    <span class="keyword">local</span> objects = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, <span class="built_in">select</span>(<span class="string">&#x27;#&#x27;</span>, ...) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> v = <span class="built_in">select</span>(i, ...)</span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">insert</span>(objects, vim.inspect(v))</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">     <span class="built_in">print</span>(<span class="built_in">table</span>.<span class="built_in">concat</span>(objects, <span class="string">&#x27;\n&#x27;</span>))</span><br><span class="line">     <span class="keyword">return</span> ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>之后你就可以使用如下命令来快速检查对象内容了</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> <span class="keyword">put</span>(<span class="keyword">vim</span>.loop)</span><br></pre></td></tr></table></figure>
<p>此外，你也可以使用 <code>:lua</code> 命令通过在 Lua 表达式前加上
<code>=</code> 来美观地打印它</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">lua</span> =<span class="keyword">vim</span>.loop</span><br></pre></td></tr></table></figure>
<p>另外要注意的是，你可能会发现 Lua
会比其他语言少一些实用的内置函数（例如：<code>os.clock()</code>，返回以秒为单位，而不是以毫秒为单位的值）。仔细阅读
Neovim 提供的标准库和 <code>vim.fn</code>
（后续还会有更多内容），里面可以会有你想要的东西。</p>
<h2 id="在-lua-中使用-vimscript">在 Lua 中使用 Vimscript</h2>
<h3 id="vim.api.nvim_eval">vim.api.nvim_eval()</h3>
<p>此函数计算 Vimscript 表达式字符串并返回其值。Vimscript
数据类型自动转换为 Lua 类型（反之亦然）。</p>
<p>它等同于 vimscript 中的 <code>luaeval()</code> 函数</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Data types are converted correctly</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;1 + 1&#x27;</span>)) <span class="comment">-- 2</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_eval(<span class="string">&#x27;[1, 2, 3]&#x27;</span>))) <span class="comment">-- &#123; 1, 2, 3 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_eval(<span class="string">&#x27;&#123;&quot;foo&quot;: &quot;bar&quot;, &quot;baz&quot;: &quot;qux&quot;&#125;&#x27;</span>))) <span class="comment">-- &#123; baz = &quot;qux&quot;, foo = &quot;bar&quot; &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;v:true&#x27;</span>)) <span class="comment">-- true</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_eval(<span class="string">&#x27;v:null&#x27;</span>)) <span class="comment">-- nil</span></span><br></pre></td></tr></table></figure>
<h4 id="caveats-1">Caveats</h4>
<p>与 <code>luaeval()</code> 不同，<code>vim.api.nvim_eval()</code>
不提供隐式 <code>_A</code> 变量来传递数据给表达式。</p>
<h3 id="vim.api.nvim_exec">vim.api.nvim_exec()</h3>
<p>此函数用于计算 Vimscript
代码块。它接受一个包含要执行的源代码的字符串和一个布尔值，以确定代码的输出是否应该由函数返回（例如，您可以将输出存储在变量中）。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> result = vim.api.nvim_exec(</span><br><span class="line"><span class="string">[[</span></span><br><span class="line"><span class="string">let mytext = &#x27;hello world&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function! MyFunction(text)</span></span><br><span class="line"><span class="string">    echo a:text</span></span><br><span class="line"><span class="string">endfunction</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">call MyFunction(mytext)</span></span><br><span class="line"><span class="string">]]</span>,</span><br><span class="line"><span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result) <span class="comment">-- &#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="caveats-2">Caveats</h4>
<p>在 Neovim 0.6.0 之前，<code>nvim_exec</code> 不支持 script-local
的变量 （<code>s:</code>） 。</p>
<h3 id="vim.api.nvim_command">vim.api.nvim_command()</h3>
<p>此函数执行一个 EX 命令。它接受包含要执行的命令的字符串。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_command(<span class="string">&#x27;new&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;wincmd H&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;set nonumber&#x27;</span>)</span><br><span class="line">vim.api.nvim_command(<span class="string">&#x27;%s/foo/bar/g&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="vim.cmd">vim.cmd()</h3>
<p><code>vim.api.nvim_exec()</code>
的别名。只需要命令部分的参数，<code>output</code> 参数始终为
<code>false</code></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">vim</span>.cmd(<span class="string">&#x27;buffers&#x27;</span>)</span><br><span class="line"><span class="keyword">vim</span>.cmd([[</span><br><span class="line"><span class="keyword">let</span> <span class="variable">g:multiline_list</span> = [</span><br><span class="line">            \ <span class="number">1</span>,</span><br><span class="line">            \ <span class="number">2</span>,</span><br><span class="line">            \ <span class="number">3</span>,</span><br><span class="line">            \ ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:multiline_list</span></span><br><span class="line">]])</span><br></pre></td></tr></table></figure>
<h4 id="tips-1">Tips</h4>
<p>由于您必须将字符串传递给这些函数，因此通常需要添加转义的反斜杠：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.cmd(<span class="string">&#x27;%s/\\Vfoo/bar/g&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>非转义字符串更方便使用，它们不需要额外的转义反斜杠：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.cmd(<span class="string">[[%s/\Vfoo/bar/g]]</span>)</span><br></pre></td></tr></table></figure>
<h3
id="vim.api.nvim_replace_termcodes">vim.api.nvim_replace_termcodes()</h3>
<p>这个 API 函数允许你转义终端代码和 Vim 键码。</p>
<p>你可能见过这样的映射：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inoremap</span> <span class="symbol">&lt;expr&gt;</span> <span class="symbol">&lt;Tab&gt;</span> <span class="built_in">pumvisible</span>() ? <span class="string">&quot;\&lt;C-N&gt;&quot;</span> : <span class="string">&quot;\&lt;Tab&gt;&quot;</span></span><br></pre></td></tr></table></figure>
<p>在 Lua 中实现相同的功能是比较困难的。你可能会像这样实现</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.smart_tab</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> <span class="string">[[\&lt;C-N&gt;]]</span> <span class="keyword">or</span> <span class="string">[[\&lt;Tab&gt;]]</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="string">&#x27;v:lua.smart_tab()&#x27;</span>, &#123;expr = <span class="literal">true</span>, noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>然后你会发现这样实现上述映射只会单纯插入 <code>\&lt;Tab&gt;</code> 和
<code>\&lt;C-N&gt;</code> 两个字符串字面量……</p>
<p>能够转义键码实际上是 Vimscript 的一项功能。
除了许多编程语言常用的转义序列（如 <code>\r</code>、<code>\42</code> 或
<code>\x10</code>）外，Vimscript 中的
<code>expr-quotes</code>（用双引号括起来的字符串）允许你转义 Vim
键码的易读形式。</p>
<p>Lua 中并没有内置这种功能。幸运的是，Neovim
提供了一个用来转义终端代码和 Vim 键码的 API
函数：<code>nvim_replace_termcodes()</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.api.nvim_replace_termcodes(<span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>))</span><br></pre></td></tr></table></figure>
<p>这样调用过于冗长，我们可以创建一个方便重复调用的包装：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The function is called `t` for `termcodes`.</span></span><br><span class="line"><span class="comment">-- You don&#x27;t have to call it that, but I find the terseness convenient</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="comment">-- Adjust boolean arguments as needed</span></span><br><span class="line">    <span class="keyword">return</span> vim.api.nvim_replace_termcodes(str, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(t<span class="string">&#x27;&lt;Tab&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>回到先前的例子，我们可以这样实现那个映射</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(str)</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.api.nvim_replace_termcodes(str, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_G.smart_tab</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> t<span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> t<span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="string">&#x27;v:lua.smart_tab()&#x27;</span>, &#123;expr = <span class="literal">true</span>, noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>如果我们使用 <code>vim.keymap.set()</code> 函数（Neovim
0.7.0+）来设置的话就不需要转义键码，<code>vim.keymap.set()</code>
默认会自动转义返回值中的键码（<code>expr</code> 选项设置为
<code>true</code>）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible() == <span class="number">1</span> <span class="keyword">and</span> <span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span>, &#123;expr = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/intro.html#keycodes"><code>:help keycodes</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#expr-quote"><code>:help expr-quote</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_replace_termcodes()"><code>:help nvim_replace_termcodes()</code></a></li>
</ul>
<h2 id="管理-vim-的设置选项">管理 vim 的设置选项</h2>
<h3 id="使用-api-函数">使用 api 函数</h3>
<p>Neovim 提供了一组 API 函数来设置选项或获取其当前值：</p>
<ul>
<li>全局选项：
<ul>
<li><code>vim.api.nvim_set_option()</code></li>
<li><code>vim.api.nvim_get_option()</code></li>
</ul></li>
<li>缓冲区选项：
<ul>
<li><code>vim.api.nvim_buf_set_option()</code></li>
<li><code>vim.api.nvim_buf_get_option()</code></li>
</ul></li>
<li>窗口选项：
<ul>
<li><code>vim.api.nvim_win_set_option()</code></li>
<li><code>vim.api.nvim_win_get_option()</code></li>
</ul></li>
</ul>
<p>它们接受一个字符串，其中包含要设置或者要获取的选项的名称以及要将其设置为的值。</p>
<p>布尔选项（如 <code>(no)number</code>) 必须设置为 <code>true</code> 或
<code>false</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;smarttab&#x27;</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;smarttab&#x27;</span>)) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<p>字符串选项必须设置为字符串：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;selection&#x27;</span>, <span class="string">&#x27;exclusive&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;selection&#x27;</span>)) <span class="comment">-- &#x27;exclusive&#x27;</span></span><br></pre></td></tr></table></figure>
<p>数字选项必须接受数字类型</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_option(<span class="string">&#x27;updatetime&#x27;</span>, <span class="number">3000</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_get_option(<span class="string">&#x27;updatetime&#x27;</span>)) <span class="comment">-- 3000</span></span><br></pre></td></tr></table></figure>
<p>Buffer-local 和 Window-local 选项还需要缓冲区编号或窗口编号（使用
<code>0</code> 将设置 / 获取当前缓冲区 / 窗口的选项）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_win_set_option(<span class="number">0</span>, <span class="string">&#x27;number&#x27;</span>, <span class="literal">true</span>)</span><br><span class="line">vim.api.nvim_buf_set_option(<span class="number">10</span>, <span class="string">&#x27;shiftwidth&#x27;</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_win_get_option(<span class="number">0</span>, <span class="string">&#x27;number&#x27;</span>)) <span class="comment">-- true</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_buf_get_option(<span class="number">10</span>, <span class="string">&#x27;shiftwidth&#x27;</span>)) <span class="comment">-- 4</span></span><br></pre></td></tr></table></figure>
<h3 id="使用元访问器">使用元访问器</h3>
<p>如果您想以更“惯用”的方式设置选项，可以使用一些元访问器。它们本质上包装了上述
API 函数，并允许您像处理变量一样操作选项：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.o"><code>vim.o</code></a>:
行为类似于 <code>:let &amp;&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.go"><code>vim.go</code></a>:
行为类似于 <code>:let &amp;g:&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.bo"><code>vim.bo</code></a>:
适用于 buffer-local 选项，行为类似于
<code>:let &amp;l:&#123;option-name&#125;</code></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.wo"><code>vim.wo</code></a>:
适用于 window-local 选项，行为类似于
<code>:let &amp;l:&#123;option-name&#125;</code></li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.o.smarttab = <span class="literal">false</span> <span class="comment">-- let &amp;smarttab = v:false</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.smarttab) <span class="comment">-- false</span></span><br><span class="line">vim.o.isfname = vim.o.isfname .. <span class="string">&#x27;,@-@&#x27;</span> <span class="comment">-- on Linux: let &amp;isfname = &amp;isfname .. &#x27;,@-@&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(vim.o.isfname) <span class="comment">-- &#x27;@,48-57,/,.,-,_,+,,,#,$,%,~,=,@-@&#x27;</span></span><br><span class="line"></span><br><span class="line">vim.bo.shiftwidth = <span class="number">4</span></span><br><span class="line"><span class="built_in">print</span>(vim.bo.shiftwidth) <span class="comment">-- 4</span></span><br></pre></td></tr></table></figure>
<p>您可以为缓冲区本地和窗口本地选项指定一个数字。如果未给出编号，则使用当前缓冲区
/ 窗口：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.bo[<span class="number">4</span>].expandtab = <span class="literal">true</span> <span class="comment">-- same as vim.api.nvim_buf_set_option(4, &#x27;expandtab&#x27;, true)</span></span><br><span class="line">vim.wo.number = <span class="literal">true</span> <span class="comment">-- same as vim.api.nvim_win_set_option(0, &#x27;number&#x27;, true)</span></span><br></pre></td></tr></table></figure>
<p>这些访问器还有更为复杂的 <code>vim.opt*</code> 变体，它们为在 Lua
中设置选项提供了更为灵活便利的机制，就像你在 <code>init.vim</code>
中使用的
<code>:set</code>/<code>:setglobal</code>/<code>:setlocal</code>:</p>
<ul>
<li><code>vim.opt</code>: 行为类似于 <code>:set</code></li>
<li><code>vim.opt_global</code>: 行为类似于 <code>:setglobal</code></li>
<li><code>vim.opt_local</code>: 行为类似于 <code>:setlocal</code></li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.smarttab = <span class="literal">false</span></span><br><span class="line"><span class="built_in">print</span>(vim.opt.smarttab:get()) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<p>一些选项也可以通过 Lua 的 table 来设置：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.completeopt = &#123;<span class="string">&#x27;menuone&#x27;</span>, <span class="string">&#x27;noselect&#x27;</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.opt.completeopt:get())) <span class="comment">-- &#123; &quot;menuone&quot;, &quot;noselect&quot; &#125;</span></span><br></pre></td></tr></table></figure>
<p>对于类似于 list/map/set
的选项，它们对应的包装器还实现了各种方法与元方法，行为类似于 Vimscript
中的 <code>:set+=</code>/<code>:set^=</code>/<code>:set-=</code>。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.opt.shortmess:append(&#123; I = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- alternative form:</span></span><br><span class="line">vim.opt.shortmess = vim.opt.shortmess + &#123; I = <span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line">vim.opt.whichwrap:<span class="built_in">remove</span>(&#123; <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;s&#x27;</span> &#125;)</span><br><span class="line"><span class="comment">-- alternative form:</span></span><br><span class="line">vim.opt.whichwrap = vim.opt.whichwrap - &#123; <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;s&#x27;</span> &#125;</span><br></pre></td></tr></table></figure>
<p>关于 <code>vim.opt</code> 的更多信息请参见：<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.opt"><code>:help vim.opt</code></a></p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim-options"><code>:help lua-vim-options</code></a></li>
</ul>
<h2 id="管理-vim-的内部变量">管理 vim 的内部变量</h2>
<h3 id="使用-api-函数-1">使用 api 函数</h3>
<p>与选项非常的相似，内部变量也有自己的 api 函数：</p>
<ul>
<li>全局变量 (<code>g:</code>):
<ul>
<li><code>vim.api.nvim_set_var()</code></li>
<li><code>vim.api.nvim_get_var()</code></li>
<li><code>vim.api.nvim_del_var()</code></li>
</ul></li>
<li>缓冲区变量 (<code>b:</code>):
<ul>
<li><code>vim.api.nvim_buf_set_var()</code></li>
<li><code>vim.api.nvim_buf_get_var()</code></li>
<li><code>vim.api.nvim_buf_del_var()</code></li>
</ul></li>
<li>窗口变量 (<code>w:</code>):
<ul>
<li><code>vim.api.nvim_win_set_var()</code></li>
<li><code>vim.api.nvim_win_get_var()</code></li>
<li><code>vim.api.nvim_win_del_var()</code></li>
</ul></li>
<li>选项卡变量 (<code>t:</code>):
<ul>
<li><code>vim.api.nvim_tabpage_set_var()</code></li>
<li><code>vim.api.nvim_tabpage_get_var()</code></li>
<li><code>vim.api.nvim_tabpage_del_var()</code></li>
</ul></li>
<li>预定义的 vim 变量 (<code>v:</code>):
<ul>
<li><code>vim.api.nvim_set_vvar()</code></li>
<li><code>vim.api.nvim_get_vvar()</code></li>
</ul></li>
</ul>
<p>除了预定义的 Vim 变量外，还可以删除它们（等同于 Vimscript 中的
<code>:unlet</code>)。局部变量 (<code>l:</code>)、脚本变量
(<code>s:</code>) 和函数参数 (<code>a:</code>) 不能操作，因为它们只在
Vim 脚本上下文中有意义，Lua 有自己的作用域规则。
如果您不熟悉这些变量的作用，请参考 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#internal-variables"><code>:help internal-variables</code></a>
对其进行详细介绍。 这些函数接受一个字符串，该字符串包含要设置 / 获取 /
删除的变量的名称以及要将其设置为的值。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_var(<span class="string">&#x27;some_global_variable&#x27;</span>, &#123; key1 = <span class="string">&#x27;value&#x27;</span>, key2 = <span class="number">300</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_get_var(<span class="string">&#x27;some_global_variable&#x27;</span>))) <span class="comment">-- &#123; key1 = &quot;value&quot;, key2 = 300 &#125;</span></span><br><span class="line">vim.api.nvim_del_var(<span class="string">&#x27;some_global_variable&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>范围为缓冲区、窗口或选项卡的变量会接受一个数字类型的参数 (0
意味着设置 / 获取 / 删除当前缓冲区 / 窗口 / 选项卡页的变量）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_win_set_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>, <span class="number">2500</span>)</span><br><span class="line">vim.api.nvim_tab_set_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>, <span class="string">&#x27;hello world&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_win_get_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>)) <span class="comment">-- 2500</span></span><br><span class="line"><span class="built_in">print</span>(vim.api.nvim_buf_get_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>)) <span class="comment">-- &#x27;hello world&#x27;</span></span><br><span class="line">vim.api.nvim_win_del_var(<span class="number">0</span>, <span class="string">&#x27;some_window_variable&#x27;</span>)</span><br><span class="line">vim.api.nvim_buf_del_var(<span class="number">3</span>, <span class="string">&#x27;some_tabpage_variable&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="使用元访问器-1">使用元访问器</h3>
<p>使用这些元访问器可以更直观地操作内部变量：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.g"><code>vim.g</code></a>:
全局变量</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.b"><code>vim.b</code></a>:
缓冲区变量</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.w"><code>vim.w</code></a>:
窗口变量</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.t"><code>vim.t</code></a>:
选项卡变量</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.v"><code>vim.v</code></a>:
预定义变量</li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.env"><code>vim.env</code></a>:
环境变量</li>
</ul>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim.g.some_global_variable = &#123;</span><br><span class="line">    key1 = <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">    key2 = <span class="number">300</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.g.some_global_variable)) <span class="comment">-- &#123; key1 = &quot;value&quot;, key2 = 300 &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 针对特定 buffer/window/tabpage 的变量 (Neovim 0.6+)</span></span><br><span class="line">vim.b[<span class="number">2</span>].myvar = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>一些变量名可能包含不能在 Lua
中用作标识符的字符。你可以使用以下语法操作这些变量：<code>vim.g['my#variable']</code>。</p>
<blockquote>
<p>在 Lua 中，<code>some_table.some_item</code> 本质上是
<code>some_table["some_item"]</code>
的语法糖，所以<code>vim.g['my#variable']</code> 也可以写为
<code>vim['g']['my#variable']</code></p>
<p>—— 译者注</p>
</blockquote>
<p>删除变量只需要将它的值设置为 nil</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.g.some_global_variable = <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>更多信息参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#lua-vim-variables"><code>:help lua-vim-variables</code></a></li>
</ul>
<h4 id="caveats-3">Caveats</h4>
<p>您不能从存储在这些变量之一的字典中添加 / 更新 / 删除键。 例如，这段
Vimscript 代码不能按预期工作：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:variable</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.variable.key = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:variable</span></span><br><span class="line"><span class="comment">&quot; &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>可以使用一个临时变量来解决</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:variable</span> = &#123;&#125;</span><br><span class="line"><span class="keyword">lua</span> &lt;&lt; EOF</span><br><span class="line">local tmp = <span class="keyword">vim</span>.g.variable</span><br><span class="line">tmp.key = <span class="string">&#x27;a&#x27;</span></span><br><span class="line"><span class="keyword">vim</span>.g.variable = tmp</span><br><span class="line">EOF</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:variable</span></span><br><span class="line"><span class="comment">&quot; &#123;&#x27;key&#x27;: &#x27;a&#x27;&#125;</span></span><br></pre></td></tr></table></figure>
<p>这是个已知的问题</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/issues/12544">Issue
#12544</a></li>
</ul>
<h2 id="调用-vimscript-函数">调用 Vimscript 函数</h2>
<h3 id="vim.fn.function">vim.fn.{function}()</h3>
<p><code>vim.fn</code> 可以用来调用 Vimscript 函数。数据类型在 Lua 和
Vimscript 之间自动转换。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.fn.printf(<span class="string">&#x27;Hello from %s&#x27;</span>, <span class="string">&#x27;Lua&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> reversed_list = vim.fn.<span class="built_in">reverse</span>(&#123; <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span> &#125;)</span><br><span class="line"><span class="built_in">print</span>(vim.inspect(reversed_list)) <span class="comment">-- &#123; &quot;c&quot;, &quot;b&quot;, &quot;a&quot; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">print_stdout</span><span class="params">(chan_id, data, name)</span></span></span><br><span class="line">    <span class="built_in">print</span>(data[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">vim.fn.jobstart(<span class="string">&#x27;ls&#x27;</span>, &#123; on_stdout = print_stdout &#125;)</span><br></pre></td></tr></table></figure>
<p>Hashes <code>#</code> 不是 Lua
中识别符的有效字符，因此必须使用以下语法调用 autoload 函数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.fn[<span class="string">&#x27;my#autoload#function&#x27;</span>]()</span><br></pre></td></tr></table></figure>
<p><code>vim.fn</code> 的功能与 <code>vim.call</code>
完全相同，但看起来更像是原生 Lua 函数调用。</p>
<p>和 <code>vim.api.nvim_call_function</code>
的不同之处在于，<code>vim.fn</code>
中数据类型的转换是自动的：对于浮点数类型，<code>vim.api.nvim_call_function</code>
会返回一个 table 并且它不支持 Lua 闭包作为参数；<code>vim.fn</code>
可以直接处理这些类型。</p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.fn"><code>:help vim.fn</code></a></li>
</ul>
<h4 id="tips-2">Tips</h4>
<p>Neovim
有一个强大的内置函数库，这些函数对插件非常有用。按字母顺序排列的函数列表参见
<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/eval.html#vim-function"><code>:help vim-function</code></a>，按主题分组的函数列表参见<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/usr_41.html#function-list"><code>:help function-list</code></a>。</p>
<p>Neovim 中的 API 函数可以通过 <code>vim.api.&#123;..&#125;</code>
的方式直接调用。更多信息请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#API"><code>:help api</code></a></p>
<h4 id="caveats-4">Caveats</h4>
<p>一些应该返回布尔值的 Vim 函数返回 <code>1</code> 或
<code>0</code>。这在 Vimscript 中不是问题，因为 <code>1</code>
是真的，而 <code>0</code> 是假的，支持如下结构：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&#x27;nvim&#x27;</span>)</span><br><span class="line">    <span class="comment">&quot; do something...</span></span><br><span class="line"><span class="keyword">endif</span></span><br></pre></td></tr></table></figure>
<p>然而，在 Lua 中，只有 <code>false</code> 和 <code>nil</code>
被认为是假的，数字的计算结果总是
<code>true</code>，无论它们的值是什么。您必须显式检查 <code>1</code> 或
<code>0</code>：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> vim.fn.has(<span class="string">&#x27;nvim&#x27;</span>) == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="comment">-- do something...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="定义映射">定义映射</h2>
<h3 id="api-函数">API 函数</h3>
<p>Neovim 提供了一系列的 api 函数来设置获取和删除映射：</p>
<ul>
<li>全局映射：
<ul>
<li><code>vim.api.nvim_set_keymap()</code></li>
<li><code>vim.api.nvim_get_keymap()</code></li>
<li><code>vim.api.nvim_del_keymap()</code></li>
</ul></li>
<li>缓冲区映射：
<ul>
<li><code>vim.api.nvim_buf_set_keymap()</code></li>
<li><code>vim.api.nvim_buf_get_keymap()</code></li>
<li><code>vim.api.nvim_buf_del_keymap()</code></li>
</ul></li>
</ul>
<p>让我们从 <code>vim.api.nvim_set_keymap()</code> 和
<code>vim.api.nvim_buf_set_keymap()</code>
开始，传递给函数的第一个参数是一个包含映射生效模式名称的字符串：</p>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 14%" />
<col style="width: 40%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>String value</th>
<th>Help page</th>
<th>Affected modes</th>
<th>Vimscript equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>''</code> (an empty string)</td>
<td><code>mapmode-nvo</code></td>
<td>Normal, Visual, Select, Operator-pending</td>
<td><code>:map</code></td>
</tr>
<tr>
<td><code>'n'</code></td>
<td><code>mapmode-n</code></td>
<td>Normal</td>
<td><code>:nmap</code></td>
</tr>
<tr>
<td><code>'v'</code></td>
<td><code>mapmode-v</code></td>
<td>Visual and Select</td>
<td><code>:vmap</code></td>
</tr>
<tr>
<td><code>'s'</code></td>
<td><code>mapmode-s</code></td>
<td>Select</td>
<td><code>:smap</code></td>
</tr>
<tr>
<td><code>'x'</code></td>
<td><code>mapmode-x</code></td>
<td>Visual</td>
<td><code>:xmap</code></td>
</tr>
<tr>
<td><code>'o'</code></td>
<td><code>mapmode-o</code></td>
<td>Operator-pending</td>
<td><code>:omap</code></td>
</tr>
<tr>
<td><code>'!'</code></td>
<td><code>mapmode-ic</code></td>
<td>Insert and Command-line</td>
<td><code>:map!</code></td>
</tr>
<tr>
<td><code>'i'</code></td>
<td><code>mapmode-i</code></td>
<td>Insert</td>
<td><code>:imap</code></td>
</tr>
<tr>
<td><code>'l'</code></td>
<td><code>mapmode-l</code></td>
<td>Insert, Command-line, Lang-Arg</td>
<td><code>:lmap</code></td>
</tr>
<tr>
<td><code>'c'</code></td>
<td><code>mapmode-c</code></td>
<td>Command-line</td>
<td><code>:cmap</code></td>
</tr>
<tr>
<td><code>'t'</code></td>
<td><code>mapmode-t</code></td>
<td>Terminal</td>
<td><code>:tmap</code></td>
</tr>
</tbody>
</table>
<p>第二个参数是包含映射左侧的字符串（触发映射中定义的命令的键或键集）。空字符串相当于
<code>&lt;Nop&gt;</code>，表示禁用键位。</p>
<p>第三个参数是包含映射右侧（要执行的命令）的字符串。</p>
<p>最后一个参数是一个表，包含 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#:map-arguments"><code>:help :map-arguments</code></a>
中定义的映射的布尔值选项（包括 <code>noremap</code>，不包括
<code>buffer</code>)。</p>
<p>缓冲区-本地映射也将缓冲区编号作为其第一个参数(<code>0</code>
设置当前缓冲区的映射）。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;leader&gt;&lt;Space&gt;&#x27;</span>, <span class="string">&#x27;:set hlsearch!&lt;CR&gt;&#x27;</span>, &#123; noremap = <span class="literal">true</span>, silent = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- :nnoremap &lt;silent&gt; &lt;leader&gt;&lt;Space&gt; :set hlsearch&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_buf_set_keymap(<span class="number">0</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;cc&#x27;</span>, <span class="string">&#x27;line(&quot;.&quot;) == 1 ? &quot;cc&quot; : &quot;ggcc&quot;&#x27;</span>, &#123; noremap = <span class="literal">true</span>, expr = <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="comment">-- :noremap &lt;buffer&gt; &lt;expr&gt; cc line(&#x27;.&#x27;) == 1 ? &#x27;cc&#x27; : &#x27;ggcc&#x27;</span></span><br><span class="line"></span><br><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex&#x27;</span>, <span class="string">&#x27;&#x27;</span>, &#123;</span><br><span class="line">    noremap = <span class="literal">true</span>,</span><br><span class="line">    callback = <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;My example&#x27;</span>)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="comment">-- Since Lua function don&#x27;t have a useful string representation, you can use the &quot;desc&quot; option to document your mapping</span></span><br><span class="line">    desc = <span class="string">&#x27;Prints &quot;My example&quot; in the message area&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_get_keymap()</code>
接受一个字符串，该字符串包含您想要映射列表的模式的短名称（见上表）。返回值是包含该模式的所有全局映射的表。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_get_keymap(<span class="string">&#x27;n&#x27;</span>)))</span><br><span class="line"><span class="comment">-- :verbose nmap</span></span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_buf_get_keymap()</code>
将缓冲区编号作为其第一个参数 (<code>0</code>
将获取当前缓冲区的映射）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.inspect(vim.api.nvim_buf_get_keymap(<span class="number">0</span>, <span class="string">&#x27;i&#x27;</span>)))</span><br><span class="line"><span class="comment">-- :verbose imap &lt;buffer&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_del_keymap()</code> 获取映射左侧的模式。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_del_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;leader&gt;&lt;Space&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nunmap &lt;leader&gt;&lt;Space&gt;</span></span><br></pre></td></tr></table></figure>
<p>同样，<code>vim.api.nvim_buf_del_keymap()</code>
以缓冲区编号作为第一个参数，其中 <code>0</code> 表示当前缓冲区。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_del_keymap(<span class="number">0</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :iunmap &lt;buffer&gt; &lt;Tab&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="vim.keymap">vim.keymap</h3>
<p>:warning: 本节讨论的函数仅适用于 Neovim 0.7.0+</p>
<p>Neovim 提供了两个函数来设置 / 删除映射：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.set()"><code>vim.keymap.set()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.del()"><code>vim.keymap.del()</code></a></li>
</ul>
<p>它们是上述 API 函数的语法糖版本。</p>
<p><code>vim.keymap.set()</code>
第一个参数是字符串，代表映射生效的模式，也可以是一个字符串
table，这样可以一次性定义多个模式下的映射：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;lua vim.notify(&quot;Example 1&quot;)&lt;CR&gt;&#x27;</span>)</span><br><span class="line">vim.keymap.set(&#123;<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;lua vim.notify(&quot;Example 2&quot;)&lt;CR&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>第二个参数是映射的左侧，是字符串类型</p>
<p>第三个参数是映射的右侧，既可以是字符串也可以是一个 Lua 函数：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echomsg &quot;Example 1&quot;&lt;CR&gt;&#x27;</span>)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&quot;Example 2&quot;</span>) <span class="keyword">end</span>)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;pl1&#x27;</span>, <span class="built_in">require</span>(<span class="string">&#x27;plugin&#x27;</span>).plugin_action)</span><br><span class="line"><span class="comment">-- To avoid the startup cost of requiring the module, you can wrap it in a function to require it lazily when invoking the mapping:</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;pl2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">require</span>(<span class="string">&#x27;plugin&#x27;</span>).plugin_action() <span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>第四个参数是是一个选项的 table，它是可选的，对应于传递给
<code>vim.apt.nvim_set_keymap()</code>
的选项，并添加了一些内容（完整列表请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.keymap.set()"><code>:help vim.keymap.set()</code></a>）。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echomsg &quot;Example 1&quot;&lt;CR&gt;&#x27;</span>, &#123;buffer = <span class="literal">true</span>&#125;)</span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="built_in">print</span>(<span class="string">&#x27;Example 2&#x27;</span>) <span class="keyword">end</span>, &#123;desc = <span class="string">&#x27;Prints &quot;Example 2&quot; to the message area&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>使用 Lua 函数定义映射不同于使用字符串。 像
<code>:nmap &lt;Leader&gt;ex1</code>
之类的显示映射信息的常用方法不会输出有用的信息（映射到的字符串本身），而只会显示
Lua 函数。 建议添加一个 <code>desc</code>
项来描述你的按键映射的行为。这对于记录插件映射尤其重要，用户可以更轻松地了解案件映射的用法。</p>
<p>这个 API 的有用之处在于它消除了 Vim 映射的历史遗留问题：</p>
<ul>
<li><p>映射默认是 <code>noremap</code> 的，除非 <code>rhs</code> 是一个
<code>&lt;Plug&gt;</code>
映射。这意味着你很少需要考虑映射是否应该是递归的：</p>
<p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;test1&#x27;</span>, <span class="string">&#x27;&lt;Cmd&gt;echo &quot;test&quot;&lt;CR&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nnoremap &lt;Leader&gt;test &lt;Cmd&gt;echo &quot;test&quot;&lt;CR&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 如果你确定要设置一个递归的映射，把 &quot;remap&quot; 选项设置为 &quot;true&quot;</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, &#123;remap = <span class="literal">true</span>&#125;)</span><br><span class="line"><span class="comment">-- :nmap &gt; ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 除非是递归映射，否则 &lt;Plug&gt; 映射不会起作用，vim.keymap.set() 会自动为你处理</span></span><br><span class="line">vim.keymap.set(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;plug&#x27;</span>, <span class="string">&#x27;&lt;Plug&gt;(plugin)&#x27;</span>)</span><br><span class="line"><span class="comment">-- :nmap &lt;Leader&gt;plug &lt;Plug&gt;(plugin)</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>在 <code>expr</code>
映射中，<code>nvim_replace_termcodes()</code> 会被自动应用于 Lua
函数返回的字符串</p>
<p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.set(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;&lt;Tab&gt;&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">return</span> vim.fn.pumvisible == <span class="number">1</span> <span class="keyword">and</span> <span class="string">&#x27;&lt;C-N&gt;&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;&lt;Tab&gt;&#x27;</span></span><br><span class="line"><span class="keyword">end</span>, &#123;expr = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure></p></li>
</ul>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#recursive_mapping"><code>:help recursive_mapping</code></a></li>
</ul>
<p><code>vim.keymap.del()</code> 工作原理相同，但是效果是删除映射：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.keymap.del(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;ex1&#x27;</span>)</span><br><span class="line">vim.keymap.del(&#123;<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;c&#x27;</span>&#125;, <span class="string">&#x27;&lt;Leader&gt;ex2&#x27;</span>, &#123;buffer = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="定义用户命令">定义用户命令</h2>
<p>:warning: 本节讨论的 API 函数仅适用于 Neovim 0.7.0+</p>
<p>Neovim 提供了如下 API 函数来创建用户命令</p>
<ul>
<li>全局用户命令
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>vim.api.nvim_create_user_command()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_del_user_command()"><code>vim.api.nvim_del_user_command()</code></a></li>
</ul></li>
<li>Buffer-local 的用户命令
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_buf_create_user_command()"><code>vim.api.nvim_buf_create_user_command()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_buf_del_user_command()"><code>vim.api.nvim_buf_del_user_command()</code></a></li>
</ul></li>
</ul>
<p>以 <code>vim.api.nvim_create_user_command()</code> 为例说明用法</p>
<p>此函数的第一个参数是命令的名字（必须以大写字母开头）。</p>
<p>第二个参数是调用该命令时要执行的代码。它可以是：</p>
<p>一个字符串（在这种情况下它将作为 Vimscript 执行）。你可以像使用
<code>:command</code> 一样使用转义序列，譬如
<code>&lt;q-args&gt;</code>、<code>&lt;range&gt;</code> 等</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Upper&#x27;</span>, <span class="string">&#x27;echo toupper(&lt;q-args&gt;)&#x27;</span>, &#123; nargs = <span class="number">1</span> &#125;)</span><br><span class="line"><span class="comment">-- :command! -nargs=1 Upper echo toupper(&lt;q-args&gt;)</span></span><br><span class="line"></span><br><span class="line">vim.cmd(<span class="string">&#x27;Upper hello world&#x27;</span>) <span class="comment">-- prints &quot;HELLO WORLD&quot;</span></span><br></pre></td></tr></table></figure>
<p>或者是一个 Lua 函数。它接受一个类似字典的
table，其中包含通常是由转义序列提供的数据（可用的所有键请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>:help nvim_create_user_command()</code></a>）</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(</span><br><span class="line">    <span class="string">&#x27;Upper&#x27;</span>,</span><br><span class="line">    <span class="function"><span class="keyword">function</span><span class="params">(opts)</span></span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">upper</span>(opts.args))</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    &#123; nargs = <span class="number">1</span> &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>第三个参数是一个包含命令属性的 table（请参见 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#command-attributes"><code>:help command-attributes</code></a>）。值得注意的是，由于你可以使用
<code>vim.api.nvim_buf_create_user_command()</code> 来创建 buffer-local
的用户命令，所以 <code>-buffer</code> 不是一个有效的属性。</p>
<p>此外还有两种属性可用：</p>
<ul>
<li><code>desc</code> 属性是你在定义为 Lua 回调函数的命令上运行
<code>:command &#123;cmd&#125;</code>
时显示的内容。与上文中的键盘映射类似，我们建议在定义为 Lua
函数的命令中加入此属性。</li>
<li><code>force</code> 属性相当于调用 <code>:command!</code>
并且替换已经存在的同名命令。与 Vimscript 不同，它的默认值为
<code>true</code></li>
</ul>
<p>除了 <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#:command-complete"><code>:help :command-complete</code></a>
中列出的属性之外，<code>-complete</code> 还可以设置为一个 Lua 函数。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Upper&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;</span><br><span class="line">    nargs = <span class="number">1</span>,</span><br><span class="line">    complete = <span class="function"><span class="keyword">function</span><span class="params">(ArgLead, CmdLine, CursorPos)</span></span></span><br><span class="line">        <span class="comment">-- return completion candidates as a list-like table</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span> &#125;</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Buffer-local 的用户命令把 buffer 编号作为第一个参数。这比
<code>-buffer</code> 更优，后者只能为当前的 buffer 定义命令。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_create_user_command(<span class="number">4</span>, <span class="string">&#x27;Upper&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p><code>vim.api.nvim_del_user_command()</code>
的参数是要删除命令的名字。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_del_user_command(<span class="string">&#x27;Upper&#x27;</span>)</span><br><span class="line"><span class="comment">-- :delcommand Upper</span></span><br></pre></td></tr></table></figure>
<p>同样的，<code>vim.api.nvim_buf_del_user_command()</code> 也把 buffer
编号作为第一个参数，<code>0</code> 代表当前的 buffer。</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_buf_del_user_command(<span class="number">4</span>, <span class="string">&#x27;Upper&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_create_user_command()"><code>:help nvim_create_user_command</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/usr_40.html#40.2"><code>:help 40.2</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/map.html#command-attributes"><code>:help command-attributes</code></a></li>
</ul>
<h3 id="caveats-5">Caveats</h3>
<p><code>-complete=custom</code>
属性自动选出合适的候选补全并且支持内置的通配符（<a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/editing.html#wildcard"><code>:help wildcard</code></a>）</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function!</span> <span class="title">s</span>:completion_function<span class="params">(ArgLead, CmdLine, CursorPos)</span> abort</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">join</span>([</span><br><span class="line">        \ <span class="string">&#x27;strawberry&#x27;</span>,</span><br><span class="line">        \ <span class="string">&#x27;star&#x27;</span>,</span><br><span class="line">        \ <span class="string">&#x27;stellar&#x27;</span>,</span><br><span class="line">        \ ], <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">endfunction</span></span><br><span class="line"></span><br><span class="line">command! -nargs=<span class="number">1</span> -<span class="built_in">complete</span>=custom,<span class="variable">s:completion_function</span> Test <span class="keyword">echo</span> <span class="symbol">&lt;q-args&gt;</span></span><br><span class="line"><span class="string">&quot; Typing `:Test st[ae]&lt;Tab&gt;` returns &quot;</span><span class="keyword">star</span><span class="string">&quot; and &quot;</span>stellar<span class="comment">&quot;</span></span><br></pre></td></tr></table></figure>
<p>把 <code>complete</code> 设置为 Lua 函数的话，它的行为会类似于
<code>customlist</code> ，Neovim 不会筛选函数返回的候选列表</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_create_user_command(<span class="string">&#x27;Test&#x27;</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">end</span>, &#123;</span><br><span class="line">    nargs = <span class="number">1</span>,</span><br><span class="line">    complete = <span class="function"><span class="keyword">function</span><span class="params">(ArgLead, CmdLine, CursorPos)</span></span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&#x27;strawberry&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;star&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;stellar&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Typing `:Test z&lt;Tab&gt;` returns all the completion results because the list was not filtered</span></span><br></pre></td></tr></table></figure>
<h2 id="定义自动命令">定义自动命令</h2>
<p>（本节内容尚未完成）</p>
<p>Neovim 0.7.0 为创建自动命令提供了相应的 API 函数。更多细节请参见
<code>:help api-autocmd</code></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/14661">Pull request
#14661</a> (lua: autocmds take 2)</li>
</ul>
<h2 id="定义语法高亮">定义语法高亮</h2>
<p>（本节内容尚未完成）</p>
<p>Neovim 0.7.0 为处理高亮组提供了相应的 API 函数。更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_set_hl()"><code>:help nvim_set_hl()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_get_hl_by_id()"><code>:help nvim_get_hl_by_id()</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/api.html#nvim_get_hl_by_name()"><code>:help nvim_get_hl_by_name()</code></a></li>
</ul>
<h2 id="general-tips-and-recommendations">General tips and
recommendations</h2>
<h3 id="重新加载缓存的模块">重新加载缓存的模块</h3>
<p>在 Lua 中，<code>require()</code>
函数会缓存已加载的模块，这对提升性能是非常有用的。但是它会对插件的工作造成影响，因为已加载的模块不会在后续的
<code>require()</code> 调用中更新。</p>
<p>如果你想刷新某个特定模块的缓存，那么你必须去修改全局的
<code>package.loaded</code> :</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">package</span>.<span class="built_in">loaded</span>[<span class="string">&#x27;modname&#x27;</span>] = <span class="literal">nil</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;modname&#x27;</span>) <span class="comment">-- loads an updated version of module &#x27;modname&#x27;</span></span><br></pre></td></tr></table></figure>
<p><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim">nvim-lua/plenary.nvim</a>
插件提供了实现此功能的<a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim/blob/master/lua/plenary/reload.lua">自定义函数</a></p>
<h3 id="不要填充-lua-字符串">不要填充 Lua 字符串！</h3>
<p>当使用双重中括号的字符串时，尽量不要填充多余的字符（如空格、制表符等）！当字符没有特殊意义的时候这样做无可非议；但是当字符具有特殊意义时，这样做可能会导致一些难以发现的问题</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim.api.nvim_set_keymap(<span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;&lt;Leader&gt;f&#x27;</span>, <span class="string">[[ &lt;Cmd&gt;call foo()&lt;CR&gt; ]]</span>, &#123;noremap = <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>在上面的例子中，<code>&lt;Leader&gt;f</code> 被映射到了
<code>&lt;Space&gt;&lt;Cmd&gt;call foo()&lt;CR&gt;&lt;Space&gt;</code>
，而不是我们期望的 <code>&lt;Cmd&gt;call foo()&lt;CR&gt;</code>。</p>
<h3 id="关于-vimscript---lua-之间类型转换的注意事项">关于 Vimscript
&lt;-&gt; Lua 之间类型转换的注意事项</h3>
<h4 id="变量转换时会创建一个副本">变量转换时会创建一个副本</h4>
<p>这意味着你对对象（从 Lua 转换到 Vimscript
的对象或者反过来）的引用进行修改不会影响到原对象。</p>
<p>例如，Vimscript 中的 <code>map()</code> 函数就地修改了一个变量：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">s:list</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> <span class="variable">s:newlist</span> = <span class="keyword">map</span>(<span class="variable">s:list</span>, &#123;_, v -&gt; v * <span class="number">2</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:list</span></span><br><span class="line"><span class="comment">&quot; [2, 4, 6]</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:newlist</span></span><br><span class="line"><span class="comment">&quot; [2, 4, 6]</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">s:list</span> is# <span class="variable">s:newlist</span></span><br><span class="line"><span class="comment">&quot; 1</span></span><br></pre></td></tr></table></figure>
<p>在 Lua 中调用这个函数，它改变的将会是参数的一个副本：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> tbl = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">local</span> newtbl = vim.fn.map(tbl, <span class="function"><span class="keyword">function</span><span class="params">(_, v)</span></span> <span class="keyword">return</span> v * <span class="number">2</span> <span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(tbl)) <span class="comment">-- &#123; 1, 2, 3 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(newtbl)) <span class="comment">-- &#123; 2, 4, 6 &#125;</span></span><br><span class="line"><span class="built_in">print</span>(tbl == newtbl) <span class="comment">-- false</span></span><br></pre></td></tr></table></figure>
<h4 id="并不是总能进行类型转换">并不是总能进行类型转换</h4>
<p>这主要影响函数和 table：</p>
<p>混合列表和字典的 Lua table 是无法转换的：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(vim.fn.count(&#123;<span class="number">1</span>, <span class="number">1</span>, number = <span class="number">1</span>&#125;, <span class="number">1</span>))</span><br><span class="line"><span class="comment">-- E5100: Cannot convert given lua table: table should either have a sequence of positive integer keys or contain only string keys</span></span><br></pre></td></tr></table></figure>
<p>尽管你可以在 Lua 中通过 <code>vim.fn</code> 调用 VIm
函数，但是你不能保存对它们的引用。这可能会导致一些意外的行为：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> FugitiveHead = vim.fn.funcref(<span class="string">&#x27;FugitiveHead&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(FugitiveHead) <span class="comment">-- vim.NIL</span></span><br><span class="line"></span><br><span class="line">vim.cmd(<span class="string">&quot;let g:test_dict = &#123;&#x27;test_lambda&#x27;: &#123;-&gt; 1&#125;&#125;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(vim.g.test_dict.test_lambda) <span class="comment">-- nil</span></span><br><span class="line"><span class="built_in">print</span>(vim.inspect(vim.g.test_dict)) <span class="comment">-- &#123;&#125;</span></span><br></pre></td></tr></table></figure>
<p>把 Lua 函数作为参数传给 Vim 函数是可行的，但是不能把它们存在 Vim
变量中（Neovim 0.7.0+ 中修复了这个问题）：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- This works:</span></span><br><span class="line">vim.fn.jobstart(&#123;<span class="string">&#x27;ls&#x27;</span>&#125;, &#123;</span><br><span class="line">    on_stdout = <span class="function"><span class="keyword">function</span><span class="params">(chan_id, data, name)</span></span></span><br><span class="line">        <span class="built_in">print</span>(vim.inspect(data))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- This doesn&#x27;t:</span></span><br><span class="line">vim.g.test_dict = &#123;test_lambda = <span class="function"><span class="keyword">function</span><span class="params">()</span></span> <span class="keyword">return</span> <span class="number">1</span> <span class="keyword">end</span>&#125; <span class="comment">-- Error: Cannot convert given lua type</span></span><br></pre></td></tr></table></figure>
<p>值得注意的是，在 Vimscript 中使用 <code>luaeval()</code>
执行相同操作却是可行的：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">g:test_dict</span> = &#123;<span class="string">&#x27;test_lambda&#x27;</span>: <span class="built_in">luaeval</span>(<span class="string">&#x27;function() return 1 end&#x27;</span>)&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:test_dict</span></span><br><span class="line"><span class="comment">&quot; &#123;&#x27;test_lambda&#x27;: function(&#x27;&lt;lambda&gt;4714&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="vim-booleans">Vim booleans</h4>
<p>在 Vim 脚本中，一种常见的情况是使用 <code>1</code> 或 <code>0</code>
来代表布尔值。事实上，直到版本 7.4.1154，Vim 才有单独的布尔类型。</p>
<p>在 Vimscript 中，Lua 的布尔值会被转换为真正的布尔值，而不是数字：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.lua_true = true</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:lua_true</span></span><br><span class="line"><span class="comment">&quot; v:true</span></span><br><span class="line"><span class="keyword">lua</span> <span class="keyword">vim</span>.g.lua_false = false</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">g:lua_false</span></span><br><span class="line"><span class="comment">&quot; v:false</span></span><br></pre></td></tr></table></figure>
<h3 id="设置-linterslanguage-servers">设置 linters/language servers</h3>
<p>如果你使用 liner 和 / 或 language server 来获得 Lua
项目的自动补全和错误检查，你可能需要为它们配置 Neovim
特定的设置。以下是一些流行工具的推荐配置：</p>
<h4 id="luacheck">luacheck</h4>
<p>你可以通过把此配置放入 <code>~/.luacheckrc</code> （或
<code>$XDG_CONFIG_HOME/luacheck/.luacheckrc</code>）中来让 <a
target="_blank" rel="noopener" href="https://github.com/mpeterv/luacheck/">luacheck</a> 识别全局的
<code>vim</code> 变量：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">globals = &#123;</span><br><span class="line">    <span class="string">&quot;vim&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/Alloyed/lua-lsp/">Alloyed/lua-lsp</a>
使用 <code>luacheck</code> 提供 linting 并读取相同的文件。</p>
<p>有关如何配置 <code>luacheck</code> 的更多信息，请参见它的<a
target="_blank" rel="noopener" href="https://luacheck.readthedocs.io/en/stable/config.html">文档</a></p>
<h4 id="sumnekolua-language-server">sumneko/lua-language-server</h4>
<p><a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/">nvim-lspconfig</a>
仓库中包含了如何配置 sumneko/lua-language-server 的<a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/blob/master/doc/server_configurations.md#sumneko_lua">说明</a>（示例使用内置
LSP 客户端，但其他 LSP 客户端实现的配置应该相同）。</p>
<p>有关如何配置 <a
target="_blank" rel="noopener" href="https://github.com/sumneko/lua-language-server/">sumneko/lua-language-server</a>
的更多信息，请参阅 <a
target="_blank" rel="noopener" href="https://github.com/sumneko/lua-language-server/wiki/Setting">"Setting"</a></p>
<h4 id="coc.nvim">coc.nvim</h4>
<p><a target="_blank" rel="noopener" href="https://github.com/neoclide/coc.nvim/">coc.nvim</a> 的 <a
target="_blank" rel="noopener" href="https://github.com/rafcamlet/coc-nvim-lua/">rafcamlet/coc-nvim-lua</a>
补全源为 Neovim 标准库提供了补全项。</p>
<h3 id="调试-lua-代码">调试 Lua 代码</h3>
<p>你可以使用 <a
target="_blank" rel="noopener" href="https://github.com/jbyuki/one-small-step-for-vimkind">jbyuki/one-small-step-for-vimkind</a>
调试在单独的 Neovim 实例中运行的 Lua 代码</p>
<p>该插件使用 <a
target="_blank" rel="noopener" href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter
Protocol</a>。连接到一个 debug adapter 需要 DAP 客户端，例如 <a
target="_blank" rel="noopener" href="https://github.com/mfussenegger/nvim-dap/">mfussenegger/nvim-dap</a>
或 <a
target="_blank" rel="noopener" href="https://github.com/puremourning/vimspector/">puremourning/vimspector</a>。</p>
<h3 id="调试-lua-设置的按键映射-用户命令-自动命令">调试 Lua
设置的按键映射 / 用户命令 / 自动命令</h3>
<p><code>:verbose</code> 命令允许你查看 按键映射 / 用户命令 /
自动命令的定义位置：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:<span class="keyword">verbose</span> <span class="keyword">map</span> <span class="keyword">m</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n  m_          * <span class="symbol">&lt;Cmd&gt;</span><span class="keyword">echo</span> <span class="string">&#x27;example&#x27;</span><span class="symbol">&lt;CR&gt;</span></span><br><span class="line">        Last <span class="keyword">set</span> from ~/.config/nvim/init.<span class="keyword">vim</span> <span class="built_in">line</span> <span class="number">26</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，出于性能原因，此功能在 Lua 中是禁用的。你可以通过使用大于
0 的 verbose level 启动 Neovim 来启用它：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvim -V1</span><br></pre></td></tr></table></figure>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/options.html#&#39;verbose&#39;"><code>:help 'verbose'</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/starting.html#-V"><code>:help -V</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/15079">neovim/neovim#15079</a></li>
</ul>
<h3 id="测试-lua-代码">测试 Lua 代码</h3>
<ul>
<li><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/plenary.nvim/#plenarytest_harness">plenary.nvim:
test harness</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/notomo/vusted">notomo/vusted</a></li>
</ul>
<h3 id="使用-luarocks-包">使用 Luarocks 包</h3>
<p><a
target="_blank" rel="noopener" href="https://github.com/wbthomason/packer.nvim">wbthomason/packer.nvim</a>
支持 Luarocks 包。它的 <a
target="_blank" rel="noopener" href="https://github.com/wbthomason/packer.nvim/#luarocks-support">README</a>
中提供了有关如何设置的说明</p>
<h2 id="miscellaneous">Miscellaneous</h2>
<h3 id="vim.loop">vim.loop</h3>
<p><code>vim.loop</code> 是暴露 LibUV 接口的模块。一些相关资源：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.libuv.org/en/v1.x/">Official documentation for
LibUV</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/luvit/luv/blob/master/docs.md">Luv
documentation</a></li>
<li><a target="_blank" rel="noopener" href="https://teukka.tech/vimloop.html">teukka.tech - Using LibUV
in Neovim</a></li>
</ul>
<p>更多信息请参见： - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lua.html#vim.loop"><code>:help vim.loop</code></a></p>
<h3 id="vim.lsp">vim.lsp</h3>
<p><code>vim.lsp</code> 是内置的 lsp 库。官方的 lsp 配置插件 <a
target="_blank" rel="noopener" href="https://github.com/neovim/nvim-lspconfig/">neovim/nvim-lspconfig</a>
包含一些流行的 language server 的默认配置。</p>
<p>客户端的行为可以使用 "sp-handlers" 进行配置。更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lsp.html#lsp-handler"><code>:help lsp-handler</code></a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/neovim/neovim/pull/12655">neovim/neovim#12655</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/nvim-lua/diagnostic-nvim/issues/73#issue-737897078">how
to migrate from diagnostic-nvim</a></li>
</ul>
<p>你可能还想了解一下一些基于 LSP 客户端构建的<a
target="_blank" rel="noopener" href="https://github.com/rockerBOO/awesome-neovim#lsp">插件</a></p>
<p>更多信息请参见：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/lsp.html#LSP"><code>:help lsp</code></a></li>
</ul>
<h3 id="vim.treesitter">vim.treesitter</h3>
<p><code>vim.treesitter</code> 是 <a
target="_blank" rel="noopener" href="https://tree-sitter.github.io/tree-sitter/">Tree-sitter</a> 的
neovim 集成，如果你想了解更多可以参考 <a
target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=Jes3bD6P0To">presentation
(38:37)</a>.</p>
<p>The <a target="_blank" rel="noopener" href="https://github.com/nvim-treesitter/">nvim-treesitter</a>
organisation hosts various plugins taking advantage of the library.</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/glepnir">glepnir</a> 制作的主题 <a
target="_blank" rel="noopener" href="https://github.com/glepnir/zephyr-nvim">zephyr-nvim</a>
语法高亮基于 nvim-treesitter</p>
<p>—— 译者注</p>
</blockquote>
<p>See also: - <a
target="_blank" rel="noopener" href="https://neovim.io/doc/user/treesitter.html#lua-treesitter"><code>:help lua-treesitter</code></a></p>
<h3 id="transpilers">Transpilers</h3>
<p>使用 Lua 的一个优点是您实际上不必编写 Lua
代码！有许多其他语言可以转译到 Lua。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://moonscript.org/">Moonscript</a></li>
</ul>
<p>可能是 Lua
最著名的转译器之一。添加了许多方便的功能，如类、列表推导或函数字面量。
<a
target="_blank" rel="noopener" href="https://github.com/svermeulen/nvim-moonmaker">svermeulen/nvim-moonmaker</a>
插件允许您直接在 Moonscript 中编写 Neovim 插件和配置。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://fennel-lang.org/">Fennel</a></li>
</ul>
<p>可以编译为 Lua 的 lisp 方言。你可以使用 <a
target="_blank" rel="noopener" href="https://github.com/Olical/aniseed">Olical/aniseed</a> 或 <a
target="_blank" rel="noopener" href="https://github.com/rktjmp/hotpot.nvim">Hotpot</a> 插件在 Fennel
中为 Neovim 编写配置和插件。此外，<a
target="_blank" rel="noopener" href="https://github.com/Olical/conjure">Olical/conjure</a>
插件提供了一个支持 Fennel（以及其他语言）的交互式开发环境。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/teal-language/tl">Teal</a></li>
</ul>
<p>Teal 这个名字来自 TL（typed lua）的发音。这代表了它的目标——向 lua
添加强类型，同时语法尽量保持接近标准 lua 语法。 <a
target="_blank" rel="noopener" href="https://github.com/svermeulen/nvim-teal-maker">nvim-teal-maker</a>
插件可用于直接在 Teal 中编写 Neovim 插件或配置文件</p>
<p>其他一些有趣的项目：</p>
<ul>
<li><a
target="_blank" rel="noopener" href="https://github.com/TypeScriptToLua/TypeScriptToLua">TypeScriptToLua/TypeScriptToLua</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/teal-language/tl">teal-language/tl</a></li>
<li><a target="_blank" rel="noopener" href="https://haxe.org/">Haxe</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/SwadicalRag/wasm2lua">SwadicalRag/wasm2lua</a></li>
<li><a
target="_blank" rel="noopener" href="https://github.com/hengestone/lua-languages">hengestone/lua-languages</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%94%B5%E8%84%91%E6%8A%80%E6%9C%AF/" rel="tag"># 电脑技术</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/06/18/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%A7%84%E5%88%92/" rel="prev" title="软件开发规划">
                  <i class="fa fa-angle-left"></i> 软件开发规划
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/06/21/Neovim%E9%85%8D%E7%BD%AE%E6%95%99%E7%A8%8B/" rel="next" title="Neovim配置教程">
                  Neovim配置教程 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; Sat Sep 03 2022 08:00:00 GMT+0800 (中国标准时间) – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa-solid fa-star"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">fengzhenhua</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/fungzhenhua" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://s4.zstatic.net/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://s4.zstatic.net/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script src="/js/pjax.js"></script>

  <script src="https://s4.zstatic.net/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://s4.zstatic.net/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://s4.zstatic.net/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>


  <script src="/js/third-party/fancybox.js"></script>



  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://s4.zstatic.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
